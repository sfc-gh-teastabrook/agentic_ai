--!jinja
USE ROLE TECHUP25_RL;
CALL SYSTEM$CREATE_SEMANTIC_VIEW_FROM_YAML(
  'TECHUP25.{{ENV}}AGENTIC_AI', 
$$
name: SNOWFLAKE_HOUSEKEEPING_AGENT
description: This is the Platform Health & Governance Model. It provides a unified business layer over the Snowflake ACCOUNT_USAGE schema, designed for platform owners and administrators. The model is optimized for natural language queries with Cortex Analyst, allowing users to proactively manage the environment by asking questions related to cost efficiency, operational performance, and security governance.
tables:
  - name: QUERY_HISTORY
    synonyms:
      - executed statements
      - queries
      - query logs
      - SQL history
      - user activity
    description: A historical log of every SQL query executed in the account. Contains performance metrics like execution time and bytes scanned, along with context like the user, role, and warehouse used. Data may have a latency of up to a few hours.
    base_table:
      database: SNOWFLAKE
      schema: ACCOUNT_USAGE
      table: QUERY_HISTORY
    dimensions:
      - name: DATABASE_NAME
        synonyms:
          - database
          - db name
        description: The name of the database where the query was executed.
        expr: DATABASE_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - SNOWFLAKE
          - DOC_AI_QS_DB
      - name: ERROR_CODE
        synonyms:
          - error code
          - error number
          - exception code
          - failure code
        description: Error codes associated with query execution, indicating specific issues or failures that occurred during query processing.
        expr: ERROR_CODE
        data_type: VARCHAR(16777216)
        sample_values:
          - '505118'
          - '001003'
          - '002043'
      - name: ERROR_MESSAGE
        synonyms:
          - error details
          - error message
          - exception message
          - failure message
        description: The error message returned when a query fails to execute due to a syntax error, providing details on the location and nature of the error.
        expr: ERROR_MESSAGE
        data_type: VARCHAR(16777216)
        sample_values:
          - |-
            SQL compilation error:
            syntax error line 1 at position 58 unexpected '@snowflake.com'.
      - name: EXECUTION_STATUS
        synonyms:
          - execution result
          - query outcome
          - query status
          - status
          - success or failure
        description: The status of a query's execution, indicating whether it completed successfully, failed, or resulted in an incident requiring further investigation.
        expr: EXECUTION_STATUS
        data_type: VARCHAR(16777216)
        sample_values:
          - SUCCESS
          - FAIL
          - INCIDENT
      - name: INBOUND_DATA_TRANSFER_CLOUD
        synonyms:
          - data source cloud
          - inbound cloud
          - transfer source
        description: The type of data transfer that occurred, specifically data being transferred into the system from a cloud-based source.
        expr: INBOUND_DATA_TRANSFER_CLOUD
        data_type: VARCHAR(16777216)
      - name: INBOUND_DATA_TRANSFER_REGION
        synonyms:
          - inbound region
          - source region
          - transfer region
        description: The region where the data was transferred from, indicating the geographical location of the inbound data source.
        expr: INBOUND_DATA_TRANSFER_REGION
        data_type: VARCHAR(16777216)
      - name: IS_CLIENT_GENERATED_STATEMENT
        synonyms:
          - auto generated
          - client generated
          - generated query
          - system generated
        description: Indicates whether the query was generated by a client application or manually written by a user.
        expr: IS_CLIENT_GENERATED_STATEMENT
        data_type: BOOLEAN
        sample_values:
          - 'FALSE'
          - 'TRUE'
      - name: OUTBOUND_DATA_TRANSFER_CLOUD
        synonyms:
          - destination cloud
          - outbound cloud
          - target cloud
        description: The cloud service provider used for outbound data transfers.
        expr: OUTBOUND_DATA_TRANSFER_CLOUD
        data_type: VARCHAR(16777216)
        sample_values:
          - AWS
      - name: OUTBOUND_DATA_TRANSFER_REGION
        synonyms:
          - destination region
          - outbound region
          - target region
        description: The region where data was transferred to outside of the Snowflake account.
        expr: OUTBOUND_DATA_TRANSFER_REGION
        data_type: VARCHAR(16777216)
        sample_values:
          - us-east-1
      - name: QUERY_HASH
        synonyms:
          - query fingerprint
          - query hash
          - query signature
          - unique query id
        description: Unique identifier for a query, used to track and analyze query performance and usage patterns.
        expr: QUERY_HASH
        data_type: VARCHAR(16777216)
        sample_values:
          - 2a8c17c6795483ba7a65c279420589e0
          - 40bcd1ae40ebb27ef6f55c706e018ce7
          - f396907e872c52c434c2b2f1683e3af3
      - name: QUERY_ID
        synonyms:
          - execution id
          - query id
          - query identifier
          - query uuid
        description: Unique identifier for a query executed in the system.
        expr: QUERY_ID
        data_type: VARCHAR(16777216)
        sample_values:
          - 01b77f27-020b-0785-0035-478701f8e9c2
          - 01b77f33-020a-fc82-0035-478701f8dd16
          - 01b77f01-020a-fc82-0035-478701f8d522
      - name: QUERY_PARAMETERIZED_HASH
        synonyms:
          - normalized query hash
          - parameterized hash
          - pattern hash
          - query template hash
        description: A unique hash value representing a parameterized query, allowing for the identification and grouping of similar queries with different literal values.
        expr: QUERY_PARAMETERIZED_HASH
        data_type: VARCHAR(16777216)
        sample_values:
          - 2a8c17c6795483ba7a65c279420589e0
          - f396907e872c52c434c2b2f1683e3af3
          - 169fe3508068815d2a5881ca143bc398
      - name: QUERY_RETRY_CAUSE
        synonyms:
          - failure reason
          - retry cause
          - retry reason
        description: The reason why a query was retried, such as "Timeout", "Network Error", or "Resource Unavailable".
        expr: QUERY_RETRY_CAUSE
        data_type: VARCHAR(16777216)
      - name: QUERY_TAG
        synonyms:
          - query context
          - query metadata
          - query origin
          - query tag
        description: The QUERY_TAG column captures metadata about the origin and context of a query, including the engine used to execute it (StreamlitEngine), the name of the Streamlit application or notebook that triggered the query (StreamlitName), and whether the query is a child query or not (ChildQuery), or if it was generated by Amazon SageMaker Autopilot (COPILOT).
        expr: QUERY_TAG
        data_type: VARCHAR(16777216)
        sample_values:
          - '{"StreamlitEngine":"ExecuteStreamlit","StreamlitName":"BUILD_UK.NOTEBOOKS.\"UK Analytics\"","ChildQuery":true}'
          - '{"StreamlitEngine":"ExecuteStreamlit","StreamlitName":"BUILD_UK.STREAMLITS.LLSNDV1U2JON6UGZ","ChildQuery":true}'
          - COPILOT
      - name: QUERY_TEXT
        synonyms:
          - query code
          - query statement
          - query text
          - SQL statement
          - SQL text
        description: The text of the SQL queries executed to refresh dynamic tables, including the table names and refresh timestamps.
        expr: QUERY_TEXT
        data_type: VARCHAR(16777216)
        sample_values:
          - alter dynamic table /* DEMO.DT_DEMO.PROD_INV_ALERT = */ identifier(14996818914250786) refresh at 1726901487070;
          - alter dynamic table /* DEMO.DT_DEMO.CUMULATIVE_PURCHASE = */ identifier(14996818914250778) refresh at 1726904559070;
          - alter dynamic table /* DEMO.DT_DEMO.CUSTOMER_SALES_DATA_HISTORY = */ identifier(14996818914250762) refresh at 1726889199070;
      - name: QUERY_TYPE
        synonyms:
          - command type
          - query type
          - SQL operation
          - statement type
        description: The type of query executed, such as refreshing a dynamic table, displaying data, or retrieving files.
        expr: QUERY_TYPE
        data_type: VARCHAR(16777216)
        sample_values:
          - REFRESH_DYNAMIC_TABLE_AT_REFRESH_VERSION
          - SHOW
          - GET_FILES
      - name: RELEASE_VERSION
        synonyms:
          - build version
          - release version
          - software version
          - system version
        description: The version of the software release that was in use when the query was executed.
        expr: RELEASE_VERSION
        data_type: VARCHAR(16777216)
        sample_values:
          - 8.35.1
          - 8.32.3
          - 8.33.1
      - name: ROLE_NAME
        synonyms:
          - access role
          - role
          - security role
          - user role
        description: The role that executed the query.
        expr: ROLE_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - PUBLIC
          - DOC_AI_QS_ROLE
          - ACCOUNTADMIN
      - name: ROLE_TYPE
        synonyms:
          - role account type
          - role category
          - role type
        description: The type of role or application associated with a query, indicating whether the query was executed by a specific role or through a particular application.
        expr: ROLE_TYPE
        data_type: VARCHAR(16777216)
        sample_values:
          - ROLE
          - APPLICATION
      - name: SCHEMA_NAME
        synonyms:
          - database schema
          - namespace
          - schema
        description: The name of the schema that the query was executed against.
        expr: SCHEMA_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - TRUST_CENTER
          - CIS_BENCHMARKS
      - name: SECONDARY_ROLE_STATS
        synonyms:
          - additional roles
          - role stats
          - secondary roles
        description: This column stores the history of secondary roles associated with a query, including the names of the roles, the total count of roles, and the IDs of the roles.
        expr: SECONDARY_ROLE_STATS
        data_type: VARCHAR(16777216)
        sample_values:
          - '{"roleNames":[],"roleCount":0,"roleIds":[]}'
          - '{"roleNames":["ALL"],"roleCount":7,"roleIds":[893880072,893880096,893880180,893880228,228833297609,228833300009,228833300169]}'
      - name: USER_DATABASE_NAME
        synonyms:
          - database context
          - user database
          - user db
        description: The name of the database that the user was connected to when the query was executed.
        expr: USER_DATABASE_NAME
        data_type: VARCHAR(16777216)
      - name: USER_NAME
        synonyms:
          - executed by
          - query executor
          - user
          - username
          - who ran
        description: The user who executed the query.
        expr: USER_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - SYSTEM
          - MHARRIS
          - WORKSHEETS_APP_USER
      - name: USER_SCHEMA_NAME
        synonyms:
          - schema context
          - user namespace
          - user schema
        description: The name of the schema that the user who executed the query belongs to.
        expr: USER_SCHEMA_NAME
        data_type: VARCHAR(16777216)
      - name: USER_TYPE
        synonyms:
          - account type
          - user category
          - user type
        description: The type of user who executed the query, such as a person or an automated system.
        expr: USER_TYPE
        data_type: VARCHAR(16777216)
        sample_values:
          - PERSON
      - name: WAREHOUSE_ID
        synonyms:
          - compute id
          - warehouse id
          - warehouse identifier
        description: ID of the warehouse
        expr: WAREHOUSE_ID
        data_type: VARCHAR(16777216)
      - name: WAREHOUSE_NAME
        synonyms:
          - compute resource
          - compute warehouse
          - virtual warehouse
          - warehouse
        description: The name of the warehouse where the query was executed.
        expr: WAREHOUSE_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - COMPUTE_SERVICE_WH_USER_TASKS_POOL_XSMALL_0
          - COMPUTE_SERVICE_WH_USER_TASKS_POOL_XSMALL_3
          - XSMALL_WH
      - name: WAREHOUSE_SIZE
        synonyms:
          - capacity
          - cluster size
          - compute size
          - warehouse size
        description: The size of the warehouse used to execute the query, which can impact performance and resource utilization.
        expr: WAREHOUSE_SIZE
        data_type: VARCHAR(16777216)
        sample_values:
          - Small
          - X-Small
      - name: WAREHOUSE_TYPE
        synonyms:
          - compute type
          - warehouse category
          - warehouse type
        description: The type of warehouse used to execute the query, either a standard warehouse or a Snowpark-optimized warehouse, which is optimized for performance with Snowpark applications.
        expr: WAREHOUSE_TYPE
        data_type: VARCHAR(16777216)
        sample_values:
          - STANDARD
          - SNOWPARK-OPTIMIZED
    time_dimensions:
      - name: END_TIME
        synonyms:
          - completion time
          - end time
          - finished at
        description: The date and time when a query was completed.
        expr: END_TIME
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2024-09-16T04:14:41.753+0000
          - 2024-09-16T11:03:29.307+0000
          - 2024-09-16T05:27:28.904+0000
      - name: START_TIME
        synonyms:
          - initiated at
          - query start time
          - start time
        description: The date and time when a query was initiated.
        expr: START_TIME
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2024-09-17T10:17:52.961+0000
          - 2024-09-17T09:07:29.428+0000
          - 2024-09-17T11:24:17.768+0000
    facts:
      - name: BYTES_DELETED
        synonyms:
          - bytes deleted
          - data deleted
          - deleted volume
        description: The total number of bytes deleted from the database as a result of a query.
        expr: BYTES_DELETED
        data_type: NUMBER(38,0)
        sample_values:
          - '253077'
          - '41735'
          - '0'
      - name: BYTES_READ_FROM_RESULT
        synonyms:
          - bytes read from result
          - output bytes
          - result bytes read
        description: The total number of bytes read from the query results.
        expr: BYTES_READ_FROM_RESULT
        data_type: NUMBER(38,0)
        sample_values:
          - '0'
      - name: BYTES_SCANNED
        synonyms:
          - bytes scanned
          - data scanned
          - scan volume
        description: The total number of bytes scanned by the query.
        expr: BYTES_SCANNED
        data_type: NUMBER(38,0)
        sample_values:
          - '0'
          - '2048'
          - '3584'
      - name: BYTES_SENT_OVER_THE_NETWORK
        synonyms:
          - bytes sent over network
          - data transmitted
          - network bytes
        description: The total amount of data transmitted over the network during query execution, measured in bytes.
        expr: BYTES_SENT_OVER_THE_NETWORK
        data_type: NUMBER(38,0)
        sample_values:
          - '7854112'
          - '25555'
          - '600366'
      - name: BYTES_SPILLED_TO_LOCAL_STORAGE
        synonyms:
          - bytes spilled local
          - local disk spill
          - memory overflow local
        description: The total amount of data (in bytes) that was spilled to local storage during query execution, indicating the amount of data that exceeded the available memory and had to be written to disk.
        expr: BYTES_SPILLED_TO_LOCAL_STORAGE
        data_type: NUMBER(38,0)
        sample_values:
          - '6140'
          - '0'
          - '47970'
      - name: BYTES_SPILLED_TO_REMOTE_STORAGE
        synonyms:
          - bytes spilled remote
          - memory overflow remote
          - remote disk spill
        description: The total amount of data in bytes that was spilled to remote storage during query execution, indicating the amount of data that exceeded the available memory and had to be written to disk.
        expr: BYTES_SPILLED_TO_REMOTE_STORAGE
        data_type: NUMBER(38,0)
        sample_values:
          - '16777216'
          - '0'
      - name: BYTES_WRITTEN
        synonyms:
          - bytes written
          - data written
          - write volume
        description: The total number of bytes written to storage as a result of a query.
        expr: BYTES_WRITTEN
        data_type: NUMBER(38,0)
        sample_values:
          - '2560'
          - '0'
          - '11264'
      - name: BYTES_WRITTEN_TO_RESULT
        synonyms:
          - bytes written to result
          - output volume
          - result bytes written
        description: The total number of bytes written to the result set of a query.
        expr: BYTES_WRITTEN_TO_RESULT
        data_type: NUMBER(38,0)
        sample_values:
          - '29'
          - '13'
          - '212'
      - name: CHILD_QUERIES_WAIT_TIME
        synonyms:
          - child queries wait time
          - dependent query time
          - sub query wait
        description: Total wait time in milliseconds for child queries to complete.
        expr: CHILD_QUERIES_WAIT_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '3919'
          - '0'
          - '4955'
      - name: CLUSTER_NUMBER
        synonyms:
          - cluster id
          - cluster number
          - server cluster
        description: The cluster number assigned to a query, which represents the group of servers that processed the query.
        expr: CLUSTER_NUMBER
        data_type: NUMBER(38,0)
        sample_values:
          - '3'
          - '4'
      - name: COMPILATION_TIME
        synonyms:
          - compilation time
          - compile time
          - parsing time
        description: The time taken to compile a query, measured in milliseconds.
        expr: COMPILATION_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '142'
          - '174'
          - '188'
      - name: CREDITS_USED_CLOUD_SERVICES
        synonyms:
          - cloud features credits
          - cloud services credits
          - serverless credits
          - service credits
        description: Credits used by serverless cloud features for this specific query (NOT warehouse compute credits). This tracks consumption of services like Snowpipe, materialized views, search optimization, etc.
        expr: CREDITS_USED_CLOUD_SERVICES
        data_type: FLOAT
        sample_values:
          - '6.1e-05'
          - '7.1e-05'
          - '4.1e-05'
      - name: DATABASE_ID
        synonyms:
          - database id
          - database identifier
          - db id
        description: Unique identifier for the database where the query was executed.
        expr: DATABASE_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '217'
          - '1'
      - name: EXECUTION_TIME
        synonyms:
          - execution time
          - processing time
          - runtime
        description: The time taken to execute a query, measured in milliseconds.
        expr: EXECUTION_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '99'
          - '152'
          - '174'
      - name: EXTERNAL_FUNCTION_TOTAL_INVOCATIONS
        synonyms:
          - external calls
          - external function invocations
          - function calls
        description: Total number of times an external function was invoked during query execution.
        expr: EXTERNAL_FUNCTION_TOTAL_INVOCATIONS
        data_type: NUMBER(38,0)
        sample_values:
          - '6'
          - '20'
          - '0'
      - name: EXTERNAL_FUNCTION_TOTAL_RECEIVED_BYTES
        synonyms:
          - external data received
          - external function received bytes
          - function input bytes
        description: Total number of bytes received by external functions during query execution.
        expr: EXTERNAL_FUNCTION_TOTAL_RECEIVED_BYTES
        data_type: NUMBER(38,0)
        sample_values:
          - '1216'
          - '0'
          - '2349'
      - name: EXTERNAL_FUNCTION_TOTAL_RECEIVED_ROWS
        synonyms:
          - external function received rows
          - external rows received
          - function input rows
        description: Total number of rows received by an external function during query execution.
        expr: EXTERNAL_FUNCTION_TOTAL_RECEIVED_ROWS
        data_type: NUMBER(38,0)
        sample_values:
          - '468'
          - '0'
          - '1'
      - name: EXTERNAL_FUNCTION_TOTAL_SENT_BYTES
        synonyms:
          - external data sent
          - external function sent bytes
          - function output bytes
        description: Total number of bytes sent by external functions.
        expr: EXTERNAL_FUNCTION_TOTAL_SENT_BYTES
        data_type: NUMBER(38,0)
        sample_values:
          - '0'
          - '57988877'
          - '20180'
      - name: EXTERNAL_FUNCTION_TOTAL_SENT_ROWS
        synonyms:
          - external function sent rows
          - external rows sent
          - function output rows
        description: Total number of rows sent to external functions for processing.
        expr: EXTERNAL_FUNCTION_TOTAL_SENT_ROWS
        data_type: NUMBER(38,0)
        sample_values:
          - '468'
          - '0'
          - '1'
      - name: FAULT_HANDLING_TIME
        synonyms:
          - error recovery time
          - fault handling time
          - fault resolution time
        description: The time taken to handle faults or errors in the system, measured in seconds.
        expr: FAULT_HANDLING_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '5427'
          - '3094'
          - '4241'
      - name: INBOUND_DATA_TRANSFER_BYTES
        synonyms:
          - data received bytes
          - inbound data bytes
          - incoming data volume
        description: The total number of bytes transferred into the system from an external source.
        expr: INBOUND_DATA_TRANSFER_BYTES
        data_type: NUMBER(38,0)
        sample_values:
          - '0'
      - name: LIST_EXTERNAL_FILES_TIME
        synonyms:
          - external file scan time
          - file listing time
          - list external files time
        description: The time it takes to list external files, measured in seconds, with a minimum of 0 seconds, an average of 29 seconds, and a maximum of 34 seconds.
        expr: LIST_EXTERNAL_FILES_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '29'
          - '0'
          - '34'
      - name: OUTBOUND_DATA_TRANSFER_BYTES
        synonyms:
          - data sent bytes
          - outbound data bytes
          - outgoing data volume
        description: The total number of bytes transferred out of the system during a query.
        expr: OUTBOUND_DATA_TRANSFER_BYTES
        data_type: NUMBER(38,0)
        sample_values:
          - '41735'
          - '0'
          - '253276'
      - name: PARTITIONS_SCANNED
        synonyms:
          - partitions read
          - partitions scanned
          - table partitions scanned
        description: The number of partitions scanned by the query.
        expr: PARTITIONS_SCANNED
        data_type: NUMBER(38,0)
        sample_values:
          - '0'
          - '312'
          - '1'
      - name: PARTITIONS_TOTAL
        synonyms:
          - partition count
          - partitions total
          - total partitions
        description: Total number of partitions in the database.
        expr: PARTITIONS_TOTAL
        data_type: NUMBER(38,0)
        sample_values:
          - '1'
          - '185199'
          - '0'
      - name: PERCENTAGE_SCANNED_FROM_CACHE
        synonyms:
          - cache efficiency
          - cache scan percentage
          - cached data percentage
        description: The percentage of data that was retrieved from the cache instead of being re-computed or re-retrieved from the underlying data source, indicating the efficiency of the query's caching mechanism.
        expr: PERCENTAGE_SCANNED_FROM_CACHE
        data_type: FLOAT
        sample_values:
          - '0.2596171639'
          - '0.3357630303'
          - '0.5'
      - name: QUERY_ACCELERATION_BYTES_SCANNED
        synonyms:
          - accelerated data scanned
          - acceleration cache bytes
          - query acceleration bytes
        description: The total amount of data scanned from the query acceleration cache, in bytes, for a given query.
        expr: QUERY_ACCELERATION_BYTES_SCANNED
        data_type: NUMBER(38,0)
        sample_values:
          - '0'
      - name: QUERY_ACCELERATION_PARTITIONS_SCANNED
        synonyms:
          - accelerated partitions scanned
          - acceleration partitions
          - query acceleration partitions
        description: The number of partitions scanned by the query accelerator.
        expr: QUERY_ACCELERATION_PARTITIONS_SCANNED
        data_type: NUMBER(38,0)
        sample_values:
          - '0'
      - name: QUERY_ACCELERATION_UPPER_LIMIT_SCALE_FACTOR
        synonyms:
          - acceleration scale factor
          - acceleration upper limit
          - query acceleration limit
        description: The scale factor used to determine the upper limit of query acceleration, with higher values allowing for more aggressive acceleration.
        expr: QUERY_ACCELERATION_UPPER_LIMIT_SCALE_FACTOR
        data_type: NUMBER(38,0)
        sample_values:
          - '1'
          - '5'
          - '0'
      - name: QUERY_HASH_VERSION
        synonyms:
          - hash version
          - query hash version
          - query version
        description: A unique identifier for a query, which can be used to track changes to the query over time, with the version number indicating the iteration of the query.
        expr: QUERY_HASH_VERSION
        data_type: NUMBER(38,0)
        sample_values:
          - '2'
      - name: QUERY_LOAD_PERCENT
        synonyms:
          - query load
          - query load percent
          - system load percent
        description: The percentage of the system's load that is currently being used to process queries.
        expr: QUERY_LOAD_PERCENT
        data_type: NUMBER(38,0)
        sample_values:
          - '50'
          - '100'
      - name: QUERY_PARAMETERIZED_HASH_VERSION
        synonyms:
          - parameterized hash version
          - parameterized version
          - template version
        description: A unique identifier for a parameterized query, used to track the version of the query's parameterized hash.
        expr: QUERY_PARAMETERIZED_HASH_VERSION
        data_type: NUMBER(38,0)
        sample_values:
          - '1'
      - name: QUERY_RETRY_TIME
        synonyms:
          - query retry time
          - retry duration
          - retry elapsed time
        description: The time it took to retry a query, in seconds, after an initial failure.
        expr: QUERY_RETRY_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '0'
      - name: QUEUED_OVERLOAD_TIME
        synonyms:
          - overload wait time
          - queue time overload
          - queued overload time
        description: The time spent waiting in the queue due to overload, in milliseconds.
        expr: QUEUED_OVERLOAD_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '67'
          - '0'
          - '138'
      - name: QUEUED_PROVISIONING_TIME
        synonyms:
          - provisioning wait time
          - queued provisioning time
          - resource wait time
        description: The time, in seconds, that a query spent in the queue waiting for resources to become available before it was executed.
        expr: QUEUED_PROVISIONING_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '98'
          - '0'
          - '117'
      - name: QUEUED_REPAIR_TIME
        synonyms:
          - queue repair time
          - queued repair time
          - repair wait time
        description: The time, in milliseconds, that a query spent waiting in the queue before being executed.
        expr: QUEUED_REPAIR_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '1624'
          - '1713'
          - '0'
      - name: ROWS_DELETED
        synonyms:
          - deleted rows
          - records deleted
          - rows deleted
        description: The number of rows deleted as a result of a query execution.
        expr: ROWS_DELETED
        data_type: NUMBER(38,0)
        sample_values:
          - '312'
          - '1'
          - '24'
      - name: ROWS_INSERTED
        synonyms:
          - inserted rows
          - records inserted
          - rows inserted
        description: The number of rows inserted into a table as a result of a query execution.
        expr: ROWS_INSERTED
        data_type: NUMBER(38,0)
        sample_values:
          - '7'
          - '1'
          - '9'
      - name: ROWS_PRODUCED
        synonyms:
          - result rows
          - rows produced
          - rows returned
        description: The total number of rows returned by a query.
        expr: ROWS_PRODUCED
        data_type: NUMBER(38,0)
        sample_values:
          - '1'
          - '3'
          - '3486'
      - name: ROWS_UNLOADED
        synonyms:
          - exported rows
          - rows unloaded
          - unloaded rows
        description: The total number of rows unloaded from a table during a query execution.
        expr: ROWS_UNLOADED
        data_type: NUMBER(38,0)
        sample_values:
          - '15178'
          - '489'
          - '215'
      - name: ROWS_UPDATED
        synonyms:
          - records updated
          - rows updated
          - updated rows
        description: The number of rows updated by a query.
        expr: ROWS_UPDATED
        data_type: NUMBER(38,0)
        sample_values:
          - '488'
          - '1'
          - '383'
      - name: ROWS_WRITTEN_TO_RESULT
        synonyms:
          - output rows
          - result rows written
          - rows written to result
        description: The number of rows written to the result set of a query.
        expr: ROWS_WRITTEN_TO_RESULT
        data_type: NUMBER(38,0)
        sample_values:
          - '1'
          - '1001'
          - '0'
      - name: SCHEMA_ID
        synonyms:
          - namespace id
          - schema id
          - schema identifier
        description: Unique identifier for the schema that the query was executed against.
        expr: SCHEMA_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '372'
          - '264'
          - '267'
      - name: SESSION_ID
        synonyms:
          - connection id
          - session id
          - session identifier
        description: Unique identifier for a query session, used to track and analyze the history of queries executed on the system.
        expr: SESSION_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '14996818942173850'
          - '14996818942186146'
          - '14996818942177806'
      - name: TOTAL_ELAPSED_TIME
        synonyms:
          - total duration
          - total elapsed time
          - total runtime
        description: The total time taken to execute a query, measured in milliseconds.
        expr: TOTAL_ELAPSED_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '338'
          - '283'
          - '66'
      - name: TRANSACTION_BLOCKED_TIME
        synonyms:
          - blocked time
          - transaction blocked time
          - wait time
        description: The time, in milliseconds, that the query spent waiting for a transaction to be committed or rolled back, blocking the current query from proceeding.
        expr: TRANSACTION_BLOCKED_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '934'
          - '162'
          - '189'
      - name: TRANSACTION_ID
        synonyms:
          - transaction id
          - transaction identifier
          - txn id
        description: Unique identifier for a specific transaction or query execution, used for tracking and auditing purposes.
        expr: TRANSACTION_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '1725887537511000000'
          - '1725888305051000000'
          - '1725892481344000000'
      - name: USER_DATABASE_ID
        synonyms:
          - database context id
          - user database id
          - user db id
        description: Unique identifier for the database that the query was executed against.
        expr: USER_DATABASE_ID
        data_type: NUMBER(38,0)
      - name: USER_SCHEMA_ID
        synonyms:
          - schema context id
          - user namespace id
          - user schema id
        description: Unique identifier for the schema that the user belongs to.
        expr: USER_SCHEMA_ID
        data_type: NUMBER(38,0)
    filters:
      - name: AdminQueries
        synonyms:
          - admin queries
          - administrator queries
          - privileged queries
          - system admin queries
        description: A filter for queries executed by administrative roles, important for security and governance monitoring.
        expr: ROLE_NAME IN ('ACCOUNTADMIN', 'SECURITYADMIN', 'SYSADMIN')
      - name: AutomatedQueries
        synonyms:
          - automated queries
          - background queries
          - scheduled queries
          - system queries
        description: A filter for queries generated by client applications rather than written manually by users.
        expr: IS_CLIENT_GENERATED_STATEMENT = TRUE
      - name: CacheOptimizedQueries
        synonyms:
          - cache hit queries
          - cached queries
          - efficient queries
          - optimized queries
        description: A filter for queries with high cache utilization (>50%), indicating good performance optimization.
        expr: PERCENTAGE_SCANNED_FROM_CACHE > 0.5
      - name: DataModificationQueries
        synonyms:
          - data modification queries
          - DML queries
          - update queries
          - write queries
        description: A filter for queries that modified data (INSERT, UPDATE, DELETE operations), crucial for data governance tracking.
        expr: QUERY_TYPE IN ('INSERT', 'UPDATE', 'DELETE', 'MERGE') OR ROWS_INSERTED > 0 OR ROWS_UPDATED > 0 OR ROWS_DELETED > 0
      - name: ExpensiveQueries
        synonyms:
          - costly queries
          - expensive queries
          - high cost queries
          - high credit queries
        description: A filter for queries that consumed significant cloud service credits, indicating resource-intensive operations.
        expr: CREDITS_USED_CLOUD_SERVICES > 0.001
      - name: FailedQueries
        synonyms:
          - errored queries
          - failed jobs
          - queries with errors
          - unsuccessful queries
        description: A filter that includes only queries that did not complete successfully and resulted in an error.
        expr: ERROR_CODE IS NOT NULL
      - name: LargeDataScanQueries
        synonyms:
          - big data queries
          - data intensive queries
          - high volume scans
          - large scan queries
        description: A filter for queries that scanned more than 1GB of data, indicating potentially inefficient data access patterns.
        expr: BYTES_SCANNED > 1073741824
      - name: LongRunningQueries
        synonyms:
          - lengthy queries
          - long running queries
          - slow queries
          - time consuming queries
        description: A filter for queries that took more than 5 minutes to execute, useful for performance optimization analysis.
        expr: TOTAL_ELAPSED_TIME > 300000
      - name: MemorySpillQueries
        synonyms:
          - disk spill queries
          - memory intensive queries
          - memory spill queries
          - spill queries
        description: A filter for queries that spilled data to local or remote storage due to memory constraints, indicating potential optimization opportunities.
        expr: BYTES_SPILLED_TO_LOCAL_STORAGE > 0 OR BYTES_SPILLED_TO_REMOTE_STORAGE > 0
      - name: QueuedQueries
        synonyms:
          - backlogged queries
          - queued jobs
          - waiting queries
        description: A filter that includes only queries that had to wait for warehouse compute resources to become available before executing.
        expr: QUEUED_OVERLOAD_TIME > 0
      - name: RecentQueries
        synonyms:
          - current queries
          - latest queries
          - recent queries
          - today's queries
        description: A filter for queries executed in the last 24 hours, useful for current operational analysis.
        expr: START_TIME >= CURRENT_TIMESTAMP - INTERVAL '1 DAY'
    metrics:
      - name: AverageExecutionTimeInSeconds
        synonyms:
          - average query time
          - avg query duration
          - mean execution time
        description: The average time, in seconds, from when a query was submitted to when it completed. Includes any queuing time.
        expr: AVG(TOTAL_ELAPSED_TIME / 1000)
      - name: AverageQueueWaitTimeSeconds
        synonyms:
          - average queue time
          - average queuing delay
          - avg wait time
          - mean queue duration
        description: The average time, in seconds, that queries spent waiting in queue due to overload or provisioning delays.
        expr: AVG((QUEUED_OVERLOAD_TIME + QUEUED_PROVISIONING_TIME) / 1000)
      - name: CacheHitPercentage
        synonyms:
          - cache hit percentage
          - cache hit rate
          - cache utilization rate
          - percentage cached
        description: The percentage of data that was served from cache rather than storage, indicating query optimization efficiency.
        expr: AVG(PERCENTAGE_SCANNED_FROM_CACHE) * 100
      - name: DataModificationVolumeGB
        synonyms:
          - data changed volume
          - data modification volume
          - DML data volume
          - gigabytes modified
        description: The total volume of data, in gigabytes (GB), that was inserted, updated, or deleted by queries, crucial for data governance tracking.
        expr: SUM((BYTES_WRITTEN + COALESCE(BYTES_DELETED, 0)) / POWER(1024, 3))
      - name: FailureRate
        synonyms:
          - error rate
          - failure percentage
          - query failure rate
          - unsuccessful query rate
        description: The percentage of queries that failed with errors, indicating system stability and query quality.
        expr: (COUNT(CASE WHEN ERROR_CODE IS NOT NULL THEN 1 END) * 100.0) / COUNT(*)
      - name: QueryThroughputPerHour
        synonyms:
          - hourly query rate
          - queries per hour
          - query throughput
          - query volume per hour
        description: The average number of queries executed per hour, providing insight into system utilization and workload patterns.
        expr: COUNT(*) / (DATEDIFF(HOUR, MIN(START_TIME), MAX(START_TIME)) + 1)
      - name: TotalCreditsConsumed
        synonyms:
          - cloud services credits consumed
          - serverless credits spent
          - total serverless consumption
          - total serverless credits used
        description: The total amount of serverless/cloud services credits consumed by queries (NOT warehouse compute credits). This measures serverless feature usage, not main compute costs.
        expr: SUM(CREDITS_USED_CLOUD_SERVICES)
      - name: TotalDataScannedGB
        synonyms:
          - data volume scanned
          - gigabytes scanned
          - total scanned data
        description: |+
          The total volume of data, in gigabytes (GB), read from storage by queries.

        expr: SUM(BYTES_SCANNED / POWER(1024, 3))
    primary_key:
      columns:
        - QUERY_ID
  - name: QUERY_ATTRIBUTION_HISTORY
    synonyms:
      - query costs
      - query cost attribution
      - per-query costs
      - query compute costs
      - attributed costs
      - query cost analysis
      - query optimization costs
      - expensive queries
      - query cost optimization
    description: PRIMARY TABLE for all query cost analysis and optimization questions. Provides per-query compute cost attribution for warehouse usage. Contains CREDITS_ATTRIBUTED_COMPUTE which shows actual compute credits consumed by individual queries (excluding warehouse idle time). This is the ONLY reliable source for understanding individual query costs, cost optimization, and query expense analysis. Use this table for any question about "query costs", "expensive queries", or "cost per query". Data available from mid-August 2024 with up to 8-hour latency.
    base_table:
      database: SNOWFLAKE
      schema: ACCOUNT_USAGE
      table: QUERY_ATTRIBUTION_HISTORY
    dimensions:
      - name: PARENT_QUERY_ID
        synonyms:
          - parent query id
          - parent query
          - calling query id
          - parent execution
        description: Query ID of the parent query if this query was called by another query (e.g., from a stored procedure), NULL if this is a top-level query.
        expr: PARENT_QUERY_ID
        data_type: VARCHAR(16777216)
      - name: QUERY_HASH
        synonyms:
          - query hash
          - query fingerprint
          - query signature
          - canonical query hash
        description: Hash value computed based on the canonicalized SQL text, useful for identifying similar queries regardless of literal values.
        expr: QUERY_HASH
        data_type: VARCHAR(16777216)
      - name: QUERY_ID
        synonyms:
          - query id
          - query identifier
          - execution id
          - query uuid
        description: Unique identifier for the SQL statement execution, used to link with QUERY_HISTORY for additional query details.
        expr: QUERY_ID
        data_type: VARCHAR(16777216)
      - name: QUERY_PARAMETERIZED_HASH
        synonyms:
          - parameterized hash
          - query template hash
          - normalized query hash
          - pattern hash
        description: Hash value computed based on the parameterized query structure, allowing grouping of queries with the same pattern but different parameter values.
        expr: QUERY_PARAMETERIZED_HASH
        data_type: VARCHAR(16777216)
      - name: QUERY_TAG
        synonyms:
          - query tag
          - query metadata
          - query context
          - query origin
        description: Query tag set for this statement through the QUERY_TAG session parameter, useful for tracking query sources and applications.
        expr: QUERY_TAG
        data_type: VARCHAR(16777216)
      - name: ROOT_QUERY_ID
        synonyms:
          - root query id
          - top level query
          - root query
          - originating query
        description: Query ID of the topmost query in a hierarchical chain (useful for stored procedures with multiple sub-queries), NULL if this is a top-level query.
        expr: ROOT_QUERY_ID
        data_type: VARCHAR(16777216)
      - name: USER_NAME
        synonyms:
          - user
          - username
          - query executor
          - who ran
          - executed by
        description: User who issued the query and is responsible for the attributed compute costs.
        expr: USER_NAME
        data_type: VARCHAR(16777216)
      - name: WAREHOUSE_NAME
        synonyms:
          - warehouse
          - compute warehouse
          - virtual warehouse
          - compute resource
        description: Name of the warehouse where the query executed and consumed compute credits.
        expr: WAREHOUSE_NAME
        data_type: VARCHAR(16777216)
    time_dimensions:
      - name: END_TIME
        synonyms:
          - end time
          - completion time
          - query end time
          - finished at
        description: Timestamp when query execution ended (in local time zone), useful for calculating query duration and cost per minute.
        expr: END_TIME
        data_type: TIMESTAMP_LTZ(6)
      - name: START_TIME
        synonyms:
          - start time
          - query start time
          - execution start
          - initiated at
        description: Timestamp when query execution started (in local time zone), used for cost attribution time analysis.
        expr: START_TIME
        data_type: TIMESTAMP_LTZ(6)
    facts:
      - name: CREDITS_ATTRIBUTED_COMPUTE
        synonyms:
          - attributed compute credits
          - query compute cost
          - attributed credits
          - query cost credits
          - compute credits used
        description: Number of compute credits attributed to this specific query execution. This is the PRIMARY measure for individual query costs, includes compute usage but excludes warehouse idle time, cloud services, data transfer, and storage costs.
        expr: CREDITS_ATTRIBUTED_COMPUTE
        data_type: NUMBER(38,9)
      - name: CREDITS_USED_QUERY_ACCELERATION
        synonyms:
          - query acceleration credits
          - acceleration credits
          - QAS credits
          - query acceleration cost
        description: Number of credits consumed by the Query Acceleration Service to accelerate this query. NULL if query was not accelerated. Total query cost is the sum of this and CREDITS_ATTRIBUTED_COMPUTE.
        expr: CREDITS_USED_QUERY_ACCELERATION
        data_type: NUMBER(38,9)
      - name: WAREHOUSE_ID
        synonyms:
          - warehouse id
          - warehouse identifier
          - compute id
        description: Internal system-generated identifier for the warehouse that executed the query.
        expr: WAREHOUSE_ID
        data_type: NUMBER(38,0)
    filters:
      - name: AcceleratedQueries
        synonyms:
          - accelerated queries
          - QAS queries
          - query acceleration queries
          - accelerated executions
        description: A filter for queries that used Query Acceleration Service, incurring additional acceleration credits beyond base compute costs.
        expr: CREDITS_USED_QUERY_ACCELERATION > 0
      - name: ExpensiveAttributedQueries
        synonyms:
          - expensive queries
          - high cost queries
          - costly attributed queries
          - expensive compute queries
        description: A filter for queries with high compute credit attribution (>0.1 credits), useful for identifying the most expensive individual query executions.
        expr: CREDITS_ATTRIBUTED_COMPUTE > 0.1
      - name: HighCostPerMinuteQueries
        synonyms:
          - high cost rate queries
          - expensive per minute queries
          - high burn rate queries
          - cost intensive queries
        description: A filter for queries with high cost per minute of execution, indicating potentially inefficient resource usage patterns.
        expr: CREDITS_ATTRIBUTED_COMPUTE > 0.01 AND (DATEDIFF(SECOND, START_TIME, END_TIME) / 60.0) > 0 AND (CREDITS_ATTRIBUTED_COMPUTE / (DATEDIFF(SECOND, START_TIME, END_TIME) / 60.0)) > 0.1
      - name: LowCostQueries
        synonyms:
          - low cost queries
          - inexpensive queries
          - minimal cost queries
          - cheap executions
        description: A filter for queries with minimal compute credit attribution (<0.01 credits), useful for identifying efficient query patterns.
        expr: CREDITS_ATTRIBUTED_COMPUTE > 0 AND CREDITS_ATTRIBUTED_COMPUTE <= 0.01
      - name: MonthlyAttributedQueries
        synonyms:
          - monthly queries
          - current month queries
          - monthly cost attribution
          - month to date queries
        description: A filter for queries with cost attribution from the current month, useful for monthly budget tracking and cost analysis.
        expr: START_TIME >= DATE_TRUNC('MONTH', CURRENT_DATE)
      - name: RecentAttributedQueries
        synonyms:
          - recent queries
          - latest cost attribution
          - current query costs
          - today's attributed queries
        description: A filter for queries with cost attribution from the last 24 hours, useful for current cost monitoring and analysis.
        expr: START_TIME >= CURRENT_TIMESTAMP - INTERVAL '1 DAY'
      - name: StoredProcedureQueries
        synonyms:
          - stored procedure queries
          - hierarchical queries
          - procedure executions
          - multi-level queries
        description: A filter for queries that are part of stored procedures or have hierarchical relationships (parent/child queries).
        expr: PARENT_QUERY_ID IS NOT NULL OR ROOT_QUERY_ID IS NOT NULL
      - name: WeeklyAttributedQueries
        synonyms:
          - weekly queries
          - past week queries
          - 7 day attributed queries
          - weekly cost attribution
        description: A filter for queries with cost attribution from the past week, useful for weekly cost analysis and trending.
        expr: START_TIME >= CURRENT_TIMESTAMP - INTERVAL '7 DAYS'
    metrics:
      - name: AverageAttributedCreditsPerQuery
        synonyms:
          - average query cost
          - avg attributed credits
          - mean query cost
          - typical query cost
        description: The average compute credits attributed per query execution, useful for understanding typical query cost patterns and identifying cost outliers.
        expr: AVG(CREDITS_ATTRIBUTED_COMPUTE)
      - name: CostPerUserRate
        synonyms:
          - cost per user
          - user cost attribution
          - per user spend
          - user cost rate
        description: The average compute credits attributed per unique user, useful for understanding cost distribution across users and chargeback analysis.
        expr: SUM(CREDITS_ATTRIBUTED_COMPUTE) / COUNT(DISTINCT USER_NAME)
      - name: DailyCostTrend
        synonyms:
          - daily cost trend
          - daily attributed credits
          - daily query costs
          - daily spend rate
        description: The daily rate of compute credits attributed to queries, useful for tracking cost trends and budget planning over time.
        expr: SUM(CREDITS_ATTRIBUTED_COMPUTE) / (DATEDIFF(DAY, MIN(START_TIME), MAX(START_TIME)) + 1)
      - name: HighCostQueryPercentage
        synonyms:
          - expensive query rate
          - high cost query percentage
          - costly query ratio
          - expensive execution rate
        description: The percentage of queries that consumed significant compute credits (>0.1), indicating the proportion of high-impact executions.
        expr: (COUNT(CASE WHEN CREDITS_ATTRIBUTED_COMPUTE > 0.1 THEN 1 END) * 100.0) / COUNT(*)
      - name: QueryAccelerationAdoptionRate
        synonyms:
          - acceleration adoption rate
          - QAS usage rate
          - acceleration percentage
          - queries using acceleration
        description: The percentage of queries that used Query Acceleration Service, indicating adoption of performance optimization features.
        expr: (COUNT(CASE WHEN CREDITS_USED_QUERY_ACCELERATION > 0 THEN 1 END) * 100.0) / COUNT(*)
      - name: TotalAttributedCredits
        synonyms:
          - total query costs
          - total attributed credits
          - total compute costs
          - sum of query costs
        description: The total compute credits attributed to queries, representing the actual cost of query execution excluding warehouse idle time. This is the primary metric for understanding query-level cost consumption.
        expr: SUM(CREDITS_ATTRIBUTED_COMPUTE)
      - name: TotalQueryAccelerationCredits
        synonyms:
          - total acceleration costs
          - total QAS credits
          - acceleration credit consumption
          - query acceleration spend
        description: The total credits consumed by Query Acceleration Service across all accelerated queries, indicating investment in query performance optimization.
        expr: SUM(CREDITS_USED_QUERY_ACCELERATION)
      - name: TotalQueryCostWithAcceleration
        synonyms:
          - total query cost including acceleration
          - complete query cost
          - full attributed cost
          - total execution cost
        description: The total cost of query execution including both compute credits and query acceleration credits, providing the complete cost picture for optimized queries.
        expr: SUM(CREDITS_ATTRIBUTED_COMPUTE + COALESCE(CREDITS_USED_QUERY_ACCELERATION, 0))
    primary_key:
      columns:
        - QUERY_ID
  - name: QUERY_INSIGHTS
    synonyms:
      - query analysis
      - query performance
      - query stats
    description: Provides insights into query performance, including statistics on query queuing, compilation, and execution. Useful for identifying performance bottlenecks and optimization opportunities.
    base_table:
      database: SNOWFLAKE
      schema: ACCOUNT_USAGE
      table: QUERY_INSIGHTS
    dimensions:
      - name: INSIGHT_TOPIC
        synonyms:
          - insight topic
          - optimization topic
          - performance insight
        description: The type of insight provided by the query, in this case, a table scan, which indicates that the query is scanning the entire table to retrieve data, rather than using an index or other optimization.
        expr: INSIGHT_TOPIC
        data_type: VARCHAR(16777216)
        sample_values:
          - TABLE_SCAN
      - name: IS_OPPORTUNITY
        synonyms:
          - improvement opportunity
          - is opportunity
          - optimization opportunity
        description: Indicates whether the query is related to an opportunity, such as a sales or business development opportunity, as opposed to a regular query.
        expr: IS_OPPORTUNITY
        data_type: BOOLEAN
        sample_values:
          - 'TRUE'
      - name: MESSAGE
        synonyms:
          - insight message
          - message
          - performance message
        description: This column provides insights into potential performance issues with SQL queries, specifically highlighting inefficient WHERE clauses that do not significantly reduce the number of rows returned from a table, resulting in unnecessary data scanning and potential performance degradation.
        expr: MESSAGE
        data_type: OBJECT
        sample_values:
          - |-
            {
              "filter_selectivity": "0.909690",
              "message": "A SELECT statement in this query has a WHERE clause that does not significantly reduce the rows returned from table ORDER_HEADER.",
              "provided_filters": "NOT(MEET_CONDITION.ORDER_AMOUNT >= (FIXED_TO_FIXED(0 AS NUMBER(38,4)[UNKNOWN]))), NOT(MEET_CONDITION.ORDER_AMOUNT <= (FIXED_TO_FIXED(10 AS NUMBER(38,4)[UNKNOWN])))",
              "row_count": "248201269",
              "table": "ORDER_HEADER"
            }
          - |-
            {
              "message": "A SELECT statement in this query has a WHERE clause that has no effect, which results in scanning a large amount of data from table ORDER_HEADER.",
              "provided_filters": "ORDER_HEADER.TRUCK_ID IS NOT NULL",
              "row_count": 2.482012690000000e+08,
              "table": "ORDER_HEADER"
            }
          - |-
            {
              "message": "A SELECT statement in this query has a WHERE clause that has no effect, which results in scanning a large amount of data from table ORDER_HEADER.",
              "provided_filters": "ORDER_HEADER.LOCATION_ID IS NOT NULL",
              "row_count": 2.482012690000000e+08,
              "table": "ORDER_HEADER"
            }
      - name: QUERY_ID
        synonyms:
          - execution id
          - query id
          - query identifier
        description: Unique identifier for a query, used to track and analyze query performance and behavior.
        expr: QUERY_ID
        data_type: VARCHAR(16777216)
        sample_values:
          - 01be00b5-030e-321d-0035-478704068422
          - 01be00b5-030e-321d-0035-478704068406
          - 01be00b4-030e-321d-0035-478704065f06
      - name: SUGGESTIONS
        synonyms:
          - optimization suggestions
          - performance recommendations
          - suggestions
        description: Suggestions for optimizing query performance.
        expr: SUGGESTIONS
        data_type: ARRAY
        sample_values:
          - |-
            [
              "Adding a WHERE clause could speed up this query by reducing the amount of data that it scans."
            ]
          - |-
            [
              "Making this WHERE condition more selective or adding another condition could speed up this query by reducing the amount of data that it reads. "
            ]
          - |-
            [
              "Adding another WHERE condition or making this condition more selective could speed up this query by reducing the amount of data that it reads. "
            ]
      - name: WAREHOUSE_NAME
        synonyms:
          - compute warehouse
          - virtual warehouse
          - warehouse
        description: The name of the warehouse where the query was executed.
        expr: WAREHOUSE_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - TASTY_BYTES_DBT_WH
          - PUBLIC_WH
    time_dimensions:
      - name: END_TIME
        synonyms:
          - completion time
          - end time
          - finished at
        description: The timestamp when the query execution was completed.
        expr: END_TIME
        data_type: TIMESTAMP_LTZ(9)
        sample_values:
          - 2025-09-04T15:55:50.530+0000
          - 2025-09-04T15:56:00.797+0000
          - 2025-09-04T16:29:00.356+0000
      - name: START_TIME
        synonyms:
          - began at
          - initiation time
          - start time
        description: The timestamp when the query was initiated, representing the start time of the query execution.
        expr: START_TIME
        data_type: TIMESTAMP_LTZ(9)
        sample_values:
          - 2025-07-29T01:57:48.264+0000
          - 2025-07-29T01:57:46.499+0000
          - 2025-07-29T01:56:59.292+0000
    facts:
      - name: TOTAL_ELAPSED_TIME
        synonyms:
          - total duration
          - total elapsed time
          - total runtime
        description: The total time taken to complete a query, measured in milliseconds.
        expr: TOTAL_ELAPSED_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '1634'
          - '2608'
          - '1749'
      - name: WAREHOUSE_ID
        description: Unique identifier for the warehouse where the inventory is stored.
        expr: WAREHOUSE_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '249'
          - '192'
    filters:
      - name: FilterEfficiencyInsights
        synonyms:
          - filter efficiency insights
          - filter performance issues
          - selectivity insights
          - WHERE clause insights
        description: A filter for insights related to inefficient WHERE clauses and filter selectivity problems.
        expr: TO_VARCHAR(MESSAGE) ILIKE '%WHERE clause%' OR TO_VARCHAR(MESSAGE) ILIKE '%filter%' OR TO_VARCHAR(MESSAGE) ILIKE '%selectivity%'
      - name: HighImpactInsights
        synonyms:
          - critical insights
          - high impact insights
          - important insights
          - major performance issues
        description: A filter for insights with high potential performance impact, focusing on critical optimization opportunities.
        expr: TO_VARCHAR(MESSAGE) ILIKE '%large amount of data%' OR TO_VARCHAR(MESSAGE) ILIKE '%significantly reduce%' OR TO_VARCHAR(MESSAGE) ILIKE '%no effect%'
      - name: LongRunningQueryInsights
        synonyms:
          - duration insights
          - long query insights
          - performance bottleneck insights
          - slow query insights
        description: A filter for insights related to queries with extended execution times requiring optimization.
        expr: QUERY_ID IN (SELECT QUERY_ID FROM SNOWFLAKE.ACCOUNT_USAGE.QUERY_HISTORY WHERE TOTAL_ELAPSED_TIME > 300000)
      - name: OptimizationOpportunities
        synonyms:
          - improvement opportunities
          - optimization opportunities
          - performance opportunities
          - tuning opportunities
        description: A filter for query insights that represent optimization opportunities for better performance.
        expr: IS_OPPORTUNITY = TRUE
      - name: RecentInsights
        synonyms:
          - current insights
          - latest insights
          - recent insights
          - today's insights
        description: A filter for query insights generated in the last 7 days for current performance analysis.
        expr: START_TIME >= CURRENT_TIMESTAMP - INTERVAL '7 DAYS'
      - name: TableScanInsights
        synonyms:
          - full table scans
          - scan performance issues
          - table scan insights
          - table scan warnings
        description: A filter for insights related to table scan performance issues and optimization recommendations.
        expr: INSIGHT_TOPIC = 'TABLE_SCAN'
      - name: WeeklyInsights
        synonyms:
          - 7 day insights
          - last week insights
          - past week insights
          - weekly insights
        description: A filter for query insights from the past week for performance trend analysis.
        expr: START_TIME >= CURRENT_TIMESTAMP - INTERVAL '1 WEEK' AND START_TIME < CURRENT_TIMESTAMP - INTERVAL '1 DAY'
    metrics:
      - name: AverageInsightsPerQuery
        synonyms:
          - average insights
          - insight density
          - insights per query
          - query insight ratio
        description: The average number of performance insights generated per unique query, indicating query complexity and optimization potential.
        expr: COUNT(*) / COUNT(DISTINCT QUERY_ID)
      - name: CriticalInsightPercentage
        synonyms:
          - critical insight rate
          - critical performance rate
          - high impact insight rate
          - severe issue percentage
        description: The percentage of insights that indicate critical performance issues requiring immediate attention.
        expr: (COUNT(CASE WHEN TO_VARCHAR(MESSAGE) ILIKE '%large amount of data%' OR TO_VARCHAR(MESSAGE) ILIKE '%no effect%' THEN 1 END) * 100.0) / COUNT(*)
      - name: OptimizationOpportunityPercentage
        synonyms:
          - improvement opportunity rate
          - optimization percentage
          - optimization rate
          - performance opportunity rate
        description: The percentage of query insights that represent optimization opportunities, indicating the potential for performance improvements.
        expr: (COUNT(CASE WHEN IS_OPPORTUNITY = TRUE THEN 1 END) * 100.0) / COUNT(*)
      - name: RecentInsightTrend
        synonyms:
          - insight trend
          - insight velocity
          - performance trend
          - recent insight growth
        description: The daily rate of new insights being generated, indicating system performance trends and optimization needs.
        expr: COUNT(*) / (DATEDIFF(DAY, MIN(START_TIME), MAX(START_TIME)) + 1)
      - name: TableScanFrequency
        synonyms:
          - full scan frequency
          - scan frequency
          - table scan percentage
          - table scan rate
        description: The percentage of insights related to table scans, highlighting queries that may benefit from indexing or filtering optimizations.
        expr: (COUNT(CASE WHEN INSIGHT_TOPIC = 'TABLE_SCAN' THEN 1 END) * 100.0) / COUNT(*)
    primary_key:
      columns:
        - QUERY_ID
  - name: WAREHOUSE_LOAD_HISTORY
    synonyms:
      - query load
      - warehouse performance
      - warehouse queuing
    description: Shows the query load on each virtual warehouse over 5-minute intervals, detailing the number of running versus queued queries. Essential for identifying warehouse performance issues and sizing.
    base_table:
      database: SNOWFLAKE
      schema: ACCOUNT_USAGE
      table: WAREHOUSE_LOAD_HISTORY
    dimensions:
      - name: WAREHOUSE_NAME
        synonyms:
          - compute resource
          - compute warehouse
          - virtual warehouse
          - warehouse
        description: The name of the warehouse where the data was loaded from.
        expr: WAREHOUSE_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - XSMALL_WH
          - MDH_3XL
          - BI_MEDIUM_WH
    time_dimensions:
      - name: END_TIME
        synonyms:
          - completion time
          - end time
          - finished at
        description: The date and time when the warehouse load process was completed.
        expr: END_TIME
        data_type: TIMESTAMP_LTZ(9)
        sample_values:
          - 2024-09-17T12:10:00.000+0000
          - 2024-09-17T11:15:00.000+0000
          - 2024-09-17T12:50:00.000+0000
      - name: START_TIME
        synonyms:
          - began at
          - initiation time
          - start time
        description: The date and time when the warehouse load process started.
        expr: START_TIME
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2024-09-17T12:05:00.000+0000
          - 2024-09-17T11:10:00.000+0000
          - 2024-09-16T19:45:00.000+0000
    facts:
      - name: AVG_BLOCKED
        synonyms:
          - average blocked time
          - avg blocked
          - blocked duration
        description: Average time a warehouse load was blocked, in hours.
        expr: AVG_BLOCKED
        data_type: NUMBER(38,9)
        sample_values:
          - '0.092220000'
          - '0.000883333'
          - '0.003950000'
      - name: AVG_QUEUED_LOAD
        synonyms:
          - average queued load
          - avg queued
          - queue time
        description: The average time, in hours, that loads were queued before being processed in the warehouse.
        expr: AVG_QUEUED_LOAD
        data_type: NUMBER(38,9)
        sample_values:
          - '0.001453333'
          - '0.003680000'
          - '0.000000000'
      - name: AVG_QUEUED_PROVISIONING
        synonyms:
          - average queued provisioning
          - avg provisioning wait
          - provisioning queue time
        description: The average time, in minutes, that provisioning requests for warehouse loads spent in a queued state before being processed.
        expr: AVG_QUEUED_PROVISIONING
        data_type: NUMBER(38,9)
        sample_values:
          - '0.000870000'
          - '0.000303333'
          - '0.000000000'
      - name: AVG_RUNNING
        synonyms:
          - average running time
          - avg running
          - execution duration
        description: Average time spent running warehouse loads.
        expr: AVG_RUNNING
        data_type: NUMBER(38,9)
        sample_values:
          - '0.158303333'
          - '0.001710000'
          - '0.036586667'
      - name: WAREHOUSE_ID
        synonyms:
          - compute id
          - warehouse id
          - warehouse identifier
        description: Unique identifier for the warehouse where the load was processed.
        expr: WAREHOUSE_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '50'
          - '49'
          - '39'
    filters:
      - name: BlockedQueries
        synonyms:
          - blocked queries
          - blocked warehouses
          - query blocking
          - transaction blocking
        description: A filter for warehouse time periods experiencing query blocking due to locks or transactions.
        expr: AVG_BLOCKED > 0
      - name: HighLoadWarehouses
        synonyms:
          - busy warehouses
          - heavily utilized warehouses
          - high load warehouses
          - overloaded warehouses
        description: A filter for warehouse time periods with high average running query loads.
        expr: AVG_RUNNING > 0.1
      - name: IdleWarehouses
        synonyms:
          - idle warehouses
          - inactive warehouses
          - unused warehouses
          - zero load warehouses
        description: A filter for warehouse time periods with no query activity or load.
        expr: AVG_RUNNING = 0 AND AVG_QUEUED_LOAD = 0 AND AVG_BLOCKED = 0
      - name: PeakHours
        synonyms:
          - business hours
          - high usage hours
          - peak hours
          - prime time
        description: A filter for warehouse performance during typical business hours (8 AM to 6 PM) for peak usage analysis.
        expr: HOUR(START_TIME) BETWEEN 8 AND 18
      - name: QueueingWarehouses
        synonyms:
          - backlogged warehouses
          - congested warehouses
          - queuing warehouses
          - warehouses with waits
        description: A filter for warehouses experiencing significant query queuing due to load or provisioning delays.
        expr: AVG_QUEUED_LOAD > 0 OR AVG_QUEUED_PROVISIONING > 0
      - name: RecentPerformance
        synonyms:
          - current performance
          - latest performance
          - recent performance
          - today's performance
        description: A filter for warehouse performance data from the last 24 hours for current operational monitoring.
        expr: START_TIME >= CURRENT_TIMESTAMP - INTERVAL '1 DAY'
      - name: WeekdayPerformance
        synonyms:
          - business day performance
          - Monday to Friday performance
          - weekday performance
          - workday performance
        description: A filter for warehouse performance during business days (Monday-Friday) for operational analysis.
        expr: DAYOFWEEK(START_TIME) BETWEEN 2 AND 6
      - name: WeekendPerformance
        synonyms:
          - off hours performance
          - Saturday Sunday performance
          - weekend load
          - weekend performance
        description: A filter for warehouse performance during weekends for off-hours analysis.
        expr: DAYOFWEEK(START_TIME) IN (1, 7)
    metrics:
      - name: AverageWarehouseUtilization
        synonyms:
          - average utilization
          - utilization percentage
          - warehouse efficiency
          - warehouse utilization rate
        description: The average percentage of time warehouses are actively running queries, indicating overall resource utilization efficiency.
        expr: AVG(AVG_RUNNING) * 100
      - name: BlockingIncidentRate
        synonyms:
          - blocking incident rate
          - blocking rate
          - contention rate
          - query blocking frequency
        description: The percentage of time periods experiencing query blocking, indicating potential concurrency issues.
        expr: (COUNT(CASE WHEN AVG_BLOCKED > 0 THEN 1 END) * 100.0) / COUNT(*)
      - name: LoadVarianceCoefficient
        synonyms:
          - load consistency
          - load variability
          - usage stability
          - utilization variance
        description: The coefficient of variation for warehouse loads, indicating how consistent or variable the workload patterns are.
        expr: (STDDEV(AVG_RUNNING) / NULLIF(AVG(AVG_RUNNING), 0)) * 100
      - name: PeakLoadCapacity
        synonyms:
          - highest load
          - maximum utilization
          - peak capacity
          - peak load
        description: The maximum average running load observed across all warehouses, indicating peak capacity requirements.
        expr: MAX(AVG_RUNNING)
      - name: ProvisioningDelayRate
        synonyms:
          - provisioning delay rate
          - provisioning wait rate
          - scale-up delay rate
          - startup delay frequency
        description: The percentage of time periods with provisioning delays, indicating auto-scaling effectiveness.
        expr: (COUNT(CASE WHEN AVG_QUEUED_PROVISIONING > 0 THEN 1 END) * 100.0) / COUNT(*)
      - name: QueueEfficiencyRate
        synonyms:
          - queue effectiveness
          - queue efficiency
          - queuing performance
          - wait efficiency
        description: The percentage of time with minimal queuing delays, indicating how well warehouse capacity meets demand.
        expr: (COUNT(CASE WHEN AVG_QUEUED_LOAD + AVG_QUEUED_PROVISIONING <= 0.1 THEN 1 END) * 100.0) / COUNT(*)
      - name: WarehouseIdlePercentage
        synonyms:
          - idle time percentage
          - idle warehouse rate
          - unused capacity rate
          - unutilized time
        description: The percentage of time warehouses have zero activity, indicating potential cost optimization opportunities.
        expr: (COUNT(CASE WHEN AVG_RUNNING = 0 THEN 1 END) * 100.0) / COUNT(*)
    primary_key:
      columns:
        - WAREHOUSE_ID
        - START_TIME
  - name: WAREHOUSE_METERING_HISTORY
    synonyms:
      - compute costs
      - credit usage
      - warehouse billing
      - warehouse costs
      - warehouse usage
    description: Hourly record of credit consumption for each virtual warehouse. This is the PRIMARY source for cost analysis in Snowflake - costs are incurred at warehouse level, not database level. Contains CREDITS_USED (total), CREDITS_USED_COMPUTE (compute), and CREDITS_USED_CLOUD_SERVICES (serverless features).
    base_table:
      database: SNOWFLAKE
      schema: ACCOUNT_USAGE
      table: WAREHOUSE_METERING_HISTORY
    dimensions:
      - name: WAREHOUSE_ID
        synonyms:
          - compute id
          - warehouse id
          - warehouse identifier
        description: ID or the warehouse
        expr: WAREHOUSE_ID
        data_type: VARCHAR(16777216)
      - name: WAREHOUSE_NAME
        synonyms:
          - compute resource
          - compute warehouse
          - virtual warehouse
          - warehouse
        description: The name of the warehouse where the metering data was collected.
        expr: WAREHOUSE_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - BUILD_UK_WAREHOUSE
          - DOC_AI_QS_WH
          - BI_MEDIUM_WH
    time_dimensions:
      - name: END_TIME
        synonyms:
          - completion time
          - end time
          - period end
        description: The date and time when the metering period ended, in ISO 8601 format.
        expr: END_TIME
        data_type: TIMESTAMP_LTZ(0)
        sample_values:
          - 2024-09-04T14:00:00.000+0000
          - 2024-09-05T20:00:00.000+0000
          - 2024-09-04T12:00:00.000+0000
      - name: START_TIME
        synonyms:
          - initiation time
          - period start
          - start time
        description: The date and time when the metering event started, in ISO 8601 format, with millisecond precision and UTC offset.
        expr: START_TIME
        data_type: TIMESTAMP_LTZ(0)
        sample_values:
          - 2024-09-04T12:00:00.000+0000
          - 2024-09-04T11:00:00.000+0000
          - 2024-09-04T13:00:00.000+0000
    facts:
      - name: CREDITS_ATTRIBUTED_COMPUTE_QUERIES
        synonyms:
          - attributed credits
          - compute query credits
          - query credits
        description: The total amount of credits attributed to compute queries for a given warehouse and time period.
        expr: CREDITS_ATTRIBUTED_COMPUTE_QUERIES
        data_type: NUMBER(38,9)
        sample_values:
          - '0.025555556'
          - '0.062222222'
          - '0.152222222'
      - name: CREDITS_USED
        synonyms:
          - credits consumed
          - credits used
          - total credits
        description: The total amount of credits consumed by a warehouse during a specific time period, typically measured in units of time (e.g. seconds, minutes, hours) and used to track and bill for warehouse usage.
        expr: CREDITS_USED
        data_type: NUMBER(38,9)
        sample_values:
          - '0.812202500'
          - '0.667001389'
          - '0.735866112'
      - name: CREDITS_USED_CLOUD_SERVICES
        synonyms:
          - cloud credits
          - cloud services credits
          - service credits
        description: The total amount of credits used for cloud services.
        expr: CREDITS_USED_CLOUD_SERVICES
        data_type: NUMBER(38,9)
        sample_values:
          - '0.003313611'
          - '0.000334722'
          - '0.000310556'
      - name: CREDITS_USED_COMPUTE
        synonyms:
          - compute credits
          - execution credits
          - warehouse credits
        description: The total amount of compute credits used by the warehouse during the metering period.
        expr: CREDITS_USED_COMPUTE
        data_type: NUMBER(38,9)
        sample_values:
          - '0.735555556'
          - '0.808888889'
          - '0.666666667'
    filters:
      - name: ActiveWarehouses
        synonyms:
          - active warehouses
          - consuming warehouses
          - running warehouses
          - utilized warehouses
        description: A filter for warehouses that consumed any credits during the time period.
        expr: CREDITS_USED > 0
      - name: CloudServicesHeavy
        synonyms:
          - cloud services heavy
          - cloud services intensive
          - high cloud services
          - service credit heavy
        description: A filter for warehouse periods with significant cloud services credit consumption.
        expr: CREDITS_USED_CLOUD_SERVICES > 0.01
      - name: HighCreditUsage
        synonyms:
          - costly warehouses
          - expensive warehouses
          - high consumption
          - high credit usage
        description: A filter for warehouse time periods with high credit consumption (>1 credit per hour).
        expr: CREDITS_USED > 1.0
      - name: LowUsageWarehouses
        synonyms:
          - light usage warehouses
          - low usage warehouses
          - minimal usage warehouses
          - underutilized warehouses
        description: A filter for warehouses with minimal credit consumption (less than 0.1 credits) that may be candidates for downsizing.
        expr: CREDITS_USED > 0 AND CREDITS_USED < 0.1
      - name: MonthlyHighUsage
        synonyms:
          - costly monthly usage
          - expensive monthly periods
          - high monthly consumption
          - monthly high usage
        description: A filter for warehouse periods in the current month with significant credit consumption for budget tracking.
        expr: START_TIME >= DATE_TRUNC('MONTH', CURRENT_DATE) AND CREDITS_USED > 10.0
      - name: PureComputeWarehouses
        synonyms:
          - compute focused warehouses
          - compute only warehouses
          - non-cloud services warehouses
          - pure compute warehouses
        description: A filter for warehouse usage periods with minimal cloud services overhead, focusing primarily on compute workloads.
        expr: CREDITS_USED_COMPUTE > 0 AND (CREDITS_USED_CLOUD_SERVICES = 0 OR CREDITS_USED_CLOUD_SERVICES / CREDITS_USED < 0.05)
      - name: RecentUsage
        synonyms:
          - current usage
          - latest usage
          - recent usage
          - today's usage
        description: A filter for warehouse credit usage from the last 24 hours for current cost monitoring.
        expr: START_TIME >= CURRENT_TIMESTAMP - INTERVAL '1 DAY'
      - name: WeekdayBusinessHours
        synonyms:
          - business hours usage
          - operational hours usage
          - prime time usage
          - weekday peak usage
        description: A filter for warehouse usage during typical business hours (8 AM to 6 PM, Monday-Friday) for operational cost analysis.
        expr: DAYOFWEEK(START_TIME) BETWEEN 2 AND 6 AND HOUR(START_TIME) BETWEEN 8 AND 18 AND CREDITS_USED > 0
      - name: WeekendUsage
        synonyms:
          - off hours usage
          - Saturday Sunday usage
          - weekend consumption
          - weekend usage
        description: A filter for warehouse credit usage during weekends for off-hours cost analysis.
        expr: DAYOFWEEK(START_TIME) IN (1, 7) AND CREDITS_USED > 0
    metrics:
      - name: ActiveWarehousePercentage
        synonyms:
          - active warehouse rate
          - consuming warehouse rate
          - utilization rate
          - warehouse usage rate
        description: The percentage of warehouse time periods that consumed any credits, indicating overall utilization.
        expr: (COUNT(CASE WHEN CREDITS_USED > 0 THEN 1 END) * 100.0) / COUNT(*)
      - name: AverageCostPerHour
        synonyms:
          - average hourly spend
          - cost per hour
          - hourly cost
          - hourly credit rate
        description: The average credits consumed per hour across all warehouse operations, useful for budgeting and cost planning.
        expr: SUM(CREDITS_USED) / (DATEDIFF(HOUR, MIN(START_TIME), MAX(START_TIME)) + 1)
      - name: CloudServicesOverheadPercentage
        synonyms:
          - cloud services percentage
          - non-compute cost ratio
          - overhead percentage
          - services cost ratio
        description: The percentage of total credits consumed by cloud services versus compute, indicating operational efficiency.
        expr: (SUM(CREDITS_USED_CLOUD_SERVICES) * 100.0) / NULLIF(SUM(CREDITS_USED), 0)
      - name: ComputeCostEfficiency
        synonyms:
          - compute cost ratio
          - compute efficiency
          - compute utilization
          - pure compute ratio
        description: The percentage of credits used for actual compute workloads, indicating cost efficiency.
        expr: (SUM(CREDITS_USED_COMPUTE) * 100.0) / NULLIF(SUM(CREDITS_USED), 0)
      - name: CostVariabilityCoefficient
        synonyms:
          - cost consistency
          - cost variability
          - spend variance
          - usage stability
        description: The coefficient of variation for credit consumption, indicating how consistent or variable spending patterns are.
        expr: (STDDEV(CREDITS_USED) / NULLIF(AVG(CREDITS_USED), 0)) * 100
      - name: PeakCostPeriod
        synonyms:
          - highest spend
          - maximum cost
          - peak cost
          - peak usage cost
        description: The maximum credits consumed in any single time period, indicating peak cost requirements.
        expr: MAX(CREDITS_USED)
      - name: TotalCreditsConsumed
        synonyms:
          - credit consumption
          - total cost
          - total credits consumed
          - total spend
        description: The total number of credits consumed across all warehouses, representing the overall cost of compute operations.
        expr: SUM(CREDITS_USED)
      - name: WeekendCostRatio
        synonyms:
          - non-business cost ratio
          - off-hours cost percentage
          - weekend cost ratio
          - weekend spend ratio
        description: The ratio of weekend to weekday costs, useful for understanding off-hours usage patterns and cost optimization.
        expr: SUM(CASE WHEN DAYOFWEEK(START_TIME) IN (1, 7) THEN CREDITS_USED ELSE 0 END) / NULLIF(SUM(CASE WHEN DAYOFWEEK(START_TIME) BETWEEN 2 AND 6 THEN CREDITS_USED ELSE 0 END), 0)
    primary_key:
      columns:
        - WAREHOUSE_ID
        - START_TIME
  - name: SCHEMATA
    synonyms:
      - schema list
    description: A catalog of all schemas within all databases in the account, including those that have been dropped. Provides metadata like schema name, database name, and creation date.
    base_table:
      database: SNOWFLAKE
      schema: ACCOUNT_USAGE
      table: SCHEMATA
    dimensions:
      - name: CATALOG_NAME
        synonyms:
          - catalog
          - catalog name
          - database
          - database name
        description: The name of the catalog or database that contains the schema.
        expr: CATALOG_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - BNY_DB
          - SNOWFLAKE_CONNECTOR_FOR_MYSQL
          - DEMO_DBT
      - name: COMMENT
        synonyms:
          - comment
          - description
          - schema comment
        description: A brief description of the schema, providing context for its purpose and the type of data it contains.
        expr: COMMENT
        data_type: VARCHAR(16777216)
        sample_values:
          - Schema for Raw Data Vault objects
          - Schema for Staging Area objects
      - name: DEFAULT_CHARACTER_SET_CATALOG
        synonyms:
          - character set catalog
          - charset catalog
          - encoding catalog
        description: The catalog name of the default character set.
        expr: DEFAULT_CHARACTER_SET_CATALOG
        data_type: VARCHAR(16777216)
      - name: DEFAULT_CHARACTER_SET_NAME
        synonyms:
          - character set name
          - charset name
          - encoding name
        description: The default character set name for the schema.
        expr: DEFAULT_CHARACTER_SET_NAME
        data_type: VARCHAR(16777216)
      - name: DEFAULT_CHARACTER_SET_SCHEMA
        synonyms:
          - character set schema
          - charset schema
          - encoding schema
        description: The schema that owns the default character set.
        expr: DEFAULT_CHARACTER_SET_SCHEMA
        data_type: VARCHAR(16777216)
      - name: IS_MANAGED_ACCESS
        synonyms:
          - access controlled
          - is managed
          - managed access
        description: Indicates whether the schema is managed by the database system or not. A value of 'NO' means the schema is not managed by the database system, implying that the schema is user-defined and managed by the user or application.
        expr: IS_MANAGED_ACCESS
        data_type: VARCHAR(3)
        sample_values:
          - 'NO'
      - name: IS_TRANSIENT
        synonyms:
          - is transient
          - temp schema
          - temporary
        description: Indicates whether the schema is temporary or not.
        expr: IS_TRANSIENT
        data_type: VARCHAR(3)
        sample_values:
          - 'NO'
      - name: OBJECT_VISIBILITY
        synonyms:
          - access visibility
          - object visibility
          - visibility
        description: Indicates whether the object is visible to the user, such as a table or view, or is an internal system object that is not visible to the user.
        expr: OBJECT_VISIBILITY
        data_type: OBJECT
      - name: OWNER_ROLE_TYPE
        synonyms:
          - owner role type
          - owner type
          - role type
        description: The type of role or entity that owns a schema, either a specific role or an application.
        expr: OWNER_ROLE_TYPE
        data_type: VARCHAR(13)
        sample_values:
          - ROLE
          - APPLICATION
      - name: REPLICABLE_WITH_FAILOVER_GROUPS
        synonyms:
          - failover groups
          - failover replicable
          - replication enabled
        description: Indicates whether the schema is replicable with failover groups.
        expr: REPLICABLE_WITH_FAILOVER_GROUPS
        data_type: VARCHAR(16777216)
        sample_values:
          - UNSET
      - name: SCHEMA_NAME
        synonyms:
          - namespace
          - schema
          - schema name
        description: The name of the database schema, which defines the logical grouping of related database objects such as tables, views, and stored procedures.
        expr: SCHEMA_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - SECURITY_ESSENTIALS
          - RAW_CUSTOMER
          - CUSTOMER_AGG
      - name: SCHEMA_OWNER
        synonyms:
          - created by
          - owner
          - schema owner
        description: The role that owns the schema.
        expr: SCHEMA_OWNER
        data_type: VARCHAR(16777216)
        sample_values:
          - ML_MODEL_ROLE
          - ACCOUNTADMIN
      - name: SCHEMA_TYPE
        synonyms:
          - schema category
          - schema kind
          - schema type
        description: The type of schema, either a standard schema or a versioned schema, where standard schema is a traditional schema that does not track changes over time, and versioned schema is a schema that tracks changes to the data over time, allowing for the management of different versions of the data.
        expr: SCHEMA_TYPE
        data_type: VARCHAR(9)
        sample_values:
          - STANDARD
          - VERSIONED
      - name: SQL_PATH
        synonyms:
          - file path
          - sql file
          - sql path
        description: The path to the SQL file that defines the schema.
        expr: SQL_PATH
        data_type: VARCHAR(16777216)
      - name: VERSION_NAME
        synonyms:
          - schema version
          - version
          - version name
        description: Version of the database schema.
        expr: VERSION_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - '39701_0'
          - '21800_0'
          - '55400_0'
    time_dimensions:
      - name: CREATED
        synonyms:
          - created
          - created date
          - creation time
        description: Date and time when the schema was created.
        expr: CREATED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2025-02-11T21:01:07.299+0000
          - 2025-05-20T00:25:01.060+0000
          - 2024-08-20T19:48:46.817+0000
      - name: DELETED
        synonyms:
          - deleted
          - deleted date
          - deletion time
        description: Date and time when a record was deleted.
        expr: DELETED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2023-11-27T20:38:02.322+0000
          - 2023-10-25T19:38:33.626+0000
      - name: LAST_ALTERED
        synonyms:
          - last altered
          - last modified
          - modified date
        description: Date and time when the schema was last modified.
        expr: LAST_ALTERED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2022-12-22T19:28:42.652+0000
          - 2025-02-21T17:35:50.014+0000
          - 2025-06-24T01:10:38.927+0000
    facts:
      - name: CATALOG_ID
        synonyms:
          - catalog id
          - catalog identifier
          - database id
        description: Unique identifier for the catalog that this schema belongs to.
        expr: CATALOG_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '181'
          - '94'
          - '223'
      - name: RETENTION_TIME
        synonyms:
          - retention period
          - retention time
          - time travel
        description: The amount of time, in minutes, that a record is retained in the system before it is automatically deleted or archived.
        expr: RETENTION_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '30'
          - '1'
      - name: SCHEMA_ID
        synonyms:
          - namespace id
          - schema id
          - schema identifier
        description: Unique identifier for a schema in the database.
        expr: SCHEMA_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '577'
          - '385'
          - '21'
      - name: VERSIONED_SCHEMA_ID
        synonyms:
          - schema version id
          - version id
          - versioned schema id
        description: Unique identifier for a versioned schema, used to track changes and updates to the schema over time.
        expr: VERSIONED_SCHEMA_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '287'
          - '776'
          - '254'
    filters:
      - name: ActiveSchemas
        synonyms:
          - active schemas
          - available schemas
          - current schemas
          - existing schemas
        description: A filter for schemas that have not been deleted and are currently available.
        expr: DELETED IS NULL
      - name: InformationSchemas
        synonyms:
          - information schemas
          - INFORMATION_SCHEMA schemas
          - metadata schemas
          - system schemas
        description: A filter for information schema objects that contain metadata about database objects.
        expr: SCHEMA_NAME = 'INFORMATION_SCHEMA'
      - name: LongRetentionSchemas
        synonyms:
          - extended retention schemas
          - fail-safe schemas
          - high retention schemas
          - long retention schemas
        description: A filter for schemas with retention time longer than standard 1 day, indicating important data preservation requirements.
        expr: RETENTION_TIME > 1
      - name: ManagedAccessSchemas
        synonyms:
          - controlled schemas
          - governed schemas
          - managed access schemas
          - restricted schemas
        description: A filter for schemas with managed access controls for enhanced security governance.
        expr: IS_MANAGED_ACCESS = 'YES'
      - name: PublicSchemas
        synonyms:
          - common schemas
          - default schemas
          - public schemas
          - PUBLIC schemas
        description: A filter for public schemas which are the default schema in databases.
        expr: SCHEMA_NAME = 'PUBLIC'
      - name: RecentlyCreatedSchemas
        synonyms:
          - fresh schemas
          - latest schemas
          - new schemas
          - recently created schemas
        description: A filter for schemas created in the last 30 days for tracking new schema development.
        expr: CREATED >= CURRENT_TIMESTAMP - INTERVAL '30 DAYS'
      - name: RecentlyModifiedSchemas
        synonyms:
          - altered schemas
          - changed schemas
          - recently modified schemas
          - updated schemas
        description: A filter for schemas that have been modified in the last 7 days for tracking schema changes.
        expr: LAST_ALTERED >= CURRENT_TIMESTAMP - INTERVAL '7 DAYS'
      - name: SystemOwnedSchemas
        synonyms:
          - built-in schemas
          - Snowflake owned schemas
          - system owned schemas
          - system schemas
        description: A filter for schemas owned by system roles rather than user-defined roles.
        expr: SCHEMA_OWNER IN ('ACCOUNTADMIN', 'SYSADMIN', 'SECURITYADMIN')
      - name: TransientSchemas
        synonyms:
          - non-persistent schemas
          - temp schemas
          - temporary schemas
          - transient schemas
        description: A filter for transient schemas that don't persist data permanently.
        expr: IS_TRANSIENT = 'YES'
    metrics:
      - name: ActiveSchemaPercentage
        synonyms:
          - active schema rate
          - available schema percentage
          - current schema percentage
          - non-deleted schema rate
        description: The percentage of schemas that are currently active and not deleted, indicating schema lifecycle management.
        expr: (COUNT(CASE WHEN DELETED IS NULL THEN 1 END) * 100.0) / COUNT(*)
      - name: AverageRetentionTimeDays
        synonyms:
          - average retention
          - average retention time
          - data retention period
          - retention policy average
        description: The average retention time in days across all schemas, indicating data governance and storage cost implications.
        expr: AVG(RETENTION_TIME)
      - name: ManagedAccessAdoptionRate
        synonyms:
          - controlled access percentage
          - governance adoption rate
          - managed access rate
          - managed schema rate
        description: The percentage of schemas using managed access controls, indicating security governance maturity.
        expr: (COUNT(CASE WHEN IS_MANAGED_ACCESS = 'YES' THEN 1 END) * 100.0) / COUNT(*)
      - name: SchemaCreationRate
        synonyms:
          - new schema velocity
          - schema creation rate
          - schema development rate
          - schema growth rate
        description: The daily rate of new schema creation, indicating database development activity and growth trends.
        expr: COUNT(CASE WHEN CREATED >= CURRENT_TIMESTAMP - INTERVAL '30 DAYS' THEN 1 END) / 30.0
      - name: TotalSchemaCount
        synonyms:
          - number of schemas
          - schema count
          - schema inventory
          - total schemas
        description: The total number of schemas in the account, providing insight into database organization complexity.
        expr: COUNT(*)
      - name: TransientSchemaRate
        synonyms:
          - non-persistent schema rate
          - temporary schema rate
          - transient percentage
          - transient schema percentage
        description: The percentage of schemas configured as transient, indicating data persistence strategy.
        expr: (COUNT(CASE WHEN IS_TRANSIENT = 'YES' THEN 1 END) * 100.0) / COUNT(*)
    primary_key:
      columns:
        - SCHEMA_NAME
  - name: ROLES
    synonyms:
      - security roles
      - user roles
    description: A list of all roles defined in the account, including metadata like creation date, owner, and comment. Essential for security and access control analysis.
    base_table:
      database: SNOWFLAKE
      schema: ACCOUNT_USAGE
      table: ROLES
    dimensions:
      - name: COMMENT
        synonyms:
          - comment
          - description
          - role description
        description: This column captures the various roles that users can have within the organization, providing a way to categorize and differentiate between different levels of access and responsibility.
        expr: COMMENT
        data_type: VARCHAR(16777216)
        sample_values:
          - test role for tasty bytes
          - data scientist for tasty bytes
          - admin for tasty bytes
      - name: NAME
        synonyms:
          - name
          - role
          - role name
        description: The role or position of a user or entity within the system, defining their level of access and permissions.
        expr: NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - ENGINEER
          - _VIEWER
          - CURRENCY
      - name: OWNER
        synonyms:
          - created by
          - owner
          - role owner
        description: The role that owns the object, which can be either the account owner (ACCOUNTADMIN) or Snowflake (SNOWFLAKE).
        expr: OWNER
        data_type: VARCHAR(16777216)
        sample_values:
          - SNOWFLAKE
          - ACCOUNTADMIN
      - name: OWNER_ROLE_TYPE
        synonyms:
          - owner category
          - owner role type
          - ownership type
        description: The type of role being defined, either an application-level role or a specific role within the application.
        expr: OWNER_ROLE_TYPE
        data_type: VARCHAR(13)
        sample_values:
          - APPLICATION
          - ROLE
      - name: ROLE_DATABASE_NAME
        synonyms:
          - associated database
          - database name
          - role database
        description: The name of the database that the role is associated with.
        expr: ROLE_DATABASE_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - DOC_AI_DB
          - SNOWFLAKE_HEALTH_CHECK_DASHBOARD
      - name: ROLE_TYPE
        synonyms:
          - access type
          - role category
          - role type
        description: The type of role being assigned, either a role that grants access to a specific application or a role that grants access to a database.
        expr: ROLE_TYPE
        data_type: VARCHAR(16777216)
        sample_values:
          - APPLICATION_ROLE
          - DATABASE_ROLE
    time_dimensions:
      - name: CREATED_ON
        synonyms:
          - created date
          - created on
          - creation time
        description: Date and time when the role was created.
        expr: CREATED_ON
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2025-05-20T00:25:44.120+0000
          - 2025-07-31T23:09:29.699+0000
          - 2025-07-31T23:09:29.744+0000
      - name: DELETED_ON
        synonyms:
          - deleted date
          - deleted on
          - deletion time
        description: The date and time when a role was deleted.
        expr: DELETED_ON
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2025-04-09T01:12:57.197+0000
          - 2025-04-09T01:12:57.336+0000
          - 2025-04-09T03:22:26.437+0000
    facts:
      - name: ROLE_ID
        synonyms:
          - role id
          - role identifier
          - security role id
        description: Unique identifier for a specific role within the organization.
        expr: ROLE_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '3847'
          - '3848'
          - '3728'
      - name: ROLE_INSTANCE_ID
        synonyms:
          - instance id
          - role instance
          - role instance id
        description: Unique identifier for a specific instance of a role.
        expr: ROLE_INSTANCE_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '8'
          - '24'
    filters:
      - name: ActiveRoles
        synonyms:
          - active roles
          - available roles
          - current roles
          - existing roles
        description: A filter for roles that have not been deleted and are currently available for assignment.
        expr: DELETED_ON IS NULL
      - name: ApplicationRoles
        synonyms:
          - app roles
          - app-level roles
          - application roles
          - application-specific roles
        description: A filter for roles that are application-specific rather than database or system roles.
        expr: ROLE_TYPE = 'APPLICATION_ROLE'
      - name: CustomRoles
        synonyms:
          - custom roles
          - non-system roles
          - user created roles
          - user-defined roles
        description: A filter for roles created by users rather than system-provided roles.
        expr: OWNER != 'SNOWFLAKE' AND NAME NOT LIKE 'SNOWFLAKE_%'
      - name: DatabaseRoles
        synonyms:
          - database level roles
          - database roles
          - database-specific roles
          - DB roles
        description: A filter for roles that are specific to a particular database rather than account-level roles.
        expr: ROLE_DATABASE_NAME IS NOT NULL
      - name: PrivilegedRoles
        synonyms:
          - admin roles
          - administrative roles
          - high privilege roles
          - privileged roles
        description: A filter for roles with high administrative privileges in the account.
        expr: NAME IN ('ACCOUNTADMIN', 'SECURITYADMIN', 'SYSADMIN', 'USERADMIN', 'ORGADMIN')
      - name: RecentlyCreatedRoles
        synonyms:
          - fresh roles
          - latest roles
          - new roles
          - recently created roles
        description: A filter for roles created in the last 30 days for tracking new role development.
        expr: CREATED_ON >= CURRENT_TIMESTAMP - INTERVAL '30 DAYS'
      - name: RecentlyModifiedRoles
        synonyms:
          - altered roles
          - changed roles
          - recently modified roles
          - updated roles
        description: A filter for roles that have been modified or granted new privileges in the last 7 days.
        expr: CREATED_ON >= CURRENT_TIMESTAMP - INTERVAL '7 DAYS' OR (DELETED_ON IS NOT NULL AND DELETED_ON >= CURRENT_TIMESTAMP - INTERVAL '7 DAYS')
      - name: SystemRoles
        synonyms:
          - built-in roles
          - default roles
          - snowflake roles
          - system roles
        description: A filter for system-provided roles owned by Snowflake rather than user-created roles.
        expr: OWNER = 'SNOWFLAKE'
      - name: UnusedRoles
        synonyms:
          - dormant roles
          - inactive roles
          - unassigned roles
          - unused roles
        description: A filter for roles that were created but may not be actively used, candidates for cleanup.
        expr: NAME NOT IN (SELECT DISTINCT ROLE_NAME FROM SNOWFLAKE.ACCOUNT_USAGE.QUERY_HISTORY WHERE START_TIME >= CURRENT_TIMESTAMP - INTERVAL '90 DAYS' AND ROLE_NAME IS NOT NULL)
    metrics:
      - name: ActiveRolePercentage
        synonyms:
          - active role rate
          - available role percentage
          - current role percentage
          - non-deleted role rate
        description: The percentage of roles that are currently active and not deleted, indicating role lifecycle management.
        expr: (COUNT(CASE WHEN DELETED_ON IS NULL THEN 1 END) * 100.0) / COUNT(*)
      - name: CustomRolePercentage
        synonyms:
          - custom role rate
          - custom role ratio
          - non-system role rate
          - user-defined role percentage
        description: The percentage of roles that are user-created versus system-provided, indicating security customization.
        expr: (COUNT(CASE WHEN OWNER != 'SNOWFLAKE' THEN 1 END) * 100.0) / COUNT(*)
      - name: DatabaseRolePercentage
        synonyms:
          - database role adoption
          - database role rate
          - database-specific role percentage
          - db role ratio
        description: The percentage of roles that are database-specific rather than account-level, indicating granular access control.
        expr: (COUNT(CASE WHEN ROLE_DATABASE_NAME IS NOT NULL THEN 1 END) * 100.0) / COUNT(*)
      - name: PrivilegedRolePercentage
        synonyms:
          - admin role percentage
          - administrative role ratio
          - high privilege rate
          - privileged role rate
        description: The percentage of roles with high administrative privileges, important for security governance.
        expr: (COUNT(CASE WHEN NAME IN ('ACCOUNTADMIN', 'SECURITYADMIN', 'SYSADMIN', 'USERADMIN', 'ORGADMIN') THEN 1 END) * 100.0) / COUNT(*)
      - name: RoleCreationRate
        synonyms:
          - new role velocity
          - role creation rate
          - role development rate
          - role growth rate
        description: The daily rate of new role creation, indicating access control development and growth trends.
        expr: COUNT(CASE WHEN CREATED_ON >= CURRENT_TIMESTAMP - INTERVAL '30 DAYS' THEN 1 END) / 30.0
      - name: TotalRoleCount
        synonyms:
          - number of roles
          - role count
          - role inventory
          - total roles
        description: The total number of roles in the account, indicating role-based access control complexity.
        expr: COUNT(*)
    primary_key:
      columns:
        - NAME
  - name: TABLES
    synonyms:
      - all tables
      - table list
    description: A comprehensive catalog of all tables across all schemas in the account, including dropped tables. Contains metadata like table name, row count, and creation time.
    base_table:
      database: SNOWFLAKE
      schema: ACCOUNT_USAGE
      table: TABLES
    dimensions:
      - name: AUTO_CLUSTERING_ON
        synonyms:
          - auto clustering
          - automatic clustering
          - clustering enabled
        description: Indicates whether automatic clustering is enabled for the table.
        expr: AUTO_CLUSTERING_ON
        data_type: VARCHAR(3)
        sample_values:
          - 'NO'
          - 'YES'
      - name: CLUSTERING_KEY
        synonyms:
          - cluster key
          - clustering columns
          - clustering key
        description: Unique identifier for a specific measurement signature within a particular object, used for efficient data retrieval and analysis.
        expr: CLUSTERING_KEY
        data_type: VARCHAR(16777216)
        sample_values:
          - LINEAR(hash(record_attributes['snow.ai.observability.object.id']))
          - LINEAR(MEASUREMENT_SIGNATURE)
      - name: COMMENT
        description: The name of the client account.
        expr: COMMENT
        data_type: VARCHAR(16777216)
        sample_values:
          - '{"origin":"sf_sit-is", "name":"tasty-bytes-dbt", "version":{"major":1, "minor":0}, "attributes":{"is_quickstart":1, "source":"sql"}}'
          - The table contains records of client accounts and their associated account details. Each record represents a unique client account and includes the client ID, account name, account type, inception date, status, and relationship manager.
      - name: COMMIT_ACTION
        synonyms:
          - commit action
          - commit behavior
          - transaction action
        description: The action taken when a commit is made, such as "COMMIT" or "ROLLBACK", indicating whether the changes were saved or reverted.
        expr: COMMIT_ACTION
        data_type: VARCHAR(16777216)
      - name: IS_DYNAMIC
        synonyms:
          - auto refresh
          - dynamic table
          - is dynamic
        description: Indicates whether the table is dynamic, meaning its structure can change over time, or static, meaning its structure is fixed.
        expr: IS_DYNAMIC
        data_type: VARCHAR(3)
        sample_values:
          - 'NO'
          - 'YES'
      - name: IS_HYBRID
        synonyms:
          - hybrid table
          - is hybrid
          - row column store
        description: Indicates whether the table is a hybrid table, which combines row-store and column-store storage for optimal performance.
        expr: IS_HYBRID
        data_type: VARCHAR(3)
        sample_values:
          - 'NO'
      - name: IS_ICEBERG
        synonyms:
          - apache iceberg
          - iceberg table
          - is iceberg
        description: Indicates whether the table is an Iceberg table, which is a type of table that stores data in a columnar format and is optimized for querying large amounts of data.
        expr: IS_ICEBERG
        data_type: VARCHAR(3)
        sample_values:
          - 'YES'
          - 'NO'
      - name: IS_INSERTABLE_INTO
        synonyms:
          - can insert
          - insert allowed
          - is insertable
        description: Indicates whether the table can be inserted into, with values of YES if the table supports insert operations and NO if it does not.
        expr: IS_INSERTABLE_INTO
        data_type: VARCHAR(3)
        sample_values:
          - 'YES'
          - 'NO'
      - name: IS_TRANSIENT
        synonyms:
          - is transient
          - temp table
          - temporary
        description: Indicates whether the table is temporary or not. A value of YES means the table is temporary and its data is deleted when the session is closed, while a value of NO means the table is permanent and its data persists across sessions.
        expr: IS_TRANSIENT
        data_type: VARCHAR(3)
        sample_values:
          - 'YES'
          - 'NO'
      - name: IS_TYPED
        synonyms:
          - is typed
          - structured type
          - typed table
        description: Indicates whether the table is typed, meaning it is based on a predefined table type that defines the structure and relationships of the table.
        expr: IS_TYPED
        data_type: VARCHAR(3)
        sample_values:
          - 'YES'
      - name: LAST_DDL_BY
        synonyms:
          - last changed by
          - last ddl by
          - modified by
        description: The user who last performed a DDL (Data Definition Language) operation on the table.
        expr: LAST_DDL_BY
        data_type: VARCHAR(16777216)
        sample_values:
          - FINTECH_TASTYBYTESENHANCINGCUSTOMEREXPERIENCES_SOLE_ADMIN
          - MHARRIS
      - name: OWNER_ROLE_TYPE
        synonyms:
          - owner role type
          - owner type
          - role type
        description: The type of role an owner has within an organization, such as administrator, manager, or user.
        expr: OWNER_ROLE_TYPE
        data_type: VARCHAR(13)
        sample_values:
          - ROLE
      - name: REFERENCE_GENERATION
        synonyms:
          - data generation
          - reference generation
          - version generation
        description: The generation of the reference data, indicating whether it is the original, updated, or a subsequent revision.
        expr: REFERENCE_GENERATION
        data_type: VARCHAR(16777216)
      - name: SELF_REFERENCING_COLUMN_NAME
        synonyms:
          - recursive column
          - self reference
          - self referencing column
        description: The name of the column that refers to the current table in a self-referential relationship.
        expr: SELF_REFERENCING_COLUMN_NAME
        data_type: VARCHAR(16777216)
      - name: TABLE_CATALOG
        synonyms:
          - catalog
          - database
          - database name
          - table catalog
        description: The name of the database or catalog that the table belongs to.
        expr: TABLE_CATALOG
        data_type: VARCHAR(16777216)
        sample_values:
          - TRP_TESTING_MHARRIS
          - DATA_PRODUCTS
          - BNY_DB
      - name: TABLE_NAME
        synonyms:
          - table
          - table identifier
          - table name
        description: The name of a table in the database, representing a specific entity or view, such as order details, control data, or a virtual view of trip stations and weather information.
        expr: TABLE_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - ORDER_DETAIL
          - BNY_CONTROL_TABLE
          - TRIPS_STATIONS_WEATHER_VW
      - name: TABLE_OWNER
        synonyms:
          - created by
          - owner
          - table owner
        description: The owner of the table, which is the role that has been granted ownership of the table and has full control over it.
        expr: TABLE_OWNER
        data_type: VARCHAR(16777216)
        sample_values:
          - ACCOUNTADMIN
          - SNOWFLAKE_CONNECTOR_FOR_POSTGRESQL
      - name: TABLE_SCHEMA
        synonyms:
          - schema
          - schema name
          - table schema
        description: The schema or namespace that the table belongs to, which can be used to categorize or group related tables together.
        expr: TABLE_SCHEMA
        data_type: VARCHAR(16777216)
        sample_values:
          - GEOSCAN_FRAUD
          - ORGANIZATION_USAGE_LOCAL
          - CSV_SCHEMA_TESTING
      - name: TABLE_TYPE
        synonyms:
          - table category
          - table type
          - type
        expr: TABLE_TYPE
        data_type: VARCHAR(16777216)
      - name: USER_DEFINED_TYPE_CATALOG
        synonyms:
          - custom type catalog
          - type catalog
          - udt catalog
        description: The catalog name of the user-defined type (UDT) that is the data type of the column.
        expr: USER_DEFINED_TYPE_CATALOG
        data_type: VARCHAR(16777216)
      - name: USER_DEFINED_TYPE_NAME
        synonyms:
          - custom type
          - type name
          - udt name
        description: The name of a user-defined data type.
        expr: USER_DEFINED_TYPE_NAME
        data_type: VARCHAR(16777216)
      - name: USER_DEFINED_TYPE_SCHEMA
        synonyms:
          - custom type schema
          - type schema
          - udt schema
        description: The schema in which the user-defined type is defined.
        expr: USER_DEFINED_TYPE_SCHEMA
        data_type: VARCHAR(16777216)
    time_dimensions:
      - name: CREATED
        synonyms:
          - created
          - created date
          - creation time
        description: Date and time when the record was created.
        expr: CREATED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2024-09-24T02:02:53.594+0000
          - 2023-04-20T01:22:49.198+0000
          - 2025-08-21T20:51:29.496+0000
      - name: DELETED
        synonyms:
          - deleted
          - deleted date
          - deletion time
        description: Date and time when a record was deleted.
        expr: DELETED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2025-08-22T17:11:26.578+0000
          - 2025-09-16T01:05:18.675+0000
          - 2025-08-01T15:05:27.098+0000
      - name: LAST_ALTERED
        description: Date and time when the table was last modified or updated.
        expr: LAST_ALTERED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2025-09-20T16:12:13.973+0000
          - 2025-08-21T13:24:55.975+0000
          - 2025-08-17T09:26:29.146+0000
      - name: LAST_DDL
        synonyms:
          - ddl timestamp
          - last ddl
          - last ddl time
        description: Date and time when the table was last modified.
        expr: LAST_DDL
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2024-09-24T02:02:05.980+0000
          - 2024-09-26T15:58:21.707+0000
          - 2023-04-21T13:24:42.537+0000
    facts:
      - name: BYTES
        synonyms:
          - bytes
          - data size
          - storage size
        description: The total amount of data stored in bytes.
        expr: BYTES
        data_type: NUMBER(38,0)
        sample_values:
          - '14482081792'
          - '3570688'
          - '14349489664'
      - name: INSTANCE_ID
        synonyms:
          - instance id
          - instance identifier
          - occurrence id
        description: Unique identifier for a specific instance or occurrence of a process, event, or entity.
        expr: INSTANCE_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '34'
          - '23'
      - name: RETENTION_TIME
        synonyms:
          - retention period
          - retention time
          - time travel
        description: The amount of time, in minutes, that a customer is willing to wait before abandoning a call.
        expr: RETENTION_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '30'
          - '5'
      - name: ROW_COUNT
        synonyms:
          - number of rows
          - record count
          - row count
        description: The total number of rows in a table.
        expr: ROW_COUNT
        data_type: NUMBER(38,0)
        sample_values:
          - '56184'
          - '393288'
          - '90'
      - name: TABLE_CATALOG_ID
        synonyms:
          - catalog id
          - database id
          - table catalog id
        description: Unique identifier for the catalog that contains the table.
        expr: TABLE_CATALOG_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '259'
          - '340'
          - '52'
      - name: TABLE_ID
        synonyms:
          - object id
          - table id
          - table numeric id
        description: Unique identifier for a table in the restaurant.
        expr: TABLE_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '246788'
          - '717828'
          - '634888'
      - name: TABLE_SCHEMA_ID
        synonyms:
          - namespace id
          - schema id
          - table schema id
        description: Unique identifier for the schema that the table belongs to.
        expr: TABLE_SCHEMA_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '331'
          - '47'
          - '31'
    filters:
      - name: ActiveTables
        synonyms:
          - active tables
          - available tables
          - current tables
          - existing tables
        description: A filter for tables that have not been deleted and are currently available for querying.
        expr: DELETED IS NULL
      - name: ClusteredTables
        synonyms:
          - auto-clustered tables
          - clustered tables
          - clustering enabled tables
          - tables with clustering
        description: A filter for tables that have clustering keys defined for performance optimization.
        expr: CLUSTERING_KEY IS NOT NULL OR AUTO_CLUSTERING_ON = 'YES'
      - name: DynamicTables
        synonyms:
          - auto-refresh tables
          - dynamic tables
          - live tables
          - streaming tables
        description: A filter for dynamic tables that automatically refresh based on changes to underlying data.
        expr: IS_DYNAMIC = 'YES'
      - name: EmptyTables
        synonyms:
          - empty tables
          - tables with no data
          - unused tables
          - zero row tables
        description: A filter for tables with zero rows that may be candidates for cleanup or unused structures.
        expr: ROW_COUNT = 0 OR ROW_COUNT IS NULL
      - name: ExternalTables
        synonyms:
          - external data tables
          - external storage tables
          - external tables
          - stage-based tables
        description: A filter for external tables that reference data stored outside of Snowflake.
        expr: TABLE_TYPE = 'EXTERNAL TABLE'
      - name: LargeTables
        synonyms:
          - big tables
          - high row count tables
          - large tables
          - massive tables
        description: A filter for tables with more than 1 million rows, useful for identifying data-intensive objects.
        expr: ROW_COUNT > 1000000
      - name: RecentlyCreatedTables
        synonyms:
          - fresh tables
          - latest tables
          - new tables
          - recently created tables
        description: A filter for tables created in the last 7 days for tracking new table development.
        expr: CREATED >= CURRENT_TIMESTAMP - INTERVAL '7 DAYS'
      - name: RecentlyModifiedTables
        synonyms:
          - altered tables
          - changed tables
          - recently modified tables
          - updated tables
        description: A filter for tables that have been modified in the last 7 days for tracking table changes.
        expr: LAST_ALTERED >= CURRENT_TIMESTAMP - INTERVAL '7 DAYS' OR LAST_DDL >= CURRENT_TIMESTAMP - INTERVAL '7 DAYS'
      - name: TransientTables
        synonyms:
          - non-persistent tables
          - temp tables
          - temporary tables
          - transient tables
        description: A filter for transient tables that don't contribute to Fail-safe costs.
        expr: IS_TRANSIENT = 'YES'
    metrics:
      - name: ActiveTablePercentage
        synonyms:
          - active table rate
          - available table percentage
          - current table percentage
          - non-deleted table rate
        description: The percentage of tables that are currently active and not deleted, indicating table lifecycle management.
        expr: (COUNT(CASE WHEN DELETED IS NULL THEN 1 END) * 100.0) / COUNT(*)
      - name: AverageTableSizeGB
        synonyms:
          - average data volume
          - average table size
          - mean table storage
          - typical table size
        description: The average size of tables in gigabytes, indicating typical data volume per table.
        expr: AVG(BYTES) / POWER(1024, 3)
      - name: ClusteredTablePercentage
        synonyms:
          - clustered table rate
          - clustering adoption rate
          - clustering utilization
          - optimized table percentage
        description: The percentage of tables with clustering enabled, indicating performance optimization adoption.
        expr: (COUNT(CASE WHEN CLUSTERING_KEY IS NOT NULL OR AUTO_CLUSTERING_ON = 'YES' THEN 1 END) * 100.0) / COUNT(*)
      - name: EmptyTablePercentage
        synonyms:
          - empty table rate
          - unused table ratio
          - vacant table rate
          - zero row table percentage
        description: The percentage of tables with zero rows, indicating potential cleanup opportunities.
        expr: (COUNT(CASE WHEN ROW_COUNT = 0 OR ROW_COUNT IS NULL THEN 1 END) * 100.0) / COUNT(*)
      - name: LargeTablePercentage
        synonyms:
          - big table percentage
          - high row count table rate
          - large table rate
          - massive table ratio
        description: The percentage of tables with more than 1 million rows, indicating data scale and potential performance considerations.
        expr: (COUNT(CASE WHEN ROW_COUNT > 1000000 THEN 1 END) * 100.0) / COUNT(*)
      - name: TotalDataVolumeGB
        synonyms:
          - data size in GB
          - storage consumed
          - total data volume
          - total table storage
        description: The total data volume in gigabytes across all tables, indicating storage costs and scale.
        expr: SUM(BYTES) / POWER(1024, 3)
      - name: TotalTableCount
        synonyms:
          - number of tables
          - table count
          - table inventory
          - total tables
        description: The total number of tables in the account, indicating database complexity and scale.
        expr: COUNT(*)
      - name: TransientTablePercentage
        synonyms:
          - non-persistent table rate
          - temporary table percentage
          - transient table rate
          - transient table ratio
        description: The percentage of tables configured as transient, indicating data persistence and cost optimization strategy.
        expr: (COUNT(CASE WHEN IS_TRANSIENT = 'YES' THEN 1 END) * 100.0) / COUNT(*)
    primary_key:
      columns:
        - TABLE_ID
  - name: USERS
    synonyms:
      - accounts
      - logins
      - user list
    description: A list of all users defined in the account, including metadata like login name, display name, creation date, and default role/warehouse. Used for user management and security auditing.
    base_table:
      database: SNOWFLAKE
      schema: ACCOUNT_USAGE
      table: USERS
    dimensions:
      - name: COMMENT
        synonyms:
          - comment
          - description
          - user comment
        description: The name of the user who created or owns the record, which may be a database administrator, a system-generated user for automated processes, or a specific individual.
        expr: COMMENT
        data_type: VARCHAR(16777216)
        sample_values:
          - dbt User
          - System created user for partner etl integration.
      - name: DATABASE_NAME
        synonyms:
          - database
          - database name
          - db name
        description: The name of the database being used by the user.
        expr: DATABASE_NAME
        data_type: VARCHAR(16777216)
      - name: DEFAULT_NAMESPACE
        synonyms:
          - default namespace
          - default schema
          - namespace
        description: The default namespace for a user, representing the database schema where their data is stored by default.
        expr: DEFAULT_NAMESPACE
        data_type: VARCHAR(16777216)
        sample_values:
          - PC_DATAROBOT_DB.PUBLIC
      - name: DEFAULT_ROLE
        synonyms:
          - assigned role
          - default role
          - primary role
          - user role
        description: The role or set of roles assigned to a user, defining their level of access and permissions within the system.
        expr: DEFAULT_ROLE
        data_type: VARCHAR(16777216)
        sample_values:
          - PC_DATAROBOT_ROLE
          - DBA_CITIBIKE
          - SNOWFLAKE_CONNECTOR_FOR_MYSQL_AGENT_ROLE
      - name: DEFAULT_SECONDARY_ROLE
        synonyms:
          - additional role
          - default secondary role
          - secondary role
        description: The default secondary role assigned to a user, which is the secondary role that will be applied to the user by default if no other role is specified.
        expr: DEFAULT_SECONDARY_ROLE
        data_type: VARCHAR(16777216)
        sample_values:
          - '[ALL]'
      - name: DEFAULT_WAREHOUSE
        synonyms:
          - assigned warehouse
          - default warehouse
          - primary warehouse
          - user warehouse
        description: The name of the warehouse assigned to the user by default.
        expr: DEFAULT_WAREHOUSE
        data_type: VARCHAR(16777216)
        sample_values:
          - DEMO_BUILD_WH
          - SNOWFLAKE_CONNECTOR_FOR_MYSQL_OPS_WH
      - name: DISABLED
        synonyms:
          - account disabled
          - disabled
          - inactive
        description: Indicates whether a user's account is currently disabled or inactive, preventing them from accessing the system or performing any actions.
        expr: DISABLED
        data_type: VARIANT
        sample_values:
          - 'false'
      - name: DISPLAY_NAME
        synonyms:
          - display name
          - full name
          - shown name
          - visible name
        description: The DISPLAY_NAME column stores the full name of a user, which can be used to identify and display the user in the system, and is typically used for display purposes rather than as a unique identifier.
        expr: DISPLAY_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - TEST_USER
          - SNOWFLAKE
          - JANE
      - name: EMAIL
        synonyms:
          - contact email
          - email
          - email address
          - user email
        description: The email address of the user.
        expr: EMAIL
        data_type: VARCHAR(16777216)
        sample_values:
          - jane@snowflakedemo.com
          - matt.harris@snowflake.com
      - name: EXT_AUTHN_DUO
        synonyms:
          - duo authentication
          - duo enabled
          - external duo
        description: Indicates whether the user has enabled Duo authentication for external authentication.
        expr: EXT_AUTHN_DUO
        data_type: BOOLEAN
        sample_values:
          - 'FALSE'
      - name: EXT_AUTHN_UID
        synonyms:
          - auth uid
          - external auth uid
          - external id
        description: Unique identifier for an external authentication user.
        expr: EXT_AUTHN_UID
        data_type: VARCHAR(16777216)
      - name: FIRST_NAME
        synonyms:
          - first name
          - forename
          - given name
        description: The first name of the user.
        expr: FIRST_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - John
      - name: HAS_MFA
        synonyms:
          - has MFA
          - MFA enabled
          - multi factor auth
          - two factor
        description: Indicates whether a user has multi-factor authentication (MFA) enabled on their account.
        expr: HAS_MFA
        data_type: BOOLEAN
        sample_values:
          - 'TRUE'
          - 'FALSE'
      - name: HAS_PASSWORD
        synonyms:
          - has password
          - password enabled
          - password set
        description: Indicates whether a user has a password set for their account.
        expr: HAS_PASSWORD
        data_type: BOOLEAN
        sample_values:
          - 'TRUE'
          - 'FALSE'
      - name: HAS_RSA_PUBLIC_KEY
        synonyms:
          - has rsa key
          - key authentication
          - rsa public key
        description: Indicates whether a user has a registered RSA public key associated with their account.
        expr: HAS_RSA_PUBLIC_KEY
        data_type: BOOLEAN
        sample_values:
          - 'FALSE'
          - 'TRUE'
      - name: LAST_NAME
        synonyms:
          - family name
          - last name
          - surname
        description: The last name of the user.
        expr: LAST_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - Hamm
          - Harris
      - name: LOGIN_NAME
        synonyms:
          - login
          - login name
          - user login
          - username
        description: The username or login identifier for a user accessing the system, which can be a system-generated name or an email address.
        expr: LOGIN_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - PC_DATAROBOT_USER
          - MATT.HARRIS@SNOWFLAKE.COM
          - TEST_USER
      - name: MUST_CHANGE_PASSWORD
        synonyms:
          - force password change
          - must change password
          - password reset required
        description: Indicates whether the user is required to change their password upon next login.
        expr: MUST_CHANGE_PASSWORD
        data_type: BOOLEAN
        sample_values:
          - 'FALSE'
      - name: NAME
        synonyms:
          - account name
          - name
          - user name
        description: The name of the user or organization that has access to the system or application.
        expr: NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - TEST_PUBLIC
          - PC_DATAROBOT_USER
          - FINTECH_TASTYBYTESENHANCINGCUSTOMEREXPERIENCES_SOLE_ADMIN
      - name: OWNER
        synonyms:
          - managing role
          - owner
          - owner role
        description: The role of the user within the organization, indicating the level of access and control they have over the account, with possible values being ACCOUNTADMIN (highest level of access to manage all account settings) and SECURITYADMIN (responsible for managing security settings and access control).
        expr: OWNER
        data_type: VARCHAR(16777216)
        sample_values:
          - ACCOUNTADMIN
          - SECURITYADMIN
      - name: SCHEMA_NAME
        synonyms:
          - schema
          - schema name
          - user schema
        description: The name of the database schema to which the user belongs.
        expr: SCHEMA_NAME
        data_type: VARCHAR(16777216)
      - name: SNOWFLAKE_LOCK
        synonyms:
          - account locked
          - security lock
          - snowflake lock
        description: Indicates whether the user account is locked due to excessive login attempts or other security measures.
        expr: SNOWFLAKE_LOCK
        data_type: VARIANT
        sample_values:
          - 'false'
      - name: TYPE
        synonyms:
          - account type
          - user category
          - user type
        description: The type of user, either a service account or an individual person.
        expr: TYPE
        data_type: VARCHAR(16777216)
        sample_values:
          - SERVICE
          - PERSON
    time_dimensions:
      - name: BYPASS_MFA_UNTIL
        synonyms:
          - bypass mfa until
          - mfa bypass expiry
          - mfa exemption end
        description: The date and time until which a user is exempt from multi-factor authentication (MFA) requirements.
        expr: BYPASS_MFA_UNTIL
        data_type: TIMESTAMP_LTZ(6)
      - name: CREATED_ON
        synonyms:
          - account created
          - created on
          - user creation time
        description: Date and time when the user account was created.
        expr: CREATED_ON
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2023-01-04T13:39:08.332+0000
          - 2025-06-30T13:31:06.035+0000
          - 2022-11-09T14:00:35.244+0000
      - name: DELETED_ON
        synonyms:
          - account deleted
          - deleted on
          - user deletion time
        description: Date and time when the user account was deleted.
        expr: DELETED_ON
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2024-05-06T19:38:32.458+0000
          - 2022-11-09T16:55:54.379+0000
      - name: EXPIRES_AT
        synonyms:
          - account expiry
          - expiration date
          - expires at
        description: The date and time when a user's account or subscription is set to expire.
        expr: EXPIRES_AT
        data_type: TIMESTAMP_LTZ(6)
      - name: LAST_SUCCESS_LOGIN
        synonyms:
          - last login
          - last success login
          - successful login time
        description: The date and time of the user's most recent successful login.
        expr: LAST_SUCCESS_LOGIN
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2025-09-23T18:12:25.941+0000
          - 2025-05-02T17:47:25.584+0000
      - name: LOCKED_UNTIL_TIME
        synonyms:
          - account unlock date
          - locked until time
          - unlock time
        description: The date and time when a user's account will be unlocked, if it is currently locked.
        expr: LOCKED_UNTIL_TIME
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2023-06-21T14:14:16.511+0000
          - 2022-11-09T17:55:54.111+0000
          - 2024-05-06T20:38:32.402+0000
      - name: PASSWORD_LAST_SET_TIME
        synonyms:
          - last password change
          - password changed date
          - password last set time
        description: The date and time when the user last changed their password.
        expr: PASSWORD_LAST_SET_TIME
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2023-03-01T01:08:29.030+0000
          - 2022-11-30T16:15:45.890+0000
    facts:
      - name: DATABASE_ID
        synonyms:
          - database id
          - database identifier
          - db id
        description: A unique identifier for the database that the user is associated with.
        expr: DATABASE_ID
        data_type: NUMBER(38,0)
      - name: SCHEMA_ID
        synonyms:
          - namespace id
          - schema id
          - schema identifier
        description: Unique identifier for the schema to which the user belongs.
        expr: SCHEMA_ID
        data_type: NUMBER(38,0)
      - name: USER_ID
        synonyms:
          - account id
          - user id
          - user identifier
        description: Unique identifier for each user in the system.
        expr: USER_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '49'
          - '1'
          - '15'
    filters:
      - name: ActiveUsers
        synonyms:
          - active users
          - available users
          - current users
          - existing users
        description: A filter for users that have not been deleted and are currently active in the account.
        expr: DELETED_ON IS NULL
      - name: DisabledUsers
        synonyms:
          - disabled users
          - inactive users
          - locked users
          - suspended users
        description: A filter for users whose accounts are currently disabled or locked.
        expr: DISABLED = TRUE OR SNOWFLAKE_LOCK = TRUE
      - name: DormantUsers
        synonyms:
          - dormant users
          - inactive users
          - old logins
          - stale users
        description: A filter for users who haven't logged in for over 90 days and may be candidates for cleanup.
        expr: LAST_SUCCESS_LOGIN < CURRENT_TIMESTAMP - INTERVAL '90 DAYS' OR LAST_SUCCESS_LOGIN IS NULL
      - name: ExternalAuthUsers
        synonyms:
          - external auth users
          - external authentication users
          - federated users
          - SSO users
        description: A filter for users configured for external authentication (SSO, SAML, etc.).
        expr: EXT_AUTHN_DUO IS NOT NULL OR EXT_AUTHN_UID IS NOT NULL
      - name: LockedUsers
        synonyms:
          - locked users
          - suspended users
          - temporarily locked users
          - time-locked users
        description: A filter for users who are currently locked until a specific time.
        expr: LOCKED_UNTIL_TIME > CURRENT_TIMESTAMP
      - name: MFAEnabledUsers
        synonyms:
          - MFA enabled users
          - multi-factor users
          - secure users
          - two-factor users
        description: A filter for users with multi-factor authentication enabled for enhanced security.
        expr: HAS_MFA = TRUE
      - name: PasswordExpiryUsers
        synonyms:
          - expiring passwords
          - password due users
          - password expiry users
          - password renewal needed
        description: A filter for users whose passwords are due for expiration or require changes.
        expr: MUST_CHANGE_PASSWORD = TRUE OR EXPIRES_AT <= CURRENT_TIMESTAMP + INTERVAL '30 DAYS'
      - name: RecentLogins
        synonyms:
          - active logins
          - current sessions
          - lately accessed
          - recent logins
        description: A filter for users who have logged in within the last 30 days.
        expr: LAST_SUCCESS_LOGIN >= CURRENT_TIMESTAMP - INTERVAL '30 DAYS'
      - name: RSAKeyUsers
        synonyms:
          - certificate users
          - key-based auth users
          - public key users
          - RSA key users
        description: A filter for users configured with RSA public key authentication.
        expr: HAS_RSA_PUBLIC_KEY = TRUE
      - name: ServiceUsers
        synonyms:
          - automated users
          - service accounts
          - service users
          - system users
        description: A filter for service accounts rather than individual person accounts.
        expr: TYPE = 'SERVICE'
    metrics:
      - name: ActiveUserPercentage
        synonyms:
          - active user rate
          - available user percentage
          - enabled user percentage
          - non-deleted user rate
        description: The percentage of users that are currently active and not deleted or disabled, indicating user lifecycle management.
        expr: (COUNT(CASE WHEN DELETED_ON IS NULL AND DISABLED = FALSE THEN 1 END) * 100.0) / COUNT(*)
      - name: DormantUserPercentage
        synonyms:
          - dormant user rate
          - inactive user percentage
          - stale account rate
          - unused user ratio
        description: The percentage of users who haven't logged in for over 90 days, indicating potential cleanup opportunities.
        expr: (COUNT(CASE WHEN LAST_SUCCESS_LOGIN < CURRENT_TIMESTAMP - INTERVAL '90 DAYS' OR LAST_SUCCESS_LOGIN IS NULL THEN 1 END) * 100.0) / COUNT(*)
      - name: ExternalAuthPercentage
        synonyms:
          - external auth rate
          - external authentication rate
          - federated user percentage
          - SSO adoption rate
        description: The percentage of users configured for external authentication (SSO, SAML), indicating identity management maturity.
        expr: (COUNT(CASE WHEN EXT_AUTHN_DUO IS NOT NULL OR EXT_AUTHN_UID IS NOT NULL THEN 1 END) * 100.0) / COUNT(*)
      - name: MFAAdoptionRate
        synonyms:
          - MFA adoption rate
          - MFA enabled percentage
          - multi-factor auth rate
          - two-factor auth rate
        description: The percentage of users with multi-factor authentication enabled, indicating security posture strength.
        expr: (COUNT(CASE WHEN HAS_MFA = TRUE THEN 1 END) * 100.0) / COUNT(*)
      - name: RecentLoginPercentage
        synonyms:
          - active user engagement
          - login activity rate
          - recent activity rate
          - user engagement percentage
        description: The percentage of users who have logged in within the last 30 days, indicating user engagement and adoption.
        expr: (COUNT(CASE WHEN LAST_SUCCESS_LOGIN >= CURRENT_TIMESTAMP - INTERVAL '30 DAYS' THEN 1 END) * 100.0) / COUNT(*)
      - name: ServiceAccountPercentage
        synonyms:
          - automated user percentage
          - non-human user rate
          - service account rate
          - service user ratio
        description: The percentage of accounts that are service accounts rather than individual users, indicating automation adoption.
        expr: (COUNT(CASE WHEN TYPE = 'SERVICE' THEN 1 END) * 100.0) / COUNT(*)
      - name: TotalUserCount
        synonyms:
          - number of users
          - total users
          - user count
          - user inventory
        description: The total number of users in the account, indicating user base size and license utilization.
        expr: COUNT(*)
    primary_key:
      columns:
        - NAME
  - name: VIEWS
    synonyms:
      - all views
      - view list
    description: A catalog of all views across all schemas in the account, including dropped views. Contains metadata like view name and the SQL view definition text.
    base_table:
      database: SNOWFLAKE
      schema: ACCOUNT_USAGE
      table: VIEWS
    dimensions:
      - name: CHECK_OPTION
        synonyms:
          - check option
          - data restriction
          - view check
        description: The CHECK_OPTION column indicates whether a view is subject to certain restrictions on its data, with the value "NONE" indicating that no such restrictions are in place, allowing the view to return all data without any checks.
        expr: CHECK_OPTION
        data_type: VARCHAR(4)
        sample_values:
          - NONE
      - name: COMMENT
        synonyms:
          - comment
          - description
          - view comment
        description: A brief description of the view, providing context about the data it contains.
        expr: COMMENT
        data_type: VARCHAR(16777216)
        sample_values:
          - The table contains financial summaries of individual accounts. Each record represents a single account and includes details about its type, manager, and allocation percentages.
          - The table contains records of customer orders, specifically those placed by customers. Each record represents a single order and includes details about the customer and the order itself, including financial and date information.
      - name: INSERTABLE_INTO
        synonyms:
          - can insert
          - insert allowed
          - insertable into
        description: Indicates whether the view is insertable into, meaning whether data can be inserted into the underlying table through the view.
        expr: INSERTABLE_INTO
        data_type: VARCHAR(2)
        sample_values:
          - 'NO'
      - name: IS_SECURE
        synonyms:
          - access restricted
          - is secure
          - secure view
        description: Indicates whether the view is secure, meaning it can only be accessed by authorized users, or not.
        expr: IS_SECURE
        data_type: VARCHAR(3)
        sample_values:
          - 'NO'
          - 'YES'
      - name: IS_UPDATABLE
        synonyms:
          - can update
          - is updatable
          - update allowed
        description: Indicates whether the view is updatable, meaning whether data can be inserted, updated, or deleted through the view.
        expr: IS_UPDATABLE
        data_type: VARCHAR(2)
        sample_values:
          - 'NO'
      - name: LAST_DDL_BY
        synonyms:
          - last changed by
          - last ddl by
          - modified by
        description: The user who last performed a DDL (Data Definition Language) operation on the object.
        expr: LAST_DDL_BY
        data_type: VARCHAR(16777216)
        sample_values:
          - JOHN
          - DROPPED_USER(0)
      - name: OWNER_ROLE_TYPE
        description: The OWNER_ROLE_TYPE column categorizes the type of owner associated with a view, indicating whether the owner is a specific role or an application.
        expr: OWNER_ROLE_TYPE
        data_type: VARCHAR(13)
        sample_values:
          - ROLE
          - APPLICATION
      - name: TABLE_CATALOG
        synonyms:
          - catalog
          - database name
          - table catalog
          - view catalog
        description: The name of the catalog that contains the table being referenced in the view.
        expr: TABLE_CATALOG
        data_type: VARCHAR(16777216)
        sample_values:
          - SNOWFLAKE
          - CITIBIKE_DEV
          - TRP_TESTING_MHARRIS
      - name: TABLE_NAME
        synonyms:
          - table name
          - view
          - view name
        description: The name of the table being referenced or queried.
        expr: TABLE_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - VANCOUVER_LOBSTER_MAC_SALES
          - TRIP_HISTORY$1
          - MERGE_TASK_RESULTS_VIEW
      - name: TABLE_OWNER
        synonyms:
          - created by
          - owner
          - table owner
          - view owner
        description: The user or role that owns the view.
        expr: TABLE_OWNER
        data_type: VARCHAR(16777216)
        sample_values:
          - DBA_CITIBIKE
          - VIEW_CREATOR_ROLE
      - name: TABLE_SCHEMA
        synonyms:
          - schema
          - schema name
          - table schema
          - view schema
        description: The database schema that the view belongs to.
        expr: TABLE_SCHEMA
        data_type: VARCHAR(16777216)
        sample_values:
          - THREAT_INTELLIGENCE
          - INTERNAL_PROCEDURES
          - UTILS
      - name: VIEW_DEFINITION
        synonyms:
          - view code
          - view definition
          - view sql
        description: This column contains the definitions of database views, which are virtual tables based on the result of a query. The views are used to simplify complex queries, provide an additional layer of abstraction, and restrict access to sensitive data.
        expr: VIEW_DEFINITION
        data_type: VARCHAR(16777216)
        sample_values:
          - |-
            CREATE OR REPLACE VIEW FROSTBYTE_TASTY_BYTES_DEV._SYSTEM_MODEL_REGISTRY_SCHEMA._SYSTEM_REGISTRY_MODELS_VIEW COPY GRANTS AS
                            SELECT _SYSTEM_REGISTRY_MODELS.*, _SYSTEM_REGISTRY_METADATA_LAST_DESCRIPTION.DESCRIPTION AS DESCRIPTION,_SYSTEM_REGISTRY_METADATA_LAST_METRICS.METRICS AS METRICS,_SYSTEM_REGISTRY_METADATA_LAST_TAGS.TAGS AS TAGS,_SYSTEM_REGISTRY_METADATA_LAST_REGISTRATION.REGISTRATION_TIMESTAMP AS REGISTRATION_TIMESTAMP
                            FROM _SYSTEM_REGISTRY_MODELS LEFT JOIN _SYSTEM_REGISTRY_METADATA_LAST_DESCRIPTION ON (_SYSTEM_REGISTRY_METADATA_LAST_DESCRIPTION.MODEL_ID = _SYSTEM_REGISTRY_MODELS.ID) LEFT JOIN _SYSTEM_REGISTRY_METADATA_LAST_METRICS ON (_SYSTEM_REGISTRY_METADATA_LAST_METRICS.MODEL_ID = _SYSTEM_REGISTRY_MODELS.ID) LEFT JOIN _SYSTEM_REGISTRY_METADATA_LAST_TAGS ON (_SYSTEM_REGISTRY_METADATA_LAST_TAGS.MODEL_ID = _SYSTEM_REGISTRY_MODELS.ID) LEFT JOIN _SYSTEM_REGISTRY_METADATA_LAST_REGISTRATION ON (_SYSTEM_REGISTRY_METADATA_LAST_REGISTRATION.MODEL_ID = _SYSTEM_REGISTRY_MODELS.ID)
          - |-
            CREATE OR REPLACE VIEW ACCOUNT_SUMMARY AS
            SELECT 
                p.account_id,
                a.account_name,
                a.account_type,
                a.relationship_manager,
                COUNT(DISTINCT p.security_id) AS num_positions,
                SUM(p.market_value) AS total_market_value,
                SUM(CASE WHEN p.asset_class = 'Equity' THEN p.market_value ELSE 0 END) / 
                    NULLIF(SUM(p.market_value), 0) * 100 AS equity_allocation_pct,
                SUM(CASE WHEN p.asset_class = 'Fixed Income' THEN p.market_value ELSE 0 END) / 
                    NULLIF(SUM(p.market_value), 0) * 100 AS fixed_income_allocation_pct,
                SUM(CASE WHEN p.asset_class = 'Currency' THEN p.market_value ELSE 0 END) / 
                    NULLIF(SUM(p.market_value), 0) * 100 AS currency_allocation_pct
            FROM POSITIONS_DAILY p
            JOIN CLIENT_ACCOUNTS a ON p.account_id = a.account_id
            GROUP BY p.account_id, a.account_name, a.account_type, a.relationship_manager;
          - |-
            CREATE OR REPLACE VIEW SALES_ANOMALIES AS (
                SELECT 
                    A.TIMESTAMP AS sales_date, 
                    A.TOTAL_SOLD, 
                    A.MENU_ITEM_NAME, 
                    COALESCE(B.IS_ANOMALY, FALSE) AS IS_ANOMALY 
                FROM 
                 UNSUPERVISED_ANOMALY_INFERENCE A
                LEFT JOIN 
                    UNSUPERVISED_ANOMALY_MODEL B 
                ON 
                    A.MENU_ITEM_NAME = REGEXP_REPLACE(B.SERIES, '["]') AND A.TIMESTAMP  = B.TS
                ORDER BY 
                    sales_date, 
                    MENU_ITEM_NAME);
    time_dimensions:
      - name: CREATED
        synonyms:
          - created
          - created date
          - creation time
        description: Date and time when the view was created.
        expr: CREATED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2025-02-28T23:07:27.608+0000
          - 2025-08-03T05:05:17.562+0000
          - 2025-09-06T11:05:20.649+0000
      - name: DELETED
        description: Date and time when a view was deleted.
        expr: DELETED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2025-08-01T10:05:24.927+0000
          - 2025-02-26T16:33:40.141+0000
          - 2025-08-20T07:05:16.333+0000
      - name: LAST_ALTERED
        description: Date and time when the view was last modified.
        expr: LAST_ALTERED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2023-01-26T20:49:04.085+0000
          - 2024-06-02T04:28:08.723+0000
          - 2025-09-23T02:05:16.026+0000
      - name: LAST_DDL
        description: Date and time when the view was last modified.
        expr: LAST_DDL
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2025-09-18T02:05:16.060+0000
          - 2025-08-15T23:05:24.475+0000
          - 2025-09-17T21:05:23.805+0000
    facts:
      - name: INSTANCE_ID
        synonyms:
          - instance id
          - instance identifier
          - view instance id
        description: A unique identifier for a specific instance of a view, allowing for the tracking and management of multiple instances of the same view.
        expr: INSTANCE_ID
        data_type: NUMBER(38,0)
      - name: TABLE_CATALOG_ID
        synonyms:
          - catalog id
          - database id
          - table catalog id
        description: Unique identifier for the table catalog.
        expr: TABLE_CATALOG_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '130'
          - '121'
          - '280'
      - name: TABLE_ID
        synonyms:
          - object id
          - table id
          - table numeric id
        description: Unique identifier for the table being viewed.
        expr: TABLE_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '1086496'
          - '856106'
          - '1115172'
      - name: TABLE_SCHEMA_ID
        synonyms:
          - schema id
          - table schema id
          - view schema id
        description: The unique identifier of the schema that the view belongs to.
        expr: TABLE_SCHEMA_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '362'
          - '619'
          - '334'
    filters:
      - name: ActiveViews
        synonyms:
          - active views
          - available views
          - current views
          - existing views
        description: A filter for views that have not been deleted and are currently available for querying.
        expr: DELETED IS NULL
      - name: ComplexViews
        synonyms:
          - complex views
          - joined views
          - multi-table views
          - sophisticated views
        description: A filter for views with complex definitions containing joins, subqueries, or complex logic.
        expr: TO_VARCHAR(VIEW_DEFINITION) ILIKE '%JOIN%' OR TO_VARCHAR(VIEW_DEFINITION) ILIKE '%UNION%' OR TO_VARCHAR(VIEW_DEFINITION) ILIKE '%SUBQUERY%' OR LENGTH(VIEW_DEFINITION) > 1000
      - name: InsertableViews
        synonyms:
          - data modification views
          - editable views
          - insertable views
          - write-enabled views
        description: A filter for views that support INSERT operations, allowing data modification through the view.
        expr: INSERTABLE_INTO = 'YES'
      - name: RecentlyCreatedViews
        synonyms:
          - fresh views
          - latest views
          - new views
          - recently created views
        description: A filter for views created in the last 7 days for tracking new view development.
        expr: CREATED >= CURRENT_TIMESTAMP - INTERVAL '7 DAYS'
      - name: RecentlyModifiedViews
        synonyms:
          - altered views
          - changed views
          - recently modified views
          - updated views
        description: A filter for views that have been modified in the last 7 days for tracking view changes.
        expr: LAST_ALTERED >= CURRENT_TIMESTAMP - INTERVAL '7 DAYS' OR LAST_DDL >= CURRENT_TIMESTAMP - INTERVAL '7 DAYS'
      - name: SecureViews
        synonyms:
          - access-controlled views
          - protected views
          - restricted views
          - secure views
        description: A filter for secure views that provide additional data protection and access controls.
        expr: IS_SECURE = 'YES'
      - name: UpdatableViews
        synonyms:
          - editable views
          - modifiable views
          - updatable views
          - writable views
        description: A filter for views that support data modification operations (INSERT, UPDATE, DELETE).
        expr: IS_UPDATABLE = 'YES'
    metrics:
      - name: ActiveViewPercentage
        synonyms:
          - active view rate
          - available view percentage
          - current view percentage
          - non-deleted view rate
        description: The percentage of views that are currently active and not deleted, indicating view lifecycle management.
        expr: (COUNT(CASE WHEN DELETED IS NULL THEN 1 END) * 100.0) / COUNT(*)
      - name: ComplexViewPercentage
        synonyms:
          - advanced view ratio
          - complex view rate
          - multi-table view rate
          - sophisticated view percentage
        description: The percentage of views with complex definitions (joins, unions, subqueries), indicating query abstraction complexity.
        expr: (COUNT(CASE WHEN TO_VARCHAR(VIEW_DEFINITION) ILIKE '%JOIN%' OR TO_VARCHAR(VIEW_DEFINITION) ILIKE '%UNION%' OR LENGTH(VIEW_DEFINITION) > 1000 THEN 1 END) * 100.0) / COUNT(*)
      - name: SecureViewPercentage
        synonyms:
          - access-controlled view rate
          - protected view percentage
          - secure view adoption
          - secure view rate
        description: The percentage of views configured as secure views, indicating data protection and security controls adoption.
        expr: (COUNT(CASE WHEN IS_SECURE = 'YES' THEN 1 END) * 100.0) / COUNT(*)
      - name: TotalViewCount
        synonyms:
          - number of views
          - total views
          - view count
          - view inventory
        description: The total number of views in the account, indicating database abstraction layer complexity.
        expr: COUNT(*)
      - name: UpdatableViewPercentage
        synonyms:
          - editable view ratio
          - modifiable view percentage
          - updatable view rate
          - writable view rate
        description: The percentage of views that support data modification operations, indicating view design patterns.
        expr: (COUNT(CASE WHEN IS_UPDATABLE = 'YES' THEN 1 END) * 100.0) / COUNT(*)
    primary_key:
      columns:
        - TABLE_ID
  - name: TAGS
    synonyms:
      - classification tags
      - data tags
      - governance tags
    description: A list of all tags created in the account for data governance and classification. Includes tag name, database, schema, and owner.
    base_table:
      database: SNOWFLAKE
      schema: ACCOUNT_USAGE
      table: TAGS
    dimensions:
      - name: ALLOWED_VALUES
        synonyms:
          - allowed values
          - permitted values
          - valid values
        description: This column appears to contain a list of allowed values for a dimension, which are identifiers for specific data points. The values include "DOLOCATIONID" and "TRIP_ID", suggesting that this column is used to track or filter data related to specific locations or trips.
        expr: ALLOWED_VALUES
        data_type: VARIANT
        sample_values:
          - |-
            [
              "DOLOCATIONID"
            ]
          - |-
            [
              "TRIP_ID"
            ]
      - name: OWNER_ROLE_TYPE
        synonyms:
          - owner role type
          - owner type
          - role type
        description: The type of role an owner has within an organization, such as administrator, manager, or user.
        expr: OWNER_ROLE_TYPE
        data_type: VARCHAR(13)
        sample_values:
          - ROLE
      - name: TAG_COMMENT
        synonyms:
          - comment
          - tag comment
          - tag description
        description: This column stores the type of personally identifiable information (PII) tag applied to a column, indicating whether it contains email addresses or names.
        expr: TAG_COMMENT
        data_type: VARIANT
        sample_values:
          - '"PII Tag for E-mail Columns"'
          - '"PII Tag for Name Columns"'
      - name: TAG_DATABASE
        synonyms:
          - database
          - database name
          - tag database
        description: The TAG_DATABASE column represents the name of the database where the data is stored, indicating the source system or repository of the data.
        expr: TAG_DATABASE
        data_type: VARCHAR(16777216)
        sample_values:
          - FROSTBYTE_TASTY_BYTES
          - TAG_DEMO_MARKETING_DB
          - ASSET_MGMT
      - name: TAG_NAME
        synonyms:
          - classification tag
          - data tag
          - tag
          - tag name
        description: This column stores the type of personally identifiable information (PII) that has been detected, such as email, name, or phone number.
        expr: TAG_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - PII_EMAIL_TAG
          - PII_NAME_TAG
          - PII_PHONE_NUMBER_TAG
      - name: TAG_OWNER
        synonyms:
          - created by
          - owner
          - tag owner
        description: The TAG_OWNER column represents the role or entity that owns or is associated with a specific tag, indicating the level of access or responsibility for managing the tag.
        expr: TAG_OWNER
        data_type: VARCHAR(16777216)
        sample_values:
          - ML_MODEL_ROLE
          - FEATURE_STORE_LAB_USER
          - ACCOUNTADMIN
      - name: TAG_SCHEMA
        synonyms:
          - schema
          - schema name
          - tag schema
        description: The TAG_SCHEMA column represents the category or classification of a tag, which is used to organize and group related tags together, providing a way to filter, search, and manage tags based on their schema type.
        expr: TAG_SCHEMA
        data_type: VARCHAR(16777216)
        sample_values:
          - RAW_CUSTOMER
          - DATA_OPS
          - MY_FEATURE_STORE
    time_dimensions:
      - name: CREATED
        description: Date and time when the tag was created.
        expr: CREATED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2025-03-05T01:42:00.099+0000
          - 2024-06-28T15:16:45.409+0000
          - 2023-05-31T17:40:27.075+0000
      - name: DELETED
        synonyms:
          - deleted
          - deleted date
          - deletion time
        description: Date and time when a record was deleted.
        expr: DELETED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2023-05-30T19:13:06.918+0000
          - 2023-05-31T13:14:47.495+0000
      - name: LAST_ALTERED
        description: Date and time when the record was last modified.
        expr: LAST_ALTERED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2023-05-31T17:42:18.999+0000
          - 2024-06-28T15:16:45.409+0000
          - 2023-05-31T17:42:18.366+0000
    facts:
      - name: TAG_DATABASE_ID
        synonyms:
          - database id
          - tag database id
          - tag db id
        description: Unique identifier for the database where the tag is stored.
        expr: TAG_DATABASE_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '298'
          - '74'
          - '286'
      - name: TAG_ID
        synonyms:
          - classification id
          - tag id
          - tag identifier
        description: A unique identifier for a specific tag or keyword associated with a fact.
        expr: TAG_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '37'
          - '46'
          - '11'
      - name: TAG_SCHEMA_ID
        synonyms:
          - schema id
          - tag namespace id
          - tag schema id
        description: Unique identifier for the tag schema that this tag belongs to.
        expr: TAG_SCHEMA_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '580'
          - '307'
          - '138'
    filters:
      - name: ActiveTags
        synonyms:
          - active tags
          - available tags
          - current tags
          - existing tags
        description: A filter for tags that have not been deleted and are currently available for assignment.
        expr: DELETED IS NULL
      - name: ComplianceTags
        synonyms:
          - audit tags
          - compliance tags
          - governance tags
          - regulatory tags
        description: A filter for tags used for regulatory compliance and audit purposes.
        expr: TO_VARCHAR(TAG_NAME) ILIKE '%COMPLIANCE%' OR TO_VARCHAR(TAG_NAME) ILIKE '%GDPR%' OR TO_VARCHAR(TAG_NAME) ILIKE '%HIPAA%' OR TO_VARCHAR(TAG_NAME) ILIKE '%SOX%' OR TO_VARCHAR(TAG_NAME) ILIKE '%AUDIT%'
      - name: EnumeratedTags
        synonyms:
          - allowed value tags
          - enumerated tags
          - limited value tags
          - restricted value tags
        description: A filter for tags that have a restricted set of allowed values defined.
        expr: ALLOWED_VALUES IS NOT NULL AND ALLOWED_VALUES != '[]'
      - name: PIITags
        synonyms:
          - personal data tags
          - PII tags
          - privacy tags
          - sensitive data tags
        description: A filter for tags related to personally identifiable information (PII) classification.
        expr: TAG_NAME LIKE '%PII%'
      - name: RecentlyCreatedTags
        synonyms:
          - fresh tags
          - latest tags
          - new tags
          - recently created tags
        description: A filter for tags created in the last 30 days for tracking new classification development.
        expr: CREATED >= CURRENT_TIMESTAMP - INTERVAL '30 DAYS'
      - name: RecentlyModifiedTags
        synonyms:
          - altered tags
          - changed tags
          - recently modified tags
          - updated tags
        description: A filter for tags that have been modified in the last 7 days for tracking tag changes.
        expr: LAST_ALTERED >= CURRENT_TIMESTAMP - INTERVAL '7 DAYS'
      - name: SecurityClassificationTags
        synonyms:
          - classification tags
          - data classification tags
          - security level tags
          - security tags
        description: A filter for tags used for data security classification and governance.
        expr: TO_VARCHAR(TAG_NAME) ILIKE '%SECURITY%' OR TO_VARCHAR(TAG_NAME) ILIKE '%CLASSIFICATION%' OR TO_VARCHAR(TAG_NAME) ILIKE '%CONFIDENTIAL%' OR TO_VARCHAR(TAG_NAME) ILIKE '%SENSITIVE%'
    metrics:
      - name: ActiveTagPercentage
        synonyms:
          - active tag rate
          - available tag percentage
          - current tag percentage
          - non-deleted tag rate
        description: The percentage of tags that are currently active and not deleted, indicating tag lifecycle management.
        expr: (COUNT(CASE WHEN DELETED IS NULL THEN 1 END) * 100.0) / COUNT(*)
      - name: ComplianceTagPercentage
        synonyms:
          - audit tag rate
          - compliance classification rate
          - compliance tag rate
          - regulatory tag percentage
        description: The percentage of tags used for regulatory compliance and audit purposes (GDPR, HIPAA, SOX).
        expr: (COUNT(CASE WHEN TO_VARCHAR(TAG_NAME) ILIKE '%COMPLIANCE%' OR TO_VARCHAR(TAG_NAME) ILIKE '%GDPR%' OR TO_VARCHAR(TAG_NAME) ILIKE '%HIPAA%' OR TO_VARCHAR(TAG_NAME) ILIKE '%SOX%' THEN 1 END) * 100.0) / COUNT(*)
      - name: EnumeratedTagPercentage
        synonyms:
          - allowed value tag ratio
          - controlled tag rate
          - enumerated tag rate
          - restricted value tag percentage
        description: The percentage of tags with restricted allowed values, indicating controlled data classification.
        expr: (COUNT(CASE WHEN ALLOWED_VALUES IS NOT NULL AND ALLOWED_VALUES != '[]' THEN 1 END) * 100.0) / COUNT(*)
      - name: PIITagPercentage
        synonyms:
          - PII classification rate
          - PII tag rate
          - privacy tag percentage
          - sensitive data tag rate
        description: The percentage of tags related to personally identifiable information, indicating privacy governance coverage.
        expr: (COUNT(CASE WHEN TAG_NAME LIKE '%PII%' THEN 1 END) * 100.0) / COUNT(*)
      - name: SecurityTagPercentage
        synonyms:
          - classification tag percentage
          - governance tag ratio
          - security classification rate
          - security tag rate
        description: The percentage of tags used for security classification and governance purposes.
        expr: (COUNT(CASE WHEN TO_VARCHAR(TAG_NAME) ILIKE '%SECURITY%' OR TO_VARCHAR(TAG_NAME) ILIKE '%CLASSIFICATION%' OR TO_VARCHAR(TAG_NAME) ILIKE '%CONFIDENTIAL%' THEN 1 END) * 100.0) / COUNT(*)
      - name: TotalTagCount
        synonyms:
          - number of tags
          - tag count
          - tag inventory
          - total tags
        description: The total number of tags in the account, indicating data classification and governance scale.
        expr: COUNT(*)
    primary_key:
      columns:
        - TAG_ID
  - name: ROW_ACCESS_POLICIES
    synonyms:
      - RLS policies
      - row level security
    description: A catalog of all row access policies defined in the account. Contains policy name, creation date, and the policy body (SQL expression).
    base_table:
      database: SNOWFLAKE
      schema: ACCOUNT_USAGE
      table: ROW_ACCESS_POLICIES
    dimensions:
      - name: OPTIONS
        synonyms:
          - access options
          - options
          - policy options
        description: Defines the type of access control applied to the dimension, such as whether it is restricted to specific users or roles.
        expr: OPTIONS
        data_type: VARIANT
      - name: OWNER_ROLE_TYPE
        description: The type of role that owns the data, such as a specific job function or department, that is allowed to access the data.
        expr: OWNER_ROLE_TYPE
        data_type: VARCHAR(13)
        sample_values:
          - ROLE
      - name: POLICY_BODY
        synonyms:
          - access rule
          - policy body
          - policy definition
        description: This column defines a row-level access policy that controls which rows of data a user can access based on their role and the sensitivity of the data. It grants full access to admin roles, restricts access to sensitive data in the 'EAST' region, and allows non-sensitive data to be accessed by all regions. Additionally, it allows specific roles to access data based on their assigned city permissions.
        expr: POLICY_BODY
        data_type: VARCHAR(16777216)
        sample_values:
          - |-
            CASE
                    -- Full access for admin roles
                    WHEN CURRENT_ROLE() IN ('ACCOUNTADMIN', 'TAG_DEMO_DATA_SECURITY') THEN TRUE
                    -- Check if table is marked as sensitive
                    WHEN SYSTEM$GET_TAG_ON_CURRENT_TABLE('DATA_SENSITIVITY') = 'SENSITIVE' 
                        AND REGION_CODE = 'EAST' THEN TRUE
                    -- For non-sensitive tables, allow all regions
                    WHEN SYSTEM$GET_TAG_ON_CURRENT_TABLE('DATA_SENSITIVITY') IS NULL THEN TRUE
                    -- Default case - no access
                    ELSE FALSE
                END
          - |-
            CURRENT_ROLE() IN 
                   (
                       'ACCOUNTADMIN','SYSADMIN', 'TASTY_ADMIN', 'TASTY_DATA_ENGINEER', 
                       'TASTY_DATA_APP','TASTY_BI','TASTY_DATA_SCIENTIST','TASTY_DEV'
                   ) 
                    OR EXISTS 
                        (
                        SELECT rp.role 
                            FROM frostbyte_tasty_bytes.public.row_policy_map rp
                        WHERE 1=1
                            AND rp.role = CURRENT_ROLE()
                            AND rp.city_permissions = city
                        )
          - |-
            CASE
                        -- Allow account admins to see everything
                        WHEN 'ACCOUNTADMIN' = CURRENT_ROLE() THEN TRUE
                        -- Define rules for the growth analyst role
                        WHEN 'GROWTH_FUND_ANALYST' = CURRENT_ROLE() THEN
                            account_name_val IN ('Global Growth Portfolio', 'Balanced Fund', 'High Growth Fund')
                        -- Define rules for the conservative analyst role
                        WHEN 'CONSERVATIVE_FUND_ANALYST' = CURRENT_ROLE() THEN
                            account_name_val IN ('Conservative Income', 'Fixed Income Portfolio')
                        -- Deny access to all other roles
                        ELSE FALSE
                    END
      - name: POLICY_CATALOG
        synonyms:
          - catalog
          - database name
          - policy catalog
        description: List of available data catalogs that can be accessed by users, including FROSTBYTE_TASTY_BYTES, TAG_DEMO_FINANCE_DB, and DATASCIENCECOLLEGE.
        expr: POLICY_CATALOG
        data_type: VARCHAR(16777216)
        sample_values:
          - FROSTBYTE_TASTY_BYTES
          - TAG_DEMO_FINANCE_DB
          - DATASCIENCECOLLEGE
      - name: POLICY_COMMENT
        synonyms:
          - comment
          - policy comment
          - policy description
        description: A free-form text field that provides additional context or explanation about the row access policy, such as its purpose, scope, or any other relevant details.
        expr: POLICY_COMMENT
        data_type: VARIANT
      - name: POLICY_NAME
        synonyms:
          - access policy
          - policy
          - policy name
          - row policy
        description: Name of the row access policy applied to control access to sensitive data in the database.
        expr: POLICY_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - TAG_DEMO_PII_POLICY
          - CUSTOMER_CITY_ROW_POLICY
          - FINANCE_REGION_POLICY
      - name: POLICY_OWNER
        synonyms:
          - created by
          - owner
          - policy owner
        description: The owner of the row access policy, which can be either the system administrator (SYSADMIN) or the account administrator (ACCOUNTADMIN).
        expr: POLICY_OWNER
        data_type: VARCHAR(16777216)
        sample_values:
          - SYSADMIN
          - ACCOUNTADMIN
      - name: POLICY_RETURN_TYPE
        synonyms:
          - output type
          - policy return type
          - return type
        description: Indicates whether the policy returns a value of type BOOLEAN.
        expr: POLICY_RETURN_TYPE
        data_type: VARCHAR(16777216)
        sample_values:
          - '{"type":"BOOLEAN","nullable":true}'
      - name: POLICY_SCHEMA
        synonyms:
          - policy schema
          - schema
          - schema name
        description: The schema that owns the row access policy.
        expr: POLICY_SCHEMA
        data_type: VARCHAR(16777216)
        sample_values:
          - PUBLIC
          - DATA_OPS
      - name: POLICY_SIGNATURE
        description: 'This column defines a row access policy signature that restricts data access based on three parameters: sensitivity tag, country code, and account name value, allowing for fine-grained control over data visibility.'
        expr: POLICY_SIGNATURE
        data_type: VARCHAR(16777216)
        sample_values:
          - '{"arguments":[{"identifier":"SENSITIVITY_TAG","datatype":{"type":"TEXT","length":16777216,"byteLength":16777216,"isMaxLength":true,"nullable":true,"fixed":false},"hasDefaultValue":false,"parameterType":"NONE"}]}'
          - '{"arguments":[{"identifier":"COUNTRY_CODE","datatype":{"type":"TEXT","length":16777216,"byteLength":16777216,"isMaxLength":true,"nullable":true,"fixed":false},"hasDefaultValue":false,"parameterType":"NONE"}]}'
          - '{"arguments":[{"identifier":"ACCOUNT_NAME_VAL","datatype":{"type":"TEXT","length":134217728,"byteLength":134217728,"isMaxLength":true,"nullable":true,"fixed":false},"hasDefaultValue":false,"parameterType":"NONE"}]}'
    time_dimensions:
      - name: CREATED
        description: Date and time when the row access policy was created.
        expr: CREATED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2025-04-09T20:58:04.467+0000
          - 2025-04-09T20:52:59.216+0000
          - 2025-04-09T21:01:10.392+0000
      - name: DELETED
        description: Timestamps when rows were deleted.
        expr: DELETED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2025-04-10T15:30:55.802+0000
          - 2025-04-09T21:01:10.392+0000
      - name: LAST_ALTERED
        description: Date and time when the row access policy was last modified.
        expr: LAST_ALTERED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2025-04-09T21:02:20.886+0000
          - 2023-06-01T15:57:44.087+0000
          - 2025-04-10T22:23:12.220+0000
    facts:
      - name: POLICY_CATALOG_ID
        synonyms:
          - catalog id
          - policy catalog id
          - policy database id
        description: Unique identifier for the policy catalog.
        expr: POLICY_CATALOG_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '223'
          - '301'
          - '74'
      - name: POLICY_ID
        synonyms:
          - access policy id
          - policy id
          - policy identifier
        description: Unique identifier for a row access policy.
        expr: POLICY_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '4190'
          - '4187'
          - '4192'
      - name: POLICY_SCHEMA_ID
        synonyms:
          - policy namespace id
          - policy schema id
          - schema id
        description: Unique identifier for the schema that the row access policy is defined in.
        expr: POLICY_SCHEMA_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '272'
          - '136'
          - '580'
    filters:
      - name: ActivePolicies
        synonyms:
          - active policies
          - available policies
          - current policies
          - existing policies
        description: A filter for row access policies that have not been deleted and are currently active.
        expr: DELETED IS NULL
      - name: BooleanReturnPolicies
        synonyms:
          - binary policies
          - boolean policies
          - boolean return policies
          - true false policies
        description: A filter for row access policies that return boolean values for access decisions.
        expr: POLICY_RETURN_TYPE = 'BOOLEAN'
      - name: ConditionalPolicies
        synonyms:
          - complex policies
          - conditional access policies
          - conditional policies
          - logic-based policies
        description: A filter for row access policies with complex conditional logic and multiple criteria.
        expr: TO_VARCHAR(POLICY_BODY) ILIKE '%AND%' OR TO_VARCHAR(POLICY_BODY) ILIKE '%OR%' OR TO_VARCHAR(POLICY_BODY) ILIKE '%CASE%' OR TO_VARCHAR(POLICY_BODY) ILIKE '%WHEN%'
      - name: RecentlyCreatedPolicies
        synonyms:
          - fresh policies
          - latest policies
          - new policies
          - recently created policies
        description: A filter for row access policies created in the last 30 days for tracking new security implementations.
        expr: CREATED >= CURRENT_TIMESTAMP - INTERVAL '30 DAYS'
      - name: RecentlyModifiedPolicies
        synonyms:
          - altered policies
          - changed policies
          - recently modified policies
          - updated policies
        description: A filter for row access policies modified in the last 7 days for tracking security changes.
        expr: LAST_ALTERED >= CURRENT_TIMESTAMP - INTERVAL '7 DAYS'
      - name: RoleBasedPolicies
        synonyms:
          - RBAC policies
          - role access policies
          - role filtering policies
          - role-based policies
        description: A filter for row access policies that implement role-based access control filtering.
        expr: TO_VARCHAR(POLICY_BODY) ILIKE '%CURRENT_ROLE%' OR TO_VARCHAR(POLICY_BODY) ILIKE '%IS_ROLE_IN_SESSION%' OR TO_VARCHAR(POLICY_BODY) ILIKE '%ROLE%'
      - name: UserBasedPolicies
        synonyms:
          - user access policies
          - user filtering policies
          - user-based policies
          - user-specific policies
        description: A filter for row access policies that implement user-based access control filtering.
        expr: TO_VARCHAR(POLICY_BODY) ILIKE '%CURRENT_USER%' OR TO_VARCHAR(POLICY_BODY) ILIKE '%USER%' OR TO_VARCHAR(POLICY_BODY) ILIKE '%SESSION%'
    metrics:
      - name: ActivePolicyPercentage
        synonyms:
          - active policy rate
          - available policy percentage
          - current policy percentage
          - non-deleted policy rate
        description: The percentage of policies that are currently active and not deleted, indicating policy lifecycle management.
        expr: (COUNT(CASE WHEN DELETED IS NULL THEN 1 END) * 100.0) / COUNT(*)
      - name: ConditionalPolicyPercentage
        synonyms:
          - advanced policy ratio
          - complex policy percentage
          - conditional policy rate
          - logic-based policy rate
        description: The percentage of policies with complex conditional logic, indicating sophisticated access control patterns.
        expr: (COUNT(CASE WHEN TO_VARCHAR(POLICY_BODY) ILIKE '%AND%' OR TO_VARCHAR(POLICY_BODY) ILIKE '%OR%' OR TO_VARCHAR(POLICY_BODY) ILIKE '%CASE%' THEN 1 END) * 100.0) / COUNT(*)
      - name: PolicyCreationRate
        synonyms:
          - new policy velocity
          - policy creation rate
          - policy development rate
          - security policy growth
        description: The daily rate of new policy creation, indicating row-level security development and growth trends.
        expr: COUNT(CASE WHEN CREATED >= CURRENT_TIMESTAMP - INTERVAL '30 DAYS' THEN 1 END) / 30.0
      - name: RoleBasedPolicyPercentage
        synonyms:
          - RBAC policy percentage
          - role access percentage
          - role filtering rate
          - role-based policy rate
        description: The percentage of policies implementing role-based access control filtering.
        expr: (COUNT(CASE WHEN TO_VARCHAR(POLICY_BODY) ILIKE '%CURRENT_ROLE%' OR TO_VARCHAR(POLICY_BODY) ILIKE '%IS_ROLE_IN_SESSION%' THEN 1 END) * 100.0) / COUNT(*)
      - name: TotalPolicyCount
        synonyms:
          - number of policies
          - policy count
          - policy inventory
          - total policies
        description: The total number of row access policies in the account, indicating row-level security implementation scale.
        expr: COUNT(*)
      - name: UserBasedPolicyPercentage
        synonyms:
          - user access policy rate
          - user filtering percentage
          - user-based policy rate
          - user-specific policy ratio
        description: The percentage of policies implementing user-based access control filtering.
        expr: (COUNT(CASE WHEN TO_VARCHAR(POLICY_BODY) ILIKE '%CURRENT_USER%' OR TO_VARCHAR(POLICY_BODY) ILIKE '%USER%' THEN 1 END) * 100.0) / COUNT(*)
    primary_key:
      columns:
        - POLICY_ID
  - name: DATABASES
    synonyms:
      - database list
    description: A list of all databases in the account, including dropped databases. Contains metadata like database name, owner, and creation time.
    base_table:
      database: SNOWFLAKE
      schema: ACCOUNT_USAGE
      table: DATABASES
    dimensions:
      - name: COMMENT
        synonyms:
          - comment
          - database comment
          - description
        description: The name of the database being used or referenced.
        expr: COMMENT
        data_type: VARCHAR(16777216)
        sample_values:
          - Snowpark Credit demo DB
      - name: DATABASE_NAME
        synonyms:
          - catalog
          - database
          - database name
          - db name
        description: The name of the database being queried.
        expr: DATABASE_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - TASTY_BYTES_DB
          - CITIBIKE_DEV
          - US_OPEN_CENSUS_DATA__NEIGHBORHOOD_INSIGHTS__FREE_DATASET
      - name: DATABASE_OWNER
        synonyms:
          - created by
          - database owner
          - db owner
          - owner
        description: The role or user account that owns the database, indicating the entity responsible for managing and maintaining the database.
        expr: DATABASE_OWNER
        data_type: VARCHAR(16777216)
        sample_values:
          - DBT_DEV_ROLE
          - XGB_GPU_LAB_USER
          - ML_MODEL_ROLE
      - name: IS_TRANSIENT
        synonyms:
          - is transient
          - temp database
          - temporary
        description: Indicates whether the database is temporary or permanent.
        expr: IS_TRANSIENT
        data_type: VARCHAR(3)
        sample_values:
          - 'NO'
      - name: OBJECT_VISIBILITY
        synonyms:
          - access visibility
          - object visibility
          - visibility
        description: Indicates whether the object is visible to all users or only to the user who created it.
        expr: OBJECT_VISIBILITY
        data_type: OBJECT
      - name: OWNER_ROLE_TYPE
        synonyms:
          - owner role type
          - owner type
          - role type
        description: The type of role the owner has within the database, such as administrator, user, or read-only.
        expr: OWNER_ROLE_TYPE
        data_type: VARCHAR(13)
        sample_values:
          - ROLE
      - name: REPLICABLE_WITH_FAILOVER_GROUPS
        synonyms:
          - failover groups
          - failover replicable
          - replication enabled
        description: Indicates whether the database can be replicated with failover groups.
        expr: REPLICABLE_WITH_FAILOVER_GROUPS
        data_type: VARCHAR(16777216)
        sample_values:
          - UNSET
      - name: RESOURCE_GROUP
        synonyms:
          - budget group
          - internal resource group
          - resource group
        description: The RESOURCE_GROUP column represents the internal resource group responsible for managing the budget.
        expr: RESOURCE_GROUP
        data_type: VARCHAR(16777216)
        sample_values:
          - BUDGET_INTERNAL_RESOURCE_GROUP
      - name: TYPE
        synonyms:
          - database category
          - database type
          - type
        description: The type of database, indicating whether it is a personal database created by a user, a standard database provided by the system, or an imported database from an external source.
        expr: TYPE
        data_type: VARCHAR(19)
        sample_values:
          - PERSONAL DATABASE
          - STANDARD
          - IMPORTED DATABASE
    time_dimensions:
      - name: CREATED
        synonyms:
          - created
          - created date
          - creation time
        description: Date and time when the database was created.
        expr: CREATED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2024-08-13T16:57:18.823+0000
          - 2022-12-21T19:18:14.225+0000
          - 2023-05-05T16:04:18.494+0000
      - name: DELETED
        synonyms:
          - deleted
          - deleted date
          - deletion time
        description: Date and time when the database was deleted.
        expr: DELETED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2023-08-10T19:25:47.770+0000
          - 2023-02-03T14:30:39.746+0000
          - 2023-02-02T19:36:07.556+0000
      - name: LAST_ALTERED
        synonyms:
          - last altered
          - last modified
          - modified date
        description: The date and time when the database was last modified or updated.
        expr: LAST_ALTERED
        data_type: TIMESTAMP_LTZ(6)
        sample_values:
          - 2024-02-26T18:36:53.347+0000
          - 2023-01-24T14:56:38.386+0000
          - 2023-02-04T16:14:41.943+0000
    facts:
      - name: DATABASE_ID
        synonyms:
          - database id
          - database identifier
          - db id
        description: Unique identifier for a database.
        expr: DATABASE_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '27'
          - '352'
          - '24'
      - name: RETENTION_TIME
        synonyms:
          - retention period
          - retention time
          - time travel
        description: The amount of time, in minutes, that data is retained in the database before it is automatically deleted or archived.
        expr: RETENTION_TIME
        data_type: NUMBER(38,0)
        sample_values:
          - '1'
          - '30'
    filters:
      - name: ActiveDatabases
        synonyms:
          - active databases
          - available databases
          - current databases
          - existing databases
        description: A filter for databases that have not been deleted and are currently available for use.
        expr: DELETED IS NULL
      - name: DevelopmentDatabases
        synonyms:
          - dev databases
          - development databases
          - sandbox databases
          - test databases
        description: A filter for databases that appear to be development or testing environments.
        expr: TO_VARCHAR(DATABASE_NAME) ILIKE '%DEV%' OR TO_VARCHAR(DATABASE_NAME) ILIKE '%TEST%' OR TO_VARCHAR(DATABASE_NAME) ILIKE '%SANDBOX%' OR TO_VARCHAR(DATABASE_NAME) ILIKE '%STAGING%'
      - name: ImportedDatabases
        synonyms:
          - cross-account databases
          - external databases
          - imported databases
          - shared databases
        description: A filter for databases that are imported from shares or other accounts.
        expr: TYPE = 'IMPORTED DATABASE'
      - name: ProductionDatabases
        synonyms:
          - live databases
          - operational databases
          - prod databases
          - production databases
        description: A filter for databases that appear to be production environments based on naming conventions.
        expr: TO_VARCHAR(DATABASE_NAME) ILIKE '%PROD%' OR TO_VARCHAR(DATABASE_NAME) ILIKE '%PRODUCTION%' OR TO_VARCHAR(DATABASE_NAME) ILIKE '%LIVE%'
      - name: RecentlyCreatedDatabases
        synonyms:
          - fresh databases
          - latest databases
          - new databases
          - recently created databases
        description: A filter for databases created in the last 30 days for tracking new database development.
        expr: CREATED >= CURRENT_TIMESTAMP - INTERVAL '30 DAYS'
      - name: RecentlyModifiedDatabases
        synonyms:
          - altered databases
          - changed databases
          - recently modified databases
          - updated databases
        description: A filter for databases that have been modified in the last 7 days for tracking database changes.
        expr: LAST_ALTERED >= CURRENT_TIMESTAMP - INTERVAL '7 DAYS'
      - name: ReplicatedDatabases
        synonyms:
          - backup databases
          - disaster recovery databases
          - failover databases
          - replicated databases
        description: A filter for databases that are configured for replication and failover groups.
        expr: REPLICABLE_WITH_FAILOVER_GROUPS = 'YES'
      - name: StandardDatabases
        synonyms:
          - normal databases
          - regular databases
          - standard databases
          - typical databases
        description: A filter for standard databases as opposed to imported or personal databases.
        expr: TYPE = 'STANDARD'
      - name: TransientDatabases
        synonyms:
          - non-persistent databases
          - temp databases
          - temporary databases
          - transient databases
        description: A filter for transient databases that don't contribute to Fail-safe costs.
        expr: IS_TRANSIENT = 'YES'
    metrics:
      - name: ActiveDatabasePercentage
        synonyms:
          - active database rate
          - available database percentage
          - current database percentage
          - non-deleted database rate
        description: The percentage of databases that are currently active and not deleted, indicating database lifecycle management.
        expr: (COUNT(CASE WHEN DELETED IS NULL THEN 1 END) * 100.0) / COUNT(*)
      - name: DatabaseCreationRate
        synonyms:
          - database creation rate
          - database development rate
          - database growth rate
          - new database velocity
        description: The daily rate of new database creation, indicating data platform development and growth trends.
        expr: COUNT(CASE WHEN CREATED >= CURRENT_TIMESTAMP - INTERVAL '30 DAYS' THEN 1 END) / 30.0
      - name: ProductionDatabasePercentage
        synonyms:
          - live database ratio
          - operational database rate
          - prod environment percentage
          - production database rate
        description: The percentage of databases that appear to be production environments based on naming conventions.
        expr: (COUNT(CASE WHEN TO_VARCHAR(DATABASE_NAME) ILIKE '%PROD%' OR TO_VARCHAR(DATABASE_NAME) ILIKE '%PRODUCTION%' THEN 1 END) * 100.0) / COUNT(*)
      - name: ReplicatedDatabasePercentage
        synonyms:
          - disaster recovery rate
          - failover database percentage
          - replicated database rate
          - replication adoption rate
        description: The percentage of databases configured for replication and failover groups, indicating disaster recovery maturity.
        expr: (COUNT(CASE WHEN REPLICABLE_WITH_FAILOVER_GROUPS = 'YES' THEN 1 END) * 100.0) / COUNT(*)
      - name: StandardDatabasePercentage
        synonyms:
          - normal database ratio
          - regular database percentage
          - standard database rate
          - typical database rate
        description: The percentage of databases that are standard type versus imported or shared databases, indicating database architecture patterns.
        expr: (COUNT(CASE WHEN TYPE = 'STANDARD' THEN 1 END) * 100.0) / COUNT(*)
      - name: TotalDatabaseCount
        synonyms:
          - database count
          - database inventory
          - number of databases
          - total databases
        description: The total number of databases in the account, indicating data organization scale and complexity.
        expr: COUNT(*)
      - name: TransientDatabasePercentage
        synonyms:
          - non-persistent database rate
          - temporary database percentage
          - transient database rate
          - transient database ratio
        description: The percentage of databases configured as transient, indicating data persistence and cost optimization strategy.
        expr: (COUNT(CASE WHEN IS_TRANSIENT = 'YES' THEN 1 END) * 100.0) / COUNT(*)
    primary_key:
      columns:
        - DATABASE_NAME
relationships:
  - name: UserExecutedQuery
    left_table: QUERY_HISTORY
    relationship_columns:
      - left_column: USER_NAME
        right_column: NAME
    right_table: USERS
  - name: RoleUsedForQuery
    left_table: QUERY_HISTORY
    relationship_columns:
      - left_column: ROLE_NAME
        right_column: NAME
    right_table: ROLES
  - name: QueryAccessesDatabase
    left_table: QUERY_HISTORY
    relationship_columns:
      - left_column: DATABASE_NAME
        right_column: DATABASE_NAME
    right_table: DATABASES
  - name: TableBelongsToDatabase
    left_table: TABLES
    relationship_columns:
      - left_column: TABLE_CATALOG
        right_column: DATABASE_NAME
    right_table: DATABASES
  - name: QueryGeneratesInsights
    left_table: QUERY_INSIGHTS
    relationship_columns:
      - left_column: QUERY_ID
        right_column: QUERY_ID
    right_table: QUERY_HISTORY
  - name: TableBelongsToSchema
    left_table: TABLES
    relationship_columns:
      - left_column: TABLE_SCHEMA
        right_column: SCHEMA_NAME
    right_table: SCHEMATA
  - name: ViewBelongsToSchema
    left_table: VIEWS
    relationship_columns:
      - left_column: TABLE_SCHEMA
        right_column: SCHEMA_NAME
    right_table: SCHEMATA
  - name: SchemaBelongsToDatabase
    left_table: SCHEMATA
    relationship_columns:
      - left_column: CATALOG_NAME
        right_column: DATABASE_NAME
    right_table: DATABASES
  - name: PolicyBelongsToDatabase
    left_table: ROW_ACCESS_POLICIES
    relationship_columns:
      - left_column: POLICY_CATALOG
        right_column: DATABASE_NAME
    right_table: DATABASES
  - name: TagBelongsToDatabase
    left_table: TAGS
    relationship_columns:
      - left_column: TAG_DATABASE
        right_column: DATABASE_NAME
    right_table: DATABASES
  - name: QueryAttributionToQueryHistory
    left_table: QUERY_ATTRIBUTION_HISTORY
    relationship_columns:
      - left_column: QUERY_ID
        right_column: QUERY_ID
    right_table: QUERY_HISTORY
  - name: QueryAttributionByUser
    left_table: QUERY_ATTRIBUTION_HISTORY
    relationship_columns:
      - left_column: USER_NAME
        right_column: NAME
    right_table: USERS
  - name: QueryAttributionToInsights
    left_table: QUERY_ATTRIBUTION_HISTORY
    relationship_columns:
      - left_column: QUERY_ID
        right_column: QUERY_ID
    right_table: QUERY_INSIGHTS
verified_queries:
  - name: What is the total execution time for all queries executed by the ACCOUNTADMIN role last month?
    question: What is the total execution time for all queries executed by the ACCOUNTADMIN role last month?
    sql: |-
      SELECT
        ROUND(
          IFF(
            SUM(total_elapsed_time) / NULLIF(1000, 0) IS NULL,
            0,
            SUM(total_elapsed_time) / NULLIF(1000, 0)
          ),
          2
        ) AS total_execution_time_seconds
      FROM
        query_history
      WHERE
        role_name = 'ACCOUNTADMIN'
        AND start_time >= DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '1 MONTH')
        AND start_time < DATE_TRUNC('MONTH', CURRENT_DATE)
    use_as_onboarding_question: false
    verified_by: Matt Harris
    verified_at: 1758678414
  - name: Show me dormant users who haven't logged in for over 30 days by role
    question: Show me dormant users who haven't logged in for over 30 days by role
    sql: |-
      SELECT
        u.default_role,
        COUNT(*) AS dormant_user_count,
        u.name AS user_name,
        u.display_name,
        u.email,
        u.type AS user_type,
        u.last_success_login,
        CASE
          WHEN u.last_success_login IS NULL THEN 'Never logged in'
          ELSE CONCAT(
            DATEDIFF(DAY, u.last_success_login, CURRENT_TIMESTAMP()),
            ' days ago'
          )
        END AS days_since_last_login,
        u.created_on,
        CASE
          WHEN u.disabled = TRUE THEN 'Disabled'
          WHEN NOT u.deleted_on IS NULL THEN 'Deleted'
          ELSE 'Active'
        END AS account_status
      FROM
        users AS u
      WHERE
        u.deleted_on IS NULL
        AND (
          u.last_success_login < CURRENT_TIMESTAMP() - INTERVAL '30 DAYS'
          OR u.last_success_login IS NULL
        )
      GROUP BY
        u.default_role,
        u.name,
        u.display_name,
        u.email,
        u.type,
        u.last_success_login,
        u.created_on,
        u.disabled,
        u.deleted_on
      ORDER BY
        u.default_role,
        u.last_success_login ASC
    use_as_onboarding_question: false
    verified_by: Matt Harris
    verified_at: 1758731722
  - name: Which databases have PII tags?
    question: Which databases have PII tags?
    sql: |-
      SELECT
        DISTINCT t.tag_database AS database_name,
        d.database_owner,
        d.created AS database_created,
        d.type AS database_type,
        d.is_transient,
        COUNT(DISTINCT t.tag_name) AS pii_tag_count,
        LISTAGG(DISTINCT t.tag_name, ', ') AS pii_tag_names
      FROM
        tags AS t
        LEFT OUTER JOIN databases AS d ON t.tag_database = d.database_name
      WHERE
        t.tag_name LIKE '%PII%'
        AND t.deleted IS NULL
        AND d.deleted IS NULL
      GROUP BY
        t.tag_database,
        d.database_owner,
        d.created,
        d.type,
        d.is_transient
      ORDER BY
        t.tag_database
    use_as_onboarding_question: false
    verified_by: Matt Harris
    verified_at: 1758733074
  - name: 'Show me a comprehensive governance report: active policies, tag coverage, and user access patterns by database hierarchy'
    question: 'Show me a comprehensive governance report: active policies, tag coverage, and user access patterns by database hierarchy'
    sql: |-
      WITH active_policies AS (
        SELECT
          rap.policy_catalog AS database_name,
          rap.policy_schema AS schema_name,
          COUNT(*) AS active_policy_count,
          COUNT(
            CASE
              WHEN TO_VARCHAR(rap.policy_body) ILIKE '%CURRENT_ROLE%' THEN 1
            END
          ) AS role_based_policies,
          COUNT(
            CASE
              WHEN TO_VARCHAR(rap.policy_body) ILIKE '%CURRENT_USER%' THEN 1
            END
          ) AS user_based_policies,
          COUNT(
            CASE
              WHEN TO_VARCHAR(rap.policy_body) ILIKE '%CASE%'
              OR TO_VARCHAR(rap.policy_body) ILIKE '%WHEN%' THEN 1
            END
          ) AS conditional_policies
        FROM
          row_access_policies AS rap
        WHERE
          rap.deleted IS NULL
        GROUP BY
          rap.policy_catalog,
          rap.policy_schema
      ),
      tag_coverage AS (
        SELECT
          t.tag_database AS database_name,
          t.tag_schema AS schema_name,
          COUNT(*) AS total_tags,
          COUNT(
            CASE
              WHEN t.tag_name LIKE '%PII%' THEN 1
            END
          ) AS pii_tags,
          COUNT(
            CASE
              WHEN TO_VARCHAR(t.tag_name) ILIKE '%SECURITY%'
              OR TO_VARCHAR(t.tag_name) ILIKE '%CLASSIFICATION%' THEN 1
            END
          ) AS security_tags,
          COUNT(
            CASE
              WHEN NOT t.allowed_values IS NULL
              AND t.allowed_values <> '[]' THEN 1
            END
          ) AS enumerated_tags
        FROM
          tags AS t
        WHERE
          t.deleted IS NULL
        GROUP BY
          t.tag_database,
          t.tag_schema
      ),
      database_summary AS (
        SELECT
          d.database_name,
          d.database_owner,
          d.type AS database_type,
          d.created AS database_created,
          COUNT(DISTINCT s.schema_name) AS schema_count,
          COUNT(DISTINCT tb.table_name) AS table_count,
          COUNT(DISTINCT v.table_name) AS view_count,
          ROUND(
            SUM(tb.bytes) / NULLIF(NULLIF(POWER(1024, 3), 0), 0),
            2
          ) AS total_storage_gb
        FROM
          databases AS d
          LEFT OUTER JOIN schemata AS s ON d.database_name = s.catalog_name
          AND s.deleted IS NULL
          LEFT OUTER JOIN tables AS tb ON d.database_name = tb.table_catalog
          AND tb.deleted IS NULL
          LEFT OUTER JOIN views AS v ON d.database_name = v.table_catalog
          AND v.deleted IS NULL
        WHERE
          d.deleted IS NULL
        GROUP BY
          d.database_name,
          d.database_owner,
          d.type,
          d.created
      ),
      user_access_patterns AS (
        SELECT
          qh.database_name,
          COUNT(DISTINCT qh.user_name) AS unique_users,
          COUNT(DISTINCT qh.role_name) AS unique_roles,
          COUNT(*) AS total_queries,
          ROUND(
            AVG(
              qh.total_elapsed_time / NULLIF(NULLIF(1000.0, 0), 0)
            ),
            2
          ) AS avg_execution_time_seconds,
          COUNT(
            CASE
              WHEN qh.start_time >= CURRENT_TIMESTAMP() - INTERVAL '7 DAYS' THEN 1
            END
          ) AS recent_queries_7d,
          COUNT(
            CASE
              WHEN NOT qh.error_code IS NULL THEN 1
            END
          ) AS failed_queries
        FROM
          query_history AS qh
        WHERE
          qh.start_time >= CURRENT_TIMESTAMP() - INTERVAL '30 DAYS'
          AND NOT qh.database_name IS NULL
        GROUP BY
          qh.database_name
      ),
      user_security_summary AS (
        SELECT
          COUNT(*) AS total_users,
          COUNT(
            CASE
              WHEN u.deleted_on IS NULL THEN 1
            END
          ) AS active_users,
          COUNT(
            CASE
              WHEN u.has_mfa = TRUE THEN 1
            END
          ) AS mfa_enabled_users,
          COUNT(
            CASE
              WHEN u.last_success_login >= CURRENT_TIMESTAMP() - INTERVAL '30 DAYS' THEN 1
            END
          ) AS recent_login_users,
          COUNT(
            CASE
              WHEN u.type = 'SERVICE' THEN 1
            END
          ) AS service_accounts,
          ROUND(
            (
              COUNT(
                CASE
                  WHEN u.has_mfa = TRUE THEN 1
                END
              ) * 100.0
            ) / NULLIF(
              NULLIF(
                COUNT(
                  CASE
                    WHEN u.deleted_on IS NULL THEN 1
                  END
                ),
                0
              ),
              0
            ),
            2
          ) AS mfa_adoption_percentage
        FROM
          users AS u
      ),
      policy_summary AS (
        SELECT
          database_name,
          SUM(active_policy_count) AS active_policy_count,
          SUM(role_based_policies) AS role_based_policies,
          SUM(user_based_policies) AS user_based_policies,
          SUM(conditional_policies) AS conditional_policies
        FROM
          active_policies
        GROUP BY
          database_name
      ),
      tag_summary AS (
        SELECT
          database_name,
          SUM(total_tags) AS total_tags,
          SUM(pii_tags) AS pii_tags,
          SUM(security_tags) AS security_tags,
          SUM(enumerated_tags) AS enumerated_tags
        FROM
          tag_coverage
        GROUP BY
          database_name
      )
      SELECT
        ds.database_name,
        ds.database_owner,
        ds.database_type,
        ds.database_created,
        ds.schema_count,
        ds.table_count,
        ds.view_count,
        ds.total_storage_gb,
        COALESCE(ps.active_policy_count, 0) AS total_policies,
        COALESCE(ps.role_based_policies, 0) AS role_based_policies,
        COALESCE(ps.user_based_policies, 0) AS user_based_policies,
        COALESCE(ps.conditional_policies, 0) AS conditional_policies,
        COALESCE(ts.total_tags, 0) AS total_tags,
        COALESCE(ts.pii_tags, 0) AS pii_tags,
        COALESCE(ts.security_tags, 0) AS security_tags,
        COALESCE(ts.enumerated_tags, 0) AS enumerated_tags,
        COALESCE(uap.unique_users, 0) AS active_users_30d,
        COALESCE(uap.unique_roles, 0) AS active_roles_30d,
        COALESCE(uap.total_queries, 0) AS total_queries_30d,
        COALESCE(uap.avg_execution_time_seconds, 0) AS avg_execution_time_seconds,
        COALESCE(uap.recent_queries_7d, 0) AS recent_queries_7d,
        COALESCE(uap.failed_queries, 0) AS failed_queries_30d,
        uss.total_users AS account_total_users,
        uss.active_users AS account_active_users,
        uss.mfa_enabled_users AS account_mfa_users,
        uss.recent_login_users AS account_recent_logins,
        uss.service_accounts AS account_service_accounts,
        uss.mfa_adoption_percentage AS account_mfa_adoption_rate
      FROM
        database_summary AS ds
        LEFT OUTER JOIN policy_summary AS ps ON ds.database_name = ps.database_name
        LEFT OUTER JOIN tag_summary AS ts ON ds.database_name = ts.database_name
        LEFT OUTER JOIN user_access_patterns AS uap ON ds.database_name = uap.database_name
        CROSS JOIN user_security_summary AS uss
      ORDER BY
        ds.total_storage_gb DESC NULLS LAST,
        ds.table_count DESC NULLS LAST
    use_as_onboarding_question: false
    verified_by: Matt Harris
    verified_at: 1758735124
  - name: What are our top 5 warehouse costs in August?
    question: What are our top 5 warehouse costs in August?
    sql: |-
      SELECT
        wmh.warehouse_name,
        ROUND(SUM(wmh.credits_used), 2) AS total_credits_used,
        ROUND(SUM(wmh.credits_used_compute), 2) AS total_compute_credits,
        ROUND(SUM(wmh.credits_used_cloud_services), 2) AS total_cloud_services_credits,
        COUNT(*) AS total_hours_active,
        MIN(wmh.start_time) AS period_start,
        MAX(wmh.end_time) AS period_end
      FROM
        warehouse_metering_history AS wmh
      WHERE
        DATE_TRUNC('MONTH', wmh.start_time) = '2025-08-01'
      GROUP BY
        wmh.warehouse_name
      ORDER BY
        total_credits_used DESC NULLS LAST
      LIMIT
        5
    use_as_onboarding_question: false
    verified_by: Matt Harris
    verified_at: 1758811922
  - name: What are the monthly costs trends (for this calendar year)  for the top 10 most used warehouses.
    question: What are the monthly costs trends (for this calendar year)  for the top 10 most used warehouses.
    sql: |-
      WITH warehouse_total_usage AS (
        SELECT
          wmh.warehouse_name,
          ROUND(SUM(wmh.credits_used), 2) AS total_credits_used
        FROM
          warehouse_metering_history AS wmh
        WHERE
          DATE_PART('YEAR', wmh.start_time) = 2025
        GROUP BY
          wmh.warehouse_name
        ORDER BY
          total_credits_used DESC NULLS LAST
        LIMIT
          10
      ), monthly_costs AS (
        SELECT
          wmh.warehouse_name,
          DATE_TRUNC('MONTH', wmh.start_time) AS month,
          ROUND(SUM(wmh.credits_used), 2) AS monthly_credits_used,
          ROUND(SUM(wmh.credits_used_compute), 2) AS monthly_compute_credits,
          ROUND(SUM(wmh.credits_used_cloud_services), 2) AS monthly_cloud_services_credits
        FROM
          warehouse_metering_history AS wmh
        WHERE
          DATE_PART('YEAR', wmh.start_time) = 2025
          AND wmh.warehouse_name IN (
            SELECT
              warehouse_name
            FROM
              warehouse_total_usage
          )
        GROUP BY
          wmh.warehouse_name,
          DATE_TRUNC('MONTH', wmh.start_time)
      )
      SELECT
        mc.warehouse_name,
        mc.month,
        mc.monthly_credits_used,
        mc.monthly_compute_credits,
        mc.monthly_cloud_services_credits,
        wtu.total_credits_used AS total_annual_credits
      FROM
        monthly_costs AS mc
        LEFT OUTER JOIN warehouse_total_usage AS wtu ON mc.warehouse_name = wtu.warehouse_name
      ORDER BY
        wtu.total_credits_used DESC NULLS LAST,
        mc.month
    use_as_onboarding_question: false
    verified_by: Matt Harris
    verified_at: 1758817631
  - name: What's the relationship between warehouse size and query failure rate?
    question: What's the relationship between warehouse size and query failure rate?
    sql: |-
      SELECT
        qh.warehouse_size,
        COUNT(*) AS total_queries,
        COUNT(
          CASE
            WHEN NOT qh.error_code IS NULL THEN 1
          END
        ) AS failed_queries,
        ROUND(
          (
            COUNT(
              CASE
                WHEN NOT qh.error_code IS NULL THEN 1
              END
            ) * 100.0
          ) / NULLIF(NULLIF(COUNT(*), 0), 0),
          2
        ) AS failure_rate_percentage
      FROM
        query_history AS qh
      WHERE
        NOT qh.warehouse_size IS NULL
      GROUP BY
        qh.warehouse_size
      ORDER BY
        qh.warehouse_size
    use_as_onboarding_question: false
    verified_by: Matt Harris
    verified_at: 1758818103
  - name: Show me low usage warehouses that might be candidates for downsizing
    question: Show me low usage warehouses that might be candidates for downsizing
    sql: |-
      SELECT
        wmh.warehouse_name,
        ROUND(SUM(wmh.credits_used), 2) AS total_credits_used,
        ROUND(SUM(wmh.credits_used_compute), 2) AS total_compute_credits,
        ROUND(SUM(wmh.credits_used_cloud_services), 2) AS total_cloud_services_credits,
        COUNT(*) AS total_hours_active,
        ROUND(
          SUM(wmh.credits_used) / NULLIF(NULLIF(COUNT(*), 0), 0),
          4
        ) AS avg_credits_per_hour,
        MIN(wmh.start_time) AS period_start,
        MAX(wmh.end_time) AS period_end
      FROM
        warehouse_metering_history AS wmh
      WHERE
        wmh.credits_used > 0
        AND wmh.credits_used < 0.1
      GROUP BY
        wmh.warehouse_name
      HAVING
        ROUND(
          SUM(wmh.credits_used) / NULLIF(NULLIF(COUNT(*), 0), 0),
          4
        ) < 0.1
      ORDER BY
        avg_credits_per_hour ASC,
        total_credits_used ASC
    use_as_onboarding_question: false
    verified_by: Matt Harris
    verified_at: 1758818669
  - name: What is the monthly cost by user for the past 12 months?
    question: What is the monthly cost by user for the past 12 months?
    sql: |-
      WITH monthly_user_warehouse_usage AS (
        SELECT
          qh.user_name,
          wmh.warehouse_name,
          DATE_TRUNC('MONTH', qh.start_time) AS month,
          SUM(qh.total_elapsed_time) AS user_execution_time_ms
        FROM
          query_history AS qh
          LEFT OUTER JOIN warehouse_metering_history AS wmh ON qh.warehouse_name = wmh.warehouse_name
          AND DATE_TRUNC('HOUR', qh.start_time) = wmh.start_time
        WHERE
          qh.start_time >= DATE_TRUNC('MONTH', CURRENT_DATE) - INTERVAL '12 MONTHS'
          AND qh.start_time < DATE_TRUNC('MONTH', CURRENT_DATE)
          AND NOT qh.user_name IS NULL
        GROUP BY
          qh.user_name,
          wmh.warehouse_name,
          DATE_TRUNC('MONTH', qh.start_time)
      ),
      monthly_warehouse_usage AS (
        SELECT
          warehouse_name,
          month,
          SUM(user_execution_time_ms) AS total_warehouse_execution_time_ms
        FROM
          monthly_user_warehouse_usage
        GROUP BY
          warehouse_name,
          month
      ),
      monthly_warehouse_costs AS (
        SELECT
          wmh.warehouse_name,
          DATE_TRUNC('MONTH', wmh.start_time) AS month,
          ROUND(SUM(wmh.credits_used), 2) AS monthly_credits_used
        FROM
          warehouse_metering_history AS wmh
        WHERE
          wmh.start_time >= DATE_TRUNC('MONTH', CURRENT_DATE) - INTERVAL '12 MONTHS'
          AND wmh.start_time < DATE_TRUNC('MONTH', CURRENT_DATE)
        GROUP BY
          wmh.warehouse_name,
          DATE_TRUNC('MONTH', wmh.start_time)
      ),
      user_cost_attribution AS (
        SELECT
          muwu.user_name,
          muwu.month,
          ROUND(
            SUM(
              mwc.monthly_credits_used * (
                muwu.user_execution_time_ms / NULLIF(
                  NULLIF(mwu.total_warehouse_execution_time_ms, 0),
                  0
                )
              )
            ),
            2
          ) AS attributed_credits_used
        FROM
          monthly_user_warehouse_usage AS muwu
          LEFT OUTER JOIN monthly_warehouse_usage AS mwu ON muwu.warehouse_name = mwu.warehouse_name
          AND muwu.month = mwu.month
          LEFT OUTER JOIN monthly_warehouse_costs AS mwc ON muwu.warehouse_name = mwc.warehouse_name
          AND muwu.month = mwc.month
        WHERE
          NOT mwc.monthly_credits_used IS NULL
        GROUP BY
          muwu.user_name,
          muwu.month
      )
      SELECT
        uca.user_name,
        uca.month,
        IFF(
          uca.attributed_credits_used IS NULL,
          0,
          uca.attributed_credits_used
        ) AS monthly_credits_used
      FROM
        user_cost_attribution AS uca
      ORDER BY
        uca.month DESC NULLS LAST,
        uca.attributed_credits_used DESC NULLS LAST
    use_as_onboarding_question: false
    verified_by: Matt Harris
    verified_at: 1759171355
  - name: Show me the relationship between table scan insights and actual query performance across different user roles
    question: Show me the relationship between table scan insights and actual query performance across different user roles
    sql: |-
      WITH insight_queries AS (
        SELECT
          qi.query_id,
          qi.insight_topic,
          qi.is_opportunity,
          qi.total_elapsed_time AS insight_elapsed_time
        FROM
          query_insights AS qi
        WHERE
          qi.insight_topic = 'TABLE_SCAN'
      ),
      query_performance AS (
        SELECT
          qh.query_id,
          qh.user_name,
          qh.role_name,
          ROUND(qh.total_elapsed_time / NULLIF(1000, 0), 2) AS execution_time_seconds,
          ROUND(qh.bytes_scanned / NULLIF(POWER(1024, 3), 0), 2) AS data_scanned_gb,
          ROUND(
            (
              qh.queued_overload_time + qh.queued_provisioning_time
            ) / NULLIF(1000, 0),
            2
          ) AS queue_wait_seconds,
          qh.compilation_time
        FROM
          query_history AS qh
        WHERE
          NOT qh.role_name IS NULL
      )
      SELECT
        qp.role_name,
        COUNT(DISTINCT iq.query_id) AS table_scan_insights_count,
        COUNT(DISTINCT qp.query_id) AS total_queries,
        ROUND(
          (COUNT(DISTINCT iq.query_id) * 100.0) / NULLIF(NULLIF(COUNT(DISTINCT qp.query_id), 0), 0),
          2
        ) AS table_scan_insight_percentage,
        ROUND(
          AVG(
            CASE
              WHEN NOT iq.query_id IS NULL THEN qp.execution_time_seconds
            END
          ),
          2
        ) AS avg_execution_time_with_scans_seconds,
        ROUND(
          AVG(
            CASE
              WHEN iq.query_id IS NULL THEN qp.execution_time_seconds
            END
          ),
          2
        ) AS avg_execution_time_without_scans_seconds,
        ROUND(
          AVG(
            CASE
              WHEN NOT iq.query_id IS NULL THEN qp.data_scanned_gb
            END
          ),
          2
        ) AS avg_data_scanned_with_scans_gb,
        ROUND(
          AVG(
            CASE
              WHEN iq.query_id IS NULL THEN qp.data_scanned_gb
            END
          ),
          2
        ) AS avg_data_scanned_without_scans_gb,
        ROUND(
          AVG(
            CASE
              WHEN NOT iq.query_id IS NULL THEN qp.queue_wait_seconds
            END
          ),
          2
        ) AS avg_queue_wait_with_scans_seconds,
        ROUND(
          AVG(
            CASE
              WHEN iq.query_id IS NULL THEN qp.queue_wait_seconds
            END
          ),
          2
        ) AS avg_queue_wait_without_scans_seconds
      FROM
        query_performance AS qp
        LEFT OUTER JOIN insight_queries AS iq ON qp.query_id = iq.query_id
      GROUP BY
        qp.role_name
      HAVING
        COUNT(DISTINCT qp.query_id) >= 10
      ORDER BY
        table_scan_insight_percentage DESC NULLS LAST
    use_as_onboarding_question: false
    verified_by: Matt Harris
    verified_at: 1759171511
  - name: 'Show me optimization opportunities across all three pillars: expensive queries that could be optimized, security gaps in high-usage databases, and performance bottlenecks by role'
    question: 'Show me optimization opportunities across all three pillars: expensive queries that could be optimized, security gaps in high-usage databases, and performance bottlenecks by role'
    sql: |-
      WITH expensive_queries AS (
        SELECT
          qh.query_id,
          qh.user_name,
          qh.role_name,
          qh.database_name,
          ROUND(qh.total_elapsed_time / NULLIF(1000, 0), 2) AS execution_time_seconds,
          ROUND(qh.bytes_scanned / NULLIF(POWER(1024, 3), 0), 2) AS data_scanned_gb,
          ROUND(qh.credits_used_cloud_services, 4) AS cloud_services_credits,
          qh.query_type
        FROM
          query_history AS qh
        WHERE
          qh.total_elapsed_time > 300000
          OR qh.bytes_scanned > 1073741824
          OR qh.credits_used_cloud_services > 0.001
      ),
      database_usage AS (
        SELECT
          qh.database_name,
          COUNT(*) AS total_queries,
          COUNT(DISTINCT qh.user_name) AS unique_users,
          ROUND(AVG(qh.total_elapsed_time / NULLIF(1000, 0)), 2) AS avg_execution_time_seconds,
          ROUND(
            SUM(qh.bytes_scanned) / NULLIF(POWER(1024, 3), 0),
            2
          ) AS total_data_scanned_gb
        FROM
          query_history AS qh
        WHERE
          NOT qh.database_name IS NULL
        GROUP BY
          qh.database_name
      ),
      security_gaps AS (
        SELECT
          du.database_name,
          du.total_queries,
          du.unique_users,
          du.avg_execution_time_seconds,
          du.total_data_scanned_gb,
          CASE
            WHEN d.database_name IS NULL THEN 'Database not found'
            WHEN d.type = 'IMPORTED DATABASE' THEN 'External database - review access'
            WHEN d.is_transient = 'NO'
            AND du.total_queries > 1000 THEN 'High usage permanent database'
            ELSE 'Standard database'
          END AS security_risk_level
        FROM
          database_usage AS du
          LEFT OUTER JOIN databases AS d ON du.database_name = d.database_name
        WHERE
          du.total_queries > 100
      ),
      role_performance AS (
        SELECT
          qh.role_name,
          COUNT(*) AS total_queries,
          COUNT(
            CASE
              WHEN NOT qh.error_code IS NULL THEN 1
            END
          ) AS failed_queries,
          ROUND(
            (
              COUNT(
                CASE
                  WHEN NOT qh.error_code IS NULL THEN 1
                END
              ) * 100.0
            ) / NULLIF(NULLIF(COUNT(*), 0), 0),
            2
          ) AS failure_rate_percentage,
          ROUND(AVG(qh.total_elapsed_time / NULLIF(1000, 0)), 2) AS avg_execution_time_seconds,
          ROUND(
            AVG(
              (
                qh.queued_overload_time + qh.queued_provisioning_time
              ) / NULLIF(1000, 0)
            ),
            2
          ) AS avg_queue_wait_seconds,
          ROUND(
            SUM(qh.bytes_scanned) / NULLIF(POWER(1024, 3), 0),
            2
          ) AS total_data_scanned_gb,
          COUNT(DISTINCT qh.warehouse_name) AS warehouses_used
        FROM
          query_history AS qh
        WHERE
          NOT qh.role_name IS NULL
        GROUP BY
          qh.role_name
      )
      SELECT
        'EXPENSIVE_QUERIES' AS optimization_pillar,
        eq.database_name AS resource_name,
        eq.role_name,
        COUNT(*) AS issue_count,
        ROUND(AVG(eq.execution_time_seconds), 2) AS avg_execution_time_seconds,
        ROUND(AVG(eq.data_scanned_gb), 2) AS avg_data_scanned_gb,
        ROUND(SUM(eq.cloud_services_credits), 4) AS total_cloud_services_credits,
        'High resource consumption queries' AS recommendation
      FROM
        expensive_queries AS eq
      GROUP BY
        eq.database_name,
        eq.role_name
      UNION ALL
      SELECT
        'SECURITY_GAPS' AS optimization_pillar,
        sg.database_name AS resource_name,
        'ALL_ROLES' AS role_name,
        sg.total_queries AS issue_count,
        sg.avg_execution_time_seconds,
        sg.total_data_scanned_gb AS avg_data_scanned_gb,
        0.00 AS total_cloud_services_credits,
        CONCAT('Security risk: ', sg.security_risk_level) AS recommendation
      FROM
        security_gaps AS sg
      WHERE
        sg.security_risk_level IN (
          'High usage permanent database',
          'External database - review access'
        )
      UNION ALL
      SELECT
        'PERFORMANCE_BOTTLENECKS' AS optimization_pillar,
        rp.role_name AS resource_name,
        rp.role_name,
        rp.total_queries AS issue_count,
        rp.avg_execution_time_seconds,
        rp.total_data_scanned_gb AS avg_data_scanned_gb,
        0.00 AS total_cloud_services_credits,
        CASE
          WHEN rp.failure_rate_percentage > 5 THEN CONCAT(
            'High failure rate: ',
            rp.failure_rate_percentage,
            '%'
          )
          WHEN rp.avg_queue_wait_seconds > 10 THEN CONCAT(
            'High queue wait: ',
            rp.avg_queue_wait_seconds,
            's'
          )
          WHEN rp.avg_execution_time_seconds > 60 THEN 'Slow query performance'
          ELSE 'Review query patterns'
        END AS recommendation
      FROM
        role_performance AS rp
      WHERE
        rp.failure_rate_percentage > 2
        OR rp.avg_queue_wait_seconds > 5
        OR rp.avg_execution_time_seconds > 30
      ORDER BY
        optimization_pillar,
        issue_count DESC NULLS LAST
    use_as_onboarding_question: false
    verified_by: Matt Harris
    verified_at: 1759172301
  - name: Show me a query cost optimization analysis with insights and user details.
    question: Show me a query cost optimization analysis with insights and user details.
    sql: |-
      WITH expensive_queries AS (
        SELECT
          qah.query_id,
          qah.user_name,
          qh.role_name,
          qh.database_name,
          qh.warehouse_name,
          ROUND(qah.credits_attributed_compute, 4) AS query_cost_credits,
          ROUND(qh.total_elapsed_time / NULLIF(1000.0, 0), 2) AS execution_time_seconds,
          ROUND(qh.bytes_scanned / NULLIF(POWER(1024, 3), 0), 2) AS data_scanned_gb,
          qh.query_type,
          qh.error_code
        FROM
          query_attribution_history AS qah
          INNER JOIN query_history AS qh ON qah.query_id = qh.query_id
        WHERE
          qah.credits_attributed_compute > 0.01
      ),
      query_insights_enhanced AS (
        SELECT
          qi.query_id,
          qi.insight_topic,
          qi.is_opportunity,
          qi.message,
          qi.total_elapsed_time
        FROM
          query_insights AS qi
        WHERE
          qi.is_opportunity = TRUE
      ),
      user_cost_analysis AS (
        SELECT
          qah.user_name,
          u.display_name,
          u.type AS user_type,
          u.default_role,
          COUNT(*) AS total_queries,
          ROUND(SUM(qah.credits_attributed_compute), 2) AS total_cost_credits,
          ROUND(AVG(qah.credits_attributed_compute), 4) AS avg_cost_per_query_credits,
          COUNT(
            CASE
              WHEN qah.credits_attributed_compute > 0.1 THEN 1
            END
          ) AS expensive_query_count,
          ROUND(
            (
              COUNT(
                CASE
                  WHEN qah.credits_attributed_compute > 0.1 THEN 1
                END
              ) * 100.0
            ) / NULLIF(NULLIF(COUNT(*), 0), 0),
            2
          ) AS expensive_query_percentage
        FROM
          query_attribution_history AS qah
          LEFT OUTER JOIN users AS u ON qah.user_name = u.name
        GROUP BY
          qah.user_name,
          u.display_name,
          u.type,
          u.default_role
      )
      SELECT
        'EXPENSIVE_QUERIES' AS analysis_category,
        eq.query_id AS resource_identifier,
        eq.user_name,
        eq.role_name,
        eq.database_name,
        eq.warehouse_name,
        eq.query_cost_credits AS cost_credits,
        eq.execution_time_seconds,
        eq.data_scanned_gb,
        CASE
          WHEN qi.is_opportunity = TRUE THEN 'Has optimization opportunity'
          WHEN eq.execution_time_seconds > 300 THEN 'Long running query'
          WHEN eq.data_scanned_gb > 10 THEN 'High data scan volume'
          ELSE 'Review query efficiency'
        END AS optimization_recommendation
      FROM
        expensive_queries AS eq
        LEFT OUTER JOIN query_insights_enhanced AS qi ON eq.query_id = qi.query_id
      WHERE
        eq.query_cost_credits > 0.05
      UNION ALL
      SELECT
        'USER_COST_ANALYSIS' AS analysis_category,
        uca.user_name AS resource_identifier,
        uca.user_name,
        uca.default_role AS role_name,
        'ALL_DATABASES' AS database_name,
        'ALL_WAREHOUSES' AS warehouse_name,
        uca.total_cost_credits AS cost_credits,
        0.00 AS execution_time_seconds,
        0.00 AS data_scanned_gb,
        CASE
          WHEN uca.expensive_query_percentage > 20 THEN CONCAT(
            'High expensive query rate: ',
            uca.expensive_query_percentage,
            '%'
          )
          WHEN uca.avg_cost_per_query_credits > 0.05 THEN 'High average query cost - review patterns'
          WHEN uca.total_queries > 1000
          AND uca.total_cost_credits > 10 THEN 'High volume, high cost user'
          ELSE 'Standard usage pattern'
        END AS optimization_recommendation
      FROM
        user_cost_analysis AS uca
      WHERE
        uca.total_cost_credits > 1.0
      ORDER BY
        analysis_category,
        cost_credits DESC NULLS LAST
    use_as_onboarding_question: false
    verified_by: Matt Harris
    verified_at: 1759194831
  - name: 'Compare operational metrics between different user types: cost per query, performance patterns, and security compliance'
    question: 'Compare operational metrics between different user types: cost per query, performance patterns, and security compliance'
    sql: |-
      WITH user_query_metrics AS (
        SELECT
          u.type AS user_type,
          COUNT(DISTINCT qah.query_id) AS total_queries,
          ROUND(AVG(qah.credits_attributed_compute), 4) AS avg_cost_per_query_credits,
          ROUND(AVG(qh.total_elapsed_time / NULLIF(1000, 0)), 2) AS avg_execution_time_seconds,
          ROUND(
            (
              COUNT(
                CASE
                  WHEN NOT qh.error_code IS NULL THEN 1
                END
              ) * 100.0
            ) / NULLIF(NULLIF(COUNT(qah.query_id), 0), 0),
            2
          ) AS failure_rate_percentage,
          ROUND(
            AVG(qh.bytes_scanned / NULLIF(POWER(1024, 3), 0)),
            2
          ) AS avg_data_scanned_gb,
          ROUND(SUM(qah.credits_attributed_compute), 2) AS total_cost_credits
        FROM
          query_attribution_history AS qah
          INNER JOIN query_history AS qh ON qah.query_id = qh.query_id
          LEFT OUTER JOIN users AS u ON qah.user_name = u.name
        WHERE
          NOT u.type IS NULL
        GROUP BY
          u.type
      ),
      user_security_metrics AS (
        SELECT
          u.type AS user_type,
          COUNT(*) AS total_users,
          COUNT(
            CASE
              WHEN u.has_mfa = TRUE THEN 1
            END
          ) AS mfa_enabled_users,
          ROUND(
            (
              COUNT(
                CASE
                  WHEN u.has_mfa = TRUE THEN 1
                END
              ) * 100.0
            ) / NULLIF(NULLIF(COUNT(*), 0), 0),
            2
          ) AS mfa_adoption_percentage,
          COUNT(
            CASE
              WHEN u.has_password = TRUE THEN 1
            END
          ) AS password_auth_users,
          ROUND(
            (
              COUNT(
                CASE
                  WHEN u.has_password = TRUE THEN 1
                END
              ) * 100.0
            ) / NULLIF(NULLIF(COUNT(*), 0), 0),
            2
          ) AS password_auth_percentage,
          COUNT(
            CASE
              WHEN u.has_rsa_public_key = TRUE THEN 1
            END
          ) AS rsa_key_users,
          ROUND(
            (
              COUNT(
                CASE
                  WHEN u.has_rsa_public_key = TRUE THEN 1
                END
              ) * 100.0
            ) / NULLIF(NULLIF(COUNT(*), 0), 0),
            2
          ) AS rsa_key_percentage
        FROM
          users AS u
        WHERE
          u.deleted_on IS NULL
          AND NOT u.type IS NULL
        GROUP BY
          u.type
      )
      SELECT
        uqm.user_type,
        uqm.total_queries,
        uqm.avg_cost_per_query_credits,
        uqm.avg_execution_time_seconds,
        uqm.failure_rate_percentage,
        uqm.avg_data_scanned_gb,
        uqm.total_cost_credits,
        usm.total_users,
        usm.mfa_adoption_percentage,
        usm.password_auth_percentage,
        usm.rsa_key_percentage,
        ROUND(
          uqm.total_cost_credits / NULLIF(NULLIF(usm.total_users, 0), 0),
          2
        ) AS cost_per_user_credits
      FROM
        user_query_metrics AS uqm
        LEFT JOIN user_security_metrics AS usm ON uqm.user_type = usm.user_type
      ORDER BY
        uqm.user_type
    use_as_onboarding_question: false
    verified_by: Matt Harris
    verified_at: 1759195186
  - name: Show me the cost per gigabyte scanned by database, filtered for queries that spilled to disk
    question: Show me the cost per gigabyte scanned by database, filtered for queries that spilled to disk
    sql: |-
      SELECT
        qh.database_name,
        ROUND(SUM(qah.credits_attributed_compute), 2) AS total_credits_used,
        ROUND(
          SUM(qh.bytes_scanned) / NULLIF(POWER(1024, 3), 0),
          2
        ) AS total_data_scanned_gb,
        ROUND(
          SUM(qah.credits_attributed_compute) / NULLIF(
            NULLIF(
              SUM(qh.bytes_scanned) / NULLIF(POWER(1024, 3), 0),
              0
            ),
            0
          ),
          4
        ) AS cost_per_gb_scanned,
        COUNT(*) AS total_queries,
        MIN(qh.start_time) AS period_start,
        MAX(qh.end_time) AS period_end
      FROM
        query_attribution_history AS qah
        INNER JOIN query_history AS qh ON qah.query_id = qh.query_id
      WHERE
        (
          qh.bytes_spilled_to_local_storage > 0
          OR qh.bytes_spilled_to_remote_storage > 0
        )
        AND NOT qh.database_name IS NULL
        AND qah.credits_attributed_compute > 0
      GROUP BY
        qh.database_name
      ORDER BY
        cost_per_gb_scanned DESC NULLS LAST
    use_as_onboarding_question: false
    verified_by: Matt Harris
    verified_at: 1759195576
module_custom_instructions:
  question_categorization: |
    **Data Privacy & Security Guidelines:**
    - Reject questions about specific named individual users' query activity; redirect to aggregate trends by role or department instead
    - For admin role queries, focus on patterns and anomalies rather than specific user actions
    - Encourage role-based analysis: "Show me ACCOUNTADMIN activity trends" rather than "What did John Smith query?"
    - Support compliance questions about access patterns, policy effectiveness, and governance metrics

    **Data Freshness & Latency:**
    - Always clarify that ACCOUNT_USAGE data has a latency of 45 minutes to 3 hours, not real-time
    - For "current" or "right now" questions, respond with "based on the most recent available data as of [timeframe]"
    - Encourage time-range queries rather than single point-in-time snapshots
    - Suggest trend analysis over 7-30 day periods for meaningful insights

    **Platform Health & Governance Focus Areas:**
    Guide users toward questions aligned with the three pillars:

    ** Cost Efficiency Questions (Encourage):**
    - "Which warehouses are consuming the most credits?" (WAREHOUSE_METERING_HISTORY)
    - "Show me the most expensive queries by user/role" (QUERY_ATTRIBUTION_HISTORY)
    - "What are our top cost queries this month?" (QUERY_ATTRIBUTION_HISTORY.CREDITS_ATTRIBUTED_COMPUTE)
    - "Query cost optimization analysis" (QUERY_ATTRIBUTION_HISTORY joined with QUERY_HISTORY)
    - "Show me per-query costs with performance metrics" (QUERY_ATTRIBUTION_HISTORY + QUERY_HISTORY)
    - "Which users have the highest query costs?" (QUERY_ATTRIBUTION_HISTORY aggregated by user)
    - "Show me warehouse cost trends month-over-month" (WAREHOUSE_METERING_HISTORY)
    - "What's our warehouse idle time cost?" (CREDITS_USED_COMPUTE minus CREDITS_ATTRIBUTED_COMPUTE_QUERIES)
    - "Which queries consume the most serverless credits?" (QUERY_HISTORY.CREDITS_USED_CLOUD_SERVICES)
    - "Show me cost efficiency: compute vs cloud services" (WAREHOUSE_METERING_HISTORY)
    - "What's our query acceleration spend?" (QUERY_ATTRIBUTION_HISTORY.CREDITS_USED_QUERY_ACCELERATION)

    **Cost Attribution Reality Check:**
    - For ANY "query cost" analysis: ALWAYS start with QUERY_ATTRIBUTION_HISTORY, not QUERY_HISTORY
    - QUERY_HISTORY.CREDITS_USED_CLOUD_SERVICES is ONLY for serverless features - NEVER use for main query costs
    - Redirect "database costs" questions to "query activity by database" using QUERY_ATTRIBUTION_HISTORY
    - Explain that costs are warehouse-based, not database-based
    - For database attribution needs, aggregate QUERY_ATTRIBUTION_HISTORY by database_name from joined QUERY_HISTORY
    - Guide away from direct WAREHOUSE_METERING_HISTORY + QUERY_HISTORY joins
    - **CRITICAL: "Query cost optimization" = QUERY_ATTRIBUTION_HISTORY.CREDITS_ATTRIBUTED_COMPUTE**

    ** Operational Performance Questions (Encourage):**
    - "What are our query performance trends?"
    - "Which warehouses are experiencing queuing issues?"
    - "Show me cache hit rates and optimization opportunities"
    - "What performance insights need attention?"

    ** Security & Governance Questions (Encourage):**
    - "What's our MFA adoption rate across user types?"
    - "Which databases have governance policies applied?"
    - "Show me privileged role usage patterns"
    - "What's our data classification coverage?"

    **Question Redirection & Enhancement:**
    - Redirect overly broad questions like "show me everything" to specific business outcomes
    - Guide users from descriptive ("what happened") to prescriptive ("what should we do") questions
    - Encourage comparative analysis: month-over-month, role comparisons, environment differences
    - Suggest actionable insights over raw data dumps

    **Scope & Context Guidance:**
    - For vague questions, ask for business context: "Are you investigating cost optimization, performance issues, or compliance requirements?"
    - Encourage specific time ranges: "last 30 days", "this quarter", "month-over-month comparison"
    - Suggest filtering by environment: production vs development databases
    - Guide toward trending and pattern recognition rather than single data points

    **Compliance & Audit Support:**
    - Support audit trail questions with appropriate aggregation and anonymization
    - Encourage policy effectiveness measurement over policy violations
    - Guide toward proactive governance metrics rather than reactive incident investigation
    - Support regulatory compliance reporting with proper data handling

    **Performance & Efficiency:**
    - Encourage users to specify time ranges to avoid scanning excessive data
    - Suggest starting with summary metrics before drilling into details  
    - Guide users toward using pre-defined filters and metrics for faster results
    - Recommend focusing on actionable insights that can drive operational improvements
  sql_generation: |
    **Numeric Formatting & Units:**
    - the concept of cost is measured in credits. You not convert credits into dollars.
    - Round all numeric and currency-based columns to 2 decimal points
    - Use ZEROIFNULL for numeric aggregations to avoid returning NULLs
    - When aggregating costs, alias the final column to include the unit, such as total_credits_used
    - Time stored in milliseconds should be converted to seconds with 2 decimal points: ROUND(milliseconds / 1000, 2)

    **Credit Attribution & Cost Analysis Guidance:**
    - **CRITICAL: For ALL questions about "query costs", "expensive queries", "query optimization", "cost per query", or "individual query expenses" - ALWAYS use QUERY_ATTRIBUTION_HISTORY.CREDITS_ATTRIBUTED_COMPUTE**
    - **NEVER use QUERY_HISTORY.CREDITS_USED_CLOUD_SERVICES for main query cost analysis - this is ONLY serverless credits, not compute costs**
    - For INDIVIDUAL QUERY COSTS: Use QUERY_ATTRIBUTION_HISTORY.CREDITS_ATTRIBUTED_COMPUTE (primary per-query cost measure)
    - For WAREHOUSE-LEVEL COSTS: Use WAREHOUSE_METERING_HISTORY.CREDITS_USED (total), CREDITS_USED_COMPUTE (compute), CREDITS_USED_CLOUD_SERVICES (serverless features)
    - QUERY_HISTORY.CREDITS_USED_CLOUD_SERVICES only tracks serverless credits for specific queries, NOT main compute costs
    - QUERY_ATTRIBUTION_HISTORY provides accurate per-query compute cost attribution excluding warehouse idle time
    - "Database costs" don't exist directly - costs are incurred at the warehouse level, databases are logical namespaces
    - For "most expensive queries" questions, use QUERY_ATTRIBUTION_HISTORY joined with QUERY_HISTORY for query details
    - For "query cost analysis" or "cost optimization" questions, start with QUERY_ATTRIBUTION_HISTORY as the primary table
    - For "database cost attribution" questions, aggregate QUERY_ATTRIBUTION_HISTORY by DATABASE_NAME from joined QUERY_HISTORY
    - For "warehouse costs" questions, use WAREHOUSE_METERING_HISTORY directly
    - CREDITS_ATTRIBUTED_COMPUTE_QUERIES excludes idle time; CREDITS_USED_COMPUTE includes idle time
    - QUERY_ATTRIBUTION_HISTORY data is available from mid-August 2024 with up to 8-hour latency
    - **KEY JOIN PATTERN: QUERY_ATTRIBUTION_HISTORY LEFT JOIN QUERY_HISTORY ON query_id for complete query cost analysis**
    - NEVER join WAREHOUSE_METERING_HISTORY to QUERY_HISTORY on warehouse_name alone - this creates massive Cartesian products
    - If joining these tables is absolutely necessary, use proper time-window correlation and DISTINCT aggregation

    **Bytes Conversion & Storage Units:**
    - Convert bytes to megabytes: ROUND(bytes / POWER(1024, 2), 2) AS size_mb
    - Convert bytes to gigabytes: ROUND(bytes / POWER(1024, 3), 2) AS size_gb  
    - Convert bytes to terabytes for very large values: ROUND(bytes / POWER(1024, 4), 2) AS size_tb
    - Always include the unit in the column alias (e.g., data_scanned_gb, storage_used_mb, bytes_spilled_gb)
    - Use binary (1024) not decimal (1000) conversion for storage calculations

    **Object Naming & Qualification:**
    - Always use fully qualified object names: DATABASE.SCHEMA.TABLE format
    - Example: SNOWFLAKE.ACCOUNT_USAGE.QUERY_HISTORY, not just QUERY_HISTORY
    - This ensures clarity and prevents ambiguity in complex queries

    **Defensive SQL Practices:**
    - Use NULLIF to prevent division by zero: column1 / NULLIF(column2, 0)
    - Handle NULL values with COALESCE or ZEROIFNULL where appropriate
    - Use GREATEST/LEAST for boundary conditions: GREATEST(value, 0) for non-negative results

    **Percentage & Rate Calculations:**
    - Format percentages as decimals multiplied by 100: ROUND((numerator / NULLIF(denominator, 0)) * 100, 2) AS percentage
    - Always include 'percentage', 'rate', or 'ratio' in percentage column aliases
    - Example: cache_hit_percentage, failure_rate, utilization_ratio

    **Date/Time Formatting:**
    - Use DATE_TRUNC for period-based aggregations: DATE_TRUNC('DAY', timestamp_column)
    - Format dates consistently: TO_DATE(column) or DATE(column) for date-only results
    - Use DATEDIFF for time span calculations with appropriate units

    **Large Number Formatting:**
    - For very large counts, consider using scientific notation or K/M/B suffixes in descriptions
    - Round large aggregations appropriately: query counts to whole numbers, storage to 2 decimals
    - Use meaningful aliases that indicate scale: total_queries_millions, storage_petabytes

    **Query Performance Considerations:**
    - Prefer EXISTS over IN for subquery performance when checking for existence
    - Use appropriate WHERE clause filters to limit data scanning
    - Consider using LIMIT for exploratory queries to prevent runaway results
$$);